!function(t){t&&(t.GeoOption={GeoCamera:!0,GeoCameraEventAggregator:!0,GeoScreenSpaceCameraController:!0},t.GEO_VERSION_NUMBER="$ Cesium Version: 1.40 build-20180522 $")}(window.Cesium),function(t){"use strict";var e=t.DrawCircleWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=e.mode?e.mode:1,this.appearance=new t.EllipsoidSurfaceAppearance({aboveGround:!1}),this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this._array_=o,this._circles_=e=[],this._labels_=i,this.handler.setInputAction(function(i){r.lastP=i;var n=r.camera.getPickRay(i.position),a=r.scene.globe.pick(n,r.scene);if(a&&(o[0]=a,o.length>0)){var s=new t.CircleGeometry({center:a,radius:0,height:0});s.name="draw_circle";var l=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:s}),appearance:r.appearance});l.name="draw_circle",e.push({geometry:{center:a,radius:0,height:0},primitive:l}),r.primitives.add(l)}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene);if(!s)return i&&(r.primitives.remove(i),i=null),void(r._labels_=i);var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;if(o.length>0){var u=o.concat();u.push(h),u.push(c),u.push(d);e[0];r.primitives.remove(e[0].primitive),e[0].geometry.radius=t.Cartesian3.distance(e[0].geometry.center,s),e[0].primitive=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:new t.CircleGeometry({center:e[0].geometry.center.clone(),radius:e[0].geometry.radius,height:e[0].geometry.height})}),appearance:r.appearance}),e[0].primitive.name="draw_circle",r.primitives.add(e[0].primitive)}i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d)),r._labels_=i},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){r.drawEnd(t)},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.drawEnd=function(e){var i=this._array_,r=this._circles_,o=this._labels_;e||(e=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.camera.getPickRay(e.position),a=this.scene.globe.pick(n,this.scene);if(a){var s=t.Cartographic.fromCartesian(a);t.Math.toDegrees(s.longitude),t.Math.toDegrees(s.latitude),s.height,this.mode;if(i.length>0&&(this.primitives.remove(r[0].primitive),r[0].geometry.radius=t.Cartesian3.distance(r[0].geometry.center,a),r[0].primitive=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:new t.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height})}),appearance:this.appearance}),r[0].primitive.name="draw_circle",this.primitives.add(r[0].primitive),this.callback)){var l=t.CircleGeometry.createGeometry(new t.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height})),h=new t.Entity({polygon:{hierarchy:{positions:function(){for(var e=[],i=l.attributes.position.values,r=0;r<i.length;r+=3)e.push(new t.Cartesian3(i[r],i[r+1],i[r+2]));return e}()}}});this.callback(h)}i=[],r=[]}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_circle",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_circle",this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.DrawHeightWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this.handler.setInputAction(function(i){if(!(o.length>0)){var n=r.camera.getPickRay(i.position),a=r.scene.globe.pick(n,r.scene);if(a){var s=t.Cartographic.fromCartesian(a),l=t.Math.toDegrees(s.longitude),h=t.Math.toDegrees(s.latitude),c=s.height;0==o.length&&(o.push(l),o.push(h),o.push(c),o.push(l),o.push(h),o.push(c),o.push(l),o.push(h),o.push(c),(e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o))}}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene);if(s){var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;9==o.length&&(o[3]=h,o[4]=c,o[5]=d,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d))}else i&&(r.primitives.remove(i),i=null)},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){if(r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback){var n=new t.Entity({polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(o)}});r.callback(n)}},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.DrawPointWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.YELLOW,this.pixelSize=e.pixelSize?e.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.position),s=r.scene.globe.pick(a,r.scene);if(s&&(o[0]=s,e?e.removeAll():(e=r.primitives.add(new t.PointPrimitiveCollection)).name="draw_point",e.add({position:s,color:r.color,pixelSize:r.pixelSize}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback)){var l=new t.Entity({position:o[0],point:{}});r.callback(l)}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var o=r.camera.getPickRay(e.endPosition),n=r.scene.globe.pick(o,r.scene);n?i?i.get(i.length-1).position=n:((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击进行绘制",font:"15px Microsoft YaHei",showBackground:!0}),i.get(i.length-1).position=n):i&&(r.primitives.remove(i),i=null)},t.ScreenSpaceEventType.MOUSE_MOVE)}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_point",this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.DrawPolygonWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null,this.count=0};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[],n=[],a=[];this._array_=n,this._array2_=a,this._polylines_=e,this._labels_=i,this.handler.setInputAction(function(i){r.lastP=i;var s=r.camera.getPickRay(i.position),l=r.scene.globe.pick(s,r.scene);if(l){var h=t.Cartographic.fromCartesian(l);if(l){n.push(l);var c=t.Math.toDegrees(h.longitude),d=t.Math.toDegrees(h.latitude),u=h.height;a.push([c,d]),o.push(c),o.push(d),o.push(u),3==o.length&&((e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),o.length>3&&(e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),r._polylines_=e}}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene),l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;if(o.length>=3){var u=o.concat();u.push(h),u.push(c),u.push(d),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(u)}i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d)),r._labels_=i},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){r.drawEnd(t)},t.ScreenSpaceEventType.RIGHT_CLICK),this.count++}},e.prototype.drawEnd=function(e){if(0!=this._array_.length){var i=this._array_,r=this._array2_,o=this._polylines_,n=this._labels_;e||(console.log("点击按钮结束绘制"),e=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",n&&(this.primitives.remove(n),n=null);var a=this.camera.getPickRay(e.position),s=this.scene.globe.pick(a,this.scene);if(s){i.push(s);var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude);if(r.push([h,c]),o.get(o.length-1).material.uniforms.color=t.Color.DODGERBLUE.withAlpha(0),this.viewer.entities.add({name:"draw_polygon",polygon:{hierarchy:{positions:i},material:this.color}}),this.callback){var d=new t.Entity({polygon:{hierarchy:{positions:i}}});this.callback(d)}this._array_=[],this._polylines_=null}}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_polygon",this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.DrawPolylineWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=e.mode?e.mode:1,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this._array_=o,this._polylines_=e,this._labels_=i,this.handler.setInputAction(function(i){r.lastP=i;var n=r.camera.getPickRay(i.position),a=r.scene.globe.pick(n,r.scene);if(a){var s=t.Cartographic.fromCartesian(a),l=t.Math.toDegrees(s.longitude),h=t.Math.toDegrees(s.latitude),c=s.height;o.push(l),o.push(h),o.push(c),3==o.length&&((e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),o.length>3&&(e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),r._polylines_=e}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene);if(!s)return i&&(r.primitives.remove(i),i=null),void(r._labels_=i);var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;if(o.length>=3){var u=o.concat();u.push(h),u.push(c),u.push(d),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(u)}i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(h,c,d)),r._labels_=i},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){r.drawEnd(t)},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.drawEnd=function(e){var r=this._array_,o=(this._polylines_,this._labels_);e||(e=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.camera.getPickRay(e.position),a=this.scene.globe.pick(n,this.scene);if(a){var s=t.Cartographic.fromCartesian(a),l=t.Math.toDegrees(s.longitude),h=t.Math.toDegrees(s.latitude),c=s.height;r.push(l),r.push(h),r.push(c);this.mode;if(2==this.mode){var d=function(e,i){for(var r=[],o=0;o<e.length/3-1;o++){var n=3*o,a=e[n],s=e[n+1],l=e[n+2],h=e[n+3],c=e[n+4],d=e[n+5];r.push(a),r.push(s),r.push(l);for(var u=0;u<100;u++){var p={longitude:t.Math.toRadians(a),latitude:t.Math.toRadians(s),height:l},g={longitude:t.Math.toRadians(h),latitude:t.Math.toRadians(c),height:d},m=t.Math.lerp(p.longitude,g.longitude,.01*(u+1)),f=t.Math.lerp(p.latitude,g.latitude,.01*(u+1)),v={longitude:m,latitude:f},y=i.globe.getHeight(v);r.push(t.Math.toDegrees(m)),r.push(t.Math.toDegrees(f)),r.push(y)}r.push(h),r.push(c),r.push(d)}return r}(r,this.scene);i("draw_polyline",this.primitives),this.viewer.entities.add({name:"draw_polyline",polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(d),width:this.lineWidth,material:this.color}})}if(this.callback){var u=new t.Entity({polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(r)}});this.callback(u)}}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_polyline",this.viewer.entities)}}(window.Cesium);var xp={version:"1.0.0",createTime:"2018.6.19",author:"xupinhui"},doubleArrowDefualParam={type:"doublearrow",headHeightFactor:.25,headWidthFactor:.3,neckHeightFactor:.85,fixPointCount:4,neckWidthFactor:.15},tailedAttackArrowDefualParam={headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1};xp.algorithm={},xp.algorithm.doubleArrow=function(t){this.connPoint=null,this.tempPoint4=null,this.points=t;var e={controlPoint:null,polygonalPoint:null};if(!(2>(s=t.length))){if(2==s)return t;var i,r,o=this.points[0],n=this.points[1],a=this.points[2],s=t.length;this.tempPoint4=3==s?xp.algorithm.getTempPoint4(o,n,a):this.points[3],this.connPoint=3==s||4==s?P.PlotUtils.mid(o,n):this.points[4],P.PlotUtils.isClockWise(o,n,a)?(i=xp.algorithm.getArrowPoints(o,this.connPoint,this.tempPoint4,!1),r=xp.algorithm.getArrowPoints(this.connPoint,n,a,!0)):(i=xp.algorithm.getArrowPoints(n,this.connPoint,a,!1),r=xp.algorithm.getArrowPoints(this.connPoint,o,this.tempPoint4,!0));var l=i.length,h=(l-5)/2,c=i.slice(0,h),d=i.slice(h,h+5),u=i.slice(h+5,l),p=r.slice(0,h),g=r.slice(h,h+5),m=r.slice(h+5,l);p=P.PlotUtils.getBezierPoints(p);var f=P.PlotUtils.getBezierPoints(m.concat(c.slice(1)));u=P.PlotUtils.getBezierPoints(u);var v=p.concat(g,f,d,u),y=xp.algorithm.array2Dto1D(v);e.controlPoint=[o,n,a,this.tempPoint4,this.connPoint],e.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(y)}return e},xp.algorithm.getTempPoint4=function(t,e,i,r){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var o=P.PlotUtils.mid(t,e),n=P.PlotUtils.distance(o,i),a=P.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),s=P.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,a=P.PlotUtils.getThirdPoint(o,a,P.Constants.HALF_PI,n/5,r),s=P.PlotUtils.getThirdPoint(o,s,P.Constants.HALF_PI,n/4,r),i],h=xp.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),c=h[0],d=h[4],u=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(l)/2,p=xp.algorithm.getArrowBodyPoints(l,c,d,u),g=p.length,m=p.slice(0,g/2),f=p.slice(g/2,g);return m.push(c),f.push(d),(m=m.reverse()).push(e),(f=f.reverse()).push(t),m.reverse().concat(h,f)},xp.algorithm.array2Dto1D=function(t){var e=[];return t.forEach(function(t){e.push(t[0]),e.push(t[1])}),e},xp.algorithm.getArrowPoints=function(t,e,i,r){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var o=P.PlotUtils.mid(t,e),n=P.PlotUtils.distance(o,i),a=P.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),s=P.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,a=P.PlotUtils.getThirdPoint(o,a,P.Constants.HALF_PI,n/5,r),s=P.PlotUtils.getThirdPoint(o,s,P.Constants.HALF_PI,n/4,r),i],h=xp.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),c=h[0],d=h[4],u=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(l)/2,p=xp.algorithm.getArrowBodyPoints(l,c,d,u),g=p.length,m=p.slice(0,g/2),f=p.slice(g/2,g);return m.push(c),f.push(d),(m=m.reverse()).push(e),(f=f.reverse()).push(t),m.reverse().concat(h,f)},xp.algorithm.getArrowHeadPoints=function(t,e,i){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var r=P.PlotUtils.getBaseLength(t)*this.headHeightFactor,o=t[t.length-1],n=(P.PlotUtils.distance(e,i),r*this.headWidthFactor),a=r*this.neckWidthFactor,s=r*this.neckHeightFactor,l=P.PlotUtils.getThirdPoint(t[t.length-2],o,0,r,!0),h=P.PlotUtils.getThirdPoint(t[t.length-2],o,0,s,!0),c=P.PlotUtils.getThirdPoint(o,l,P.Constants.HALF_PI,n,!1),d=P.PlotUtils.getThirdPoint(o,l,P.Constants.HALF_PI,n,!0);return[P.PlotUtils.getThirdPoint(o,h,P.Constants.HALF_PI,a,!1),c,o,d,P.PlotUtils.getThirdPoint(o,h,P.Constants.HALF_PI,a,!0)]},xp.algorithm.getArrowBodyPoints=function(t,e,i,r){for(var o=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t)*r,a=(n-P.PlotUtils.distance(e,i))/2,s=0,l=[],h=[],c=1;c<t.length-1;c++){var d=P.PlotUtils.getAngleOfThreePoints(t[c-1],t[c],t[c+1])/2,u=(n/2-(s+=P.PlotUtils.distance(t[c-1],t[c]))/o*a)/Math.sin(d),p=P.PlotUtils.getThirdPoint(t[c-1],t[c],Math.PI-d,u,!0),g=P.PlotUtils.getThirdPoint(t[c-1],t[c],d,u,!1);l.push(p),h.push(g)}return l.concat(h)},xp.algorithm.getTempPoint4=function(t,e,i){var r,o,n,a,s=P.PlotUtils.mid(t,e),l=P.PlotUtils.distance(s,i),h=P.PlotUtils.getAngleOfThreePoints(t,s,i);return h<P.Constants.HALF_PI?(o=l*Math.sin(h),n=l*Math.cos(h),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!1),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!0)):h>=P.Constants.HALF_PI&&h<Math.PI?(o=l*Math.sin(Math.PI-h),n=l*Math.cos(Math.PI-h),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!1),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!1)):h>=Math.PI&&h<1.5*Math.PI?(o=l*Math.sin(h-Math.PI),n=l*Math.cos(h-Math.PI),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!0),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!0)):(o=l*Math.sin(2*Math.PI-h),n=l*Math.cos(2*Math.PI-h),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!0),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!1)),r},xp.algorithm.tailedAttackArrow=function(t){t=xp.algorithm.dereplication(t),this.tailWidthFactor=tailedAttackArrowDefualParam.tailWidthFactor,this.swallowTailFactor=tailedAttackArrowDefualParam.swallowTailFactor,this.swallowTailPnt=tailedAttackArrowDefualParam.swallowTailPnt;var e={controlPoint:null,polygonalPoint:null};if(e.controlPoint=t,!(2>(g=t.length))){if(2==t.length)return e.polygonalPoint=t,e;var i=t,r=i[0],o=i[1];P.PlotUtils.isClockWise(i[0],i[1],i[2])&&(r=i[1],o=i[0]);var n=[P.PlotUtils.mid(r,o)].concat(i.slice(2)),a=xp.algorithm.getAttackArrowHeadPoints(n,r,o,tailedAttackArrowDefualParam),s=a[0],l=a[4],h=P.PlotUtils.distance(r,o),c=P.PlotUtils.getBaseLength(n),d=c*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=P.PlotUtils.getThirdPoint(n[1],n[0],0,d,!0);var u=h/c,p=xp.algorithm.getAttackArrowBodyPoints(n,s,l,u),g=p.length,m=[r].concat(p.slice(0,g/2));m.push(s);var f,v=[o].concat(p.slice(g/2,g));v.push(l),m=P.PlotUtils.getQBSplinePoints(m),v=P.PlotUtils.getQBSplinePoints(v),f=xp.algorithm.array2Dto1D(m.concat(a,v.reverse(),[this.swallowTailPnt,m[0]])),e.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(f)}return e},xp.algorithm.getAttackArrowHeadPoints=function(t,e,i,r){this.headHeightFactor=r.headHeightFactor,this.headTailFactor=r.headTailFactor,this.headWidthFactor=r.headWidthFactor,this.neckWidthFactor=r.neckWidthFactor,this.neckHeightFactor=r.neckHeightFactor;var o=P.PlotUtils.getBaseLength(t),n=o*this.headHeightFactor,a=t[t.length-1];o=P.PlotUtils.distance(a,t[t.length-2]);var s=P.PlotUtils.distance(e,i);n>s*this.headTailFactor&&(n=s*this.headTailFactor);var l=n*this.headWidthFactor,h=n*this.neckWidthFactor,c=(n=n>o?o:n)*this.neckHeightFactor,d=P.PlotUtils.getThirdPoint(t[t.length-2],a,0,n,!0),u=P.PlotUtils.getThirdPoint(t[t.length-2],a,0,c,!0),p=P.PlotUtils.getThirdPoint(a,d,P.Constants.HALF_PI,l,!1),g=P.PlotUtils.getThirdPoint(a,d,P.Constants.HALF_PI,l,!0);return[P.PlotUtils.getThirdPoint(a,u,P.Constants.HALF_PI,h,!1),p,a,g,P.PlotUtils.getThirdPoint(a,u,P.Constants.HALF_PI,h,!0)]},xp.algorithm.getAttackArrowBodyPoints=function(t,e,i,r){for(var o=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t)*r,a=(n-P.PlotUtils.distance(e,i))/2,s=0,l=[],h=[],c=1;c<t.length-1;c++){var d=P.PlotUtils.getAngleOfThreePoints(t[c-1],t[c],t[c+1])/2,u=(n/2-(s+=P.PlotUtils.distance(t[c-1],t[c]))/o*a)/Math.sin(d),p=P.PlotUtils.getThirdPoint(t[c-1],t[c],Math.PI-d,u,!0),g=P.PlotUtils.getThirdPoint(t[c-1],t[c],d,u,!1);l.push(p),h.push(g)}return l.concat(h)},xp.algorithm.dereplication=function(t){var e=t[t.length-1],i=!1,r=[];return r=t.filter(function(t){if(t[0]!=e[0]&&t[1]!=e[1])return t;i=!0}),i&&r.push(e),r},function(t){var e=t.DrawHelper=function(){var i=t.Ellipsoid.WGS84,r={billBoard:[],primitives:[]};function o(t){var e,i;this._scene=t.scene,this._tooltip=(e=t.container,(i=function(t){var e=document.createElement("DIV");e.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",e.appendChild(i);var r=document.createElement("DIV");r.className="twipsy-inner",e.appendChild(r),this._div=e,this._title=r,t.appendChild(e)}).prototype.setVisible=function(t){this._div.style.display=t?"block":"none"},i.prototype.showAt=function(t,e){t&&e&&(this.setVisible(!0),this._title.innerHTML=e,this._div.style.left=t.x+10+"px",this._div.style.top=t.y-this._div.clientHeight/2+"px")},new i(e)),this._surfaces=[],this.initialiseHandlers(),this.enhancePrimitives()}o.prototype.initialiseHandlers=function(){var e,i=this._scene,r=this,o=new t.ScreenSpaceEventHandler(i.canvas);function n(t,e){if(1!=r._handlersMuted){var o=i.pick(e);o&&o.primitive&&o.primitive[t]&&o.primitive[t](e)}}o.setInputAction(function(t){n("leftClick",t.position)},t.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(t){n("leftDoubleClick",t.position)},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),o.setInputAction(function(t){if(1!=r._handlersMuted){var o=i.pick(t.endPosition);!e||o&&e==o.primitive||((!e.isDestroyed||!e.isDestroyed())&&e.mouseOut(t.endPosition),e=null),o&&o.primitive&&((o=o.primitive).mouseOut&&(e=o),o.mouseMove&&o.mouseMove(t.endPosition))}},t.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(t){n("leftUp",t.position)},t.ScreenSpaceEventType.LEFT_UP),o.setInputAction(function(t){n("leftDown",t.position)},t.ScreenSpaceEventType.LEFT_DOWN)},o.prototype.setListener=function(t,e,i){t[e]=i},o.prototype.muteHandlers=function(t){this._handlersMuted=t},o.prototype.registerEditableShape=function(t){var e=this;E(t,"mouseMove",function(i){t.setHighlighted(!0),t._editMode||e._tooltip.showAt(i,"点击以编辑图形")}),E(t,"mouseOut",function(i){t.setHighlighted(!1),e._tooltip.setVisible(!1)}),E(t,"leftClick",function(e){t.setEditMode(!0),r.primitives.push(t)}),E(t,"leftDoubleClick",function(e){r.primitives.push(t)})},o.prototype.startDrawing=function(t){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=t,this.muteHandlers(!0)},o.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},o.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},o.prototype.setHighlighted=function(t){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=t&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=t},o.prototype.disableAllEditMode=function(){this.setEdited(void 0)},o.prototype.setEdited=function(t){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=t};var n=t.Material.fromType(t.Material.ColorType);n.uniforms.color=new t.Color(1,1,0,.5);var a={ellipsoid:t.Ellipsoid.WGS84,textureRotationAngle:0,height:0,asynchronous:!0,show:!0,debugShowBoundingVolume:!1},s=C(a,{appearance:new t.EllipsoidSurfaceAppearance({aboveGround:!1}),material:n,granularity:Math.PI/180}),l=C(a,{}),h=C(a,{}),c=C(a,{}),d=(C(s,{rotation:0}),C(a,{width:5,geodesic:!0,granularity:1e4,appearance:new t.PolylineMaterialAppearance({aboveGround:!1}),material:n})),u=function(){function e(){}return e.prototype.initialiseOptions=function(t){b(this,t),this._ellipsoid=void 0,this._granularity=void 0,this._height=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!0,this._primitive=void 0,this._outlinePolygon=void 0},e.prototype.setAttribute=function(t,e){this[t]=e,this._createPrimitive=!0},e.prototype.getAttribute=function(t){return this[t]},e.prototype.update=function(e,i,r){if(!t.defined(this.ellipsoid))throw new t.DeveloperError("this.ellipsoid must be defined.");if(!t.defined(this.appearance))throw new t.DeveloperError("this.material must be defined.");if(this.granularity<0)throw new t.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show&&(this._createPrimitive||t.defined(this._primitive))){if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var o=this.getGeometry();if(!o)return;this._createPrimitive=!1,this._ellipsoid=this.ellipsoid,this._granularity=this.granularity,this._height=this.height,this._textureRotationAngle=this.textureRotationAngle,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:o,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous}),this._outlinePolygon=this._outlinePolygon&&this._outlinePolygon.destroy(),this.strokeColor&&this.getOutlineGeometry&&(this._outlinePolygon=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:this.getOutlineGeometry(),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}}),appearance:new t.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!0},lineWidth:1}})}))}var n=this._primitive;n.appearance.material=this.material,n.debugShowBoundingVolume=this.debugShowBoundingVolume,n.update(e,i,r),this._outlinePolygon&&this._outlinePolygon.update(e,i,r)}},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),t.destroyObject(this)},e.prototype.setStrokeStyle=function(t,e){this.strokeColor&&this.strokeColor.equals(t)&&this.strokeWidth==e||(this._createPrimitive=!0,this.strokeColor=t,this.strokeWidth=e)},e}();o.ExtentPrimitive=function(){function e(e){if(!t.defined(e.extent))throw new t.DeveloperError("Extent is required");e=C(e,s),this.initialiseOptions(e),this.setExtent(e.extent)}return e.prototype=new u,e.prototype.setExtent=function(t){this.setAttribute("extent",t)},e.prototype.getExtent=function(){return this.getAttribute("extent")},e.prototype.getGeometry=function(){if(t.defined(this.extent))return t.PolygonGeometry.fromPositions({positions:this.extent,height:this.height,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},e.prototype.getOutlineGeometry=function(){return t.PolygonOutlineGeometry.fromPositions({positions:this.extent})},e}(),o.PolygonPrimitive=function(){function e(t){t=C(t,s),this.initialiseOptions(t),this.isPolygon=!0}return e.prototype=new u,e.prototype.setPositions=function(t){this.setAttribute("positions",t)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.setCustom=function(t){this.setAttribute("custom")},e.prototype.getCustom=function(t){return this.getAttribute("custom")},e.prototype.getGeometry=function(){if(t.defined(this.positions)&&!(this.positions.length<3))return t.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},e.prototype.getOutlineGeometry=function(){return t.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},e}(),o.TailedAttackPrimitive=function(){function e(t){t=C(t,s),this.initialiseOptions(t),this.isPolygon=!0}return e.prototype=new u,e.prototype.setPositions=function(t){this.setAttribute("positions",t)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.setCustom=function(t){this.setAttribute("custom")},e.prototype.getCustom=function(t){return this.getAttribute("custom")},e.prototype.getGeometry=function(){if(t.defined(this.positions)&&!(this.positions.length<3))return t.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},e.prototype.getOutlineGeometry=function(){return t.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},e}(),o.PolylinePrimitive=function(){function e(t){t=C(t,d),this.initialiseOptions(t)}return e.prototype=new u,e.prototype.setPositions=function(t){this.setAttribute("positions",t)},e.prototype.setWidth=function(t){this.setAttribute("width",t)},e.prototype.setGeodesic=function(t){this.setAttribute("geodesic",t)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.getWidth=function(){return this.getAttribute("width")},e.prototype.getGeodesic=function(t){return this.getAttribute("geodesic")},e.prototype.getGeometry=function(){if(t.defined(this.positions)&&!(this.positions.length<2))return new t.PolylineGeometry({positions:this.positions,height:this.height,width:this.width<1?1:this.width,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})},e}();var p={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},g={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},m={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIconLight.png",shiftX:0,shiftY:0};function f(t){return[t[7],t[3]]}function v(e){var i=t.Cartographic.fromCartesian(e);return[t.Math.toDegrees(i.longitude),t.Math.toDegrees(i.latitude)]}function y(e,i){if(!(e.length<2||i.length<2)){var r=Math.PI/8.5,o=Math.PI/13,n=[];n[0]=e,n[1]=i;var a=n[0],s=n[1],l=P.PlotUtils.getBaseLength(n),h=.15*l,c=.2*l,d=.25*l,u=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,h,!0),p=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,h,!1),g=P.PlotUtils.getThirdPoint(a,s,r,d,!1),m=P.PlotUtils.getThirdPoint(a,s,r,d,!0),f=P.PlotUtils.getThirdPoint(a,s,o,c,!1),v=P.PlotUtils.getThirdPoint(a,s,o,c,!0),y=[];return y.push(u[0],u[1],f[0],f[1],g[0],g[1],s[0],s[1],m[0],m[1],v[0],v[1],p[0],p[1],a[0],a[1]),t.Cartesian3.fromDegreesArray(y)}}function _(e){for(var i=[],r=0;r<e.length;r++){var o=t.Cartesian3.fromDegrees(e[r][0],e[r][1],0);i.push(o)}return i}o.prototype.createBillboardGroup=function(t,e,i){var r=new o.BillboardGroup(this,e);return r.addBillboards(t,i),r},o.BillboardGroup=function(e,i){this._drawHelper=e,this._scene=e._scene,this._options=C(i,p);var r=new t.BillboardCollection;this._scene.primitives.add(r),this._billboards=r,this._orderedBillboards=[]},o.BillboardGroup.prototype.createBillboard=function(e,r){var o=this._billboards.add({show:!0,position:e,pixelOffset:new t.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new t.Cartesian3(0,0,0),horizontalOrigin:t.HorizontalOrigin.CENTER,verticalOrigin:t.VerticalOrigin.CENTER,scale:1,image:this._options.iconUrl,color:new t.Color(1,1,1,1)});if(r){var n=this,a=this._scene.screenSpaceCameraController;function s(t){a.enableRotate=t}function l(){for(var t=0,e=n._orderedBillboards.length;t<e&&n._orderedBillboards[t]!=o;++t);return t}if(r.dragHandlers){n=this;E(o,"leftDown",function(e){function a(t){h.destroy(),s(!0),r.dragHandlers.onDragEnd&&r.dragHandlers.onDragEnd(l(),t)}var h=new t.ScreenSpaceEventHandler(n._scene.canvas);h.setInputAction(function(t){var e=n._scene.camera.pickEllipsoid(t.endPosition,i);e?function(t){o.position=t;for(var e=0,i=n._orderedBillboards.length;e<i&&n._orderedBillboards[e]!=o;++e);r.dragHandlers.onDrag&&r.dragHandlers.onDrag(l(),t)}(e):a(e)},t.ScreenSpaceEventType.MOUSE_MOVE),h.setInputAction(function(t){a(n._scene.camera.pickEllipsoid(t.position,i))},t.ScreenSpaceEventType.LEFT_UP),s(!1),r.dragHandlers.onDragStart&&r.dragHandlers.onDragStart(l(),n._scene.camera.pickEllipsoid(e,i))})}r.onDoubleClick&&E(o,"leftDoubleClick",function(t){r.onDoubleClick(l())}),r.onClick&&E(o,"leftClick",function(t){r.onClick(l())}),r.tooltip&&(E(o,"mouseMove",function(t){n._drawHelper._tooltip.showAt(t,r.tooltip())}),E(o,"mouseOut",function(t){n._drawHelper._tooltip.setVisible(!1)}))}return o},o.BillboardGroup.prototype.insertBillboard=function(t,e,i){this._orderedBillboards.splice(t,0,this.createBillboard(e,i))},o.BillboardGroup.prototype.addBillboard=function(t,e){this._orderedBillboards.push(this.createBillboard(t,e))},o.BillboardGroup.prototype.removeLastBillboard=function(){this._billboards.remove(this._orderedBillboards.pop())},o.BillboardGroup.prototype.addBillboards=function(t,e){for(var i=0;i<t.length;i++)this.addBillboard(t[i],e)},o.BillboardGroup.prototype.updateBillboardsPositions=function(t){for(var e=0;e<t.length;e++)this.getBillboard(e).position=t[e]},o.BillboardGroup.prototype.countBillboards=function(){return this._orderedBillboards.length},o.BillboardGroup.prototype.getBillboard=function(t){return this._orderedBillboards[t]},o.BillboardGroup.prototype.removeBillboard=function(t){this._billboards.remove(this.getBillboard(t)),this._orderedBillboards.splice(t,1)},o.BillboardGroup.prototype.remove=function(){this._billboards=this._billboards&&this._billboards.removeAll()&&this._billboards.destroy()},o.BillboardGroup.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},o.prototype.startDrawingPolygon=function(t){t=C(t,s);this.startDrawingPolyshape(!0,t)},o.prototype.startDrawingPolyline=function(r){r=C(r,d);this.startDrawing(function(){l.remove(n),u.remove(),g.destroy(),h.setVisible(!1)});var n,a=this,s=this._scene,l=s.primitives,h=this._tooltip;(n=new e.PolylinePrimitive(r)).asynchronous=!1,l.add(n);var c=[],u=new o.BillboardGroup(this,p),g=new t.ScreenSpaceEventHandler(s.canvas);g.setInputAction(function(t){if(null!=t.position){var e=s.camera.pickEllipsoid(t.position,i);e&&(0==c.length&&(c.push(e.clone()),u.addBillboard(c[0])),c.length>=2&&(n.positions=c,n._createPrimitive=!0),c.push(e),u.addBillboard(e))}},t.ScreenSpaceEventType.LEFT_CLICK),g.setInputAction(function(t){var e=t.endPosition;if(null!=e)if(0==c.length)h.showAt(e,"<p>Click to add first point</p>");else{var r=s.camera.pickEllipsoid(e,i);r&&(c.pop(),r.y+=1+Math.random(),c.push(r),c.length>=2&&(n.positions=c,n._createPrimitive=!0),u.getBillboard(c.length-1).position=r,h.showAt(e,"<p>Click to add new point ("+c.length+")</p>"+(c.length>2?"<p>Double click to finish drawing</p>":"")))}},t.ScreenSpaceEventType.MOUSE_MOVE),g.setInputAction(function(t){var e=t.position;if(null!=e){if(c.length<4)return;if(s.camera.pickEllipsoid(e,i)&&(a.stopDrawing(),"function"==typeof r.callback)){c.length;r.callback(c)}}},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.startDrawingTailedAttack=function(r){this.startDrawing(function(){s.remove(h),u.remove(),g.destroy(),l.setVisible(!1)}),this.firstTime=!0,this.options=r;var n=this,a=this._scene,s=a.primitives,l=this._tooltip,h=new e.TailedAttackPrimitive(r);/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?h.asynchronous=!0:h.asynchronous=!1,s.add(h);var c=[],d=[],u=new o.BillboardGroup(this,p),g=new t.ScreenSpaceEventHandler(a.canvas);this.positions=c,this.minPoints=2,this.poly=h,g.setInputAction(function(e){if(null!=e.position){var r=a.camera.pickEllipsoid(e.position,i),o=t.Cartographic.fromCartesian(r),n=[t.Math.toDegrees(o.longitude),t.Math.toDegrees(o.latitude)];if(r){if(0==d.length&&(c.push(r.clone()),u.addBillboard(c[0])),d.length<3&&d.push(n),d.length>=2){d.push(n);var s=xp.algorithm.tailedAttackArrow(d);h.positions=s.polygonalPoint,h.custom=s.controlPoint,h._createPrimitive=!0}c.push(r),c.length>=5&&u.removeLastBillboard(),u.addBillboard(r)}}},t.ScreenSpaceEventType.LEFT_CLICK),g.setInputAction(function(e){var r=e.endPosition;if(null!=r)if(0==c.length)l.showAt(r,"<p>点击以增加第一个控制点</p>");else{var o=a.camera.pickEllipsoid(r,i),n=t.Cartographic.fromCartesian(o),s=[t.Math.toDegrees(n.longitude),t.Math.toDegrees(n.latitude)];if(o){if(c.pop(),o.y+=1+Math.random(),c.push(o),d.length>=3&&(d.pop(),d.push(s)),2==d.length&&d.push(s),c.length>2){var u=xp.algorithm.tailedAttackArrow(d);h.positions=u?u.polygonalPoint:null,h.custom=u?u.controlPoint:null,h._createPrimitive=!0}var p=3==c.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";l.showAt(r,p)}}},t.ScreenSpaceEventType.MOUSE_MOVE),g.setInputAction(function(t){n.drawEnd(t,r)},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.drawEnd=function(t,e){var r,o=this.positions,n=this.minPoints,a=this.poly;e=this.options;if(void 0==t){if(this.firstTime){if(this.stopDrawing(),"function"!=typeof e.callback)return;o.length;e.callback(a.positions,a.custom),this.firstTime=!1}}else if(null!=(r=t.position)){if(o.length<n+2)return;if(scene.camera.pickEllipsoid(r,i)&&(this.stopDrawing(),"function"==typeof e.callback)){o.length;e.callback(a.positions,a.custom)}}},o.prototype.startDrawingPolyshape=function(r,n){this.startDrawing(function(){h.remove(a),g.remove(),m.destroy(),c.setVisible(!1)}),this.firstTime=!0,this.options=n;var a,s=this,l=this._scene,h=l.primitives,c=this._tooltip;this.minPoints=2,a=r?new e.PolygonPrimitive(n):new e.PolylinePrimitive(n),/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?a.asynchronous=!0:a.asynchronous=!1,h.add(a);var d=[],u=[],g=new o.BillboardGroup(this,p),m=new t.ScreenSpaceEventHandler(l.canvas);this.poly=a,this.positions=d,m.setInputAction(function(e){if(null!=e.position){var r=l.camera.pickEllipsoid(e.position,i),o=t.Cartographic.fromCartesian(r),n=[t.Math.toDegrees(o.longitude),t.Math.toDegrees(o.latitude)];if(r){if(0==u.length&&(d.push(r.clone()),g.addBillboard(d[0])),u.length<3&&u.push(n),u.length>=2){var s=xp.algorithm.doubleArrow(u);a.positions=s.polygonalPoint,a.custom=s.controlPoint,a._createPrimitive=!0}d.push(r),d.length>=5&&g.removeLastBillboard(),g.addBillboard(r)}}},t.ScreenSpaceEventType.LEFT_CLICK),m.setInputAction(function(e){var r=e.endPosition;if(null!=r)if(0==d.length)c.showAt(r,"<p>点击以增加第一个控制点</p>");else{var o=l.camera.pickEllipsoid(r,i),n=t.Cartographic.fromCartesian(o),s=[t.Math.toDegrees(n.longitude),t.Math.toDegrees(n.latitude)];if(o){if(d.pop(),o.y+=1+Math.random(),d.push(o),3==u.length&&(u.pop(),u.push(s)),2==u.length&&u.push(s),d.length>=2){var h=xp.algorithm.doubleArrow(u);a.positions=h?h.polygonalPoint:null,a.custom=h?h.controlPoint:null,a._createPrimitive=!0}var p=3==d.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";c.showAt(r,p)}}},t.ScreenSpaceEventType.MOUSE_MOVE),m.setInputAction(function(t){s.drawEnd(t,n)},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.startDrawingExtent=function(e){e=C(e,s);this.startDrawing(function(){null!=c&&a.remove(c),d.remove(),u.destroy(),l.setVisible(!1)});var r=this,n=this._scene,a=this._scene.primitives,l=this._tooltip,h=[],c=null,d=null,u=new t.ScreenSpaceEventHandler(n.canvas);u.setInputAction(function(s){if(null!=s.position){var l=n.camera.pickEllipsoid(s.position,i);if(l)if(null==c){var u=t.Cartographic.fromCartesian(l),g=t.Math.toDegrees(u.longitude),m=t.Math.toDegrees(u.latitude);h.push(g,m);var f=y(h,h);c=new o.ExtentPrimitive({extent:f,asynchronous:!1,material:e.material}),a.add(c),d=new o.BillboardGroup(r,p);var v=_([h,h]);d.addBillboards(v)}else if(r.stopDrawing(),"function"==typeof e.callback){u=t.Cartographic.fromCartesian(l),g=t.Math.toDegrees(u.longitude),m=t.Math.toDegrees(u.latitude);e.callback(y(h,[g,m]))}}},t.ScreenSpaceEventType.LEFT_DOWN),u.setInputAction(function(e){var r=e.endPosition;if(null!=r)if(null==c)l.showAt(r,"<p>点击开始绘制</p>");else{var o=n.camera.pickEllipsoid(r,i);if(o){var a=t.Cartographic.fromCartesian(o),s=t.Math.toDegrees(a.longitude),u=t.Math.toDegrees(a.latitude),p=y(h,[s,u]);c.setExtent(p);var g=_([h,[s,u]]);d.updateBillboardsPositions(g),l.showAt(r,"<p>拖动改变箭头</p><p>再次点击结束绘制</p>")}}},t.ScreenSpaceEventType.MOUSE_MOVE)},o.prototype.enhancePrimitives=function(){var n=this;function a(e){n._scene;this._highlighted&&this._highlighted==e||!0!==this._editMode&&(this._highlighted=e,e?(n.setHighlighted(this),this._strokeColor=this.strokeColor,this.setStrokeStyle(t.Color.fromCssColorString("white"),this.strokeWidth)):this._strokeColor?this.setStrokeStyle(this._strokeColor,this.strokeWidth):this.setStrokeStyle(void 0,void 0))}function s(e){if(this._editMode!=e)if(n.disableAllHighlights(),e){n.setEdited(this);var a=n._scene,s=this;if(null==this._markers){var l=new o.BillboardGroup(n,g);r.billBoard.push(l);var h=new o.BillboardGroup(n,m);function c(t,e){var i=t-1<0?e.length-1:t-1;i<h.countBillboards()&&(h.getBillboard(i).position=p(i)),(i=t)<h.countBillboards()&&(h.getBillboard(i).position=p(i))}function d(){s.executeListeners({name:"onEdited",positions:s.positions})}r.billBoard.push(h);var u={dragHandlers:{onDrag:function(t,e){s.positions[t]=e,c(t,s.positions),s._createPrimitive=!0},onDragEnd:function(t,e){s._createPrimitive=!0,d()}},onDoubleClick:function(t){s.positions.length<4||(s.positions.splice(t,1),s._createPrimitive=!0,l.removeBillboard(t),h.removeBillboard(t),c(t,s.positions),d())},tooltip:function(){if(s.positions.length>3)return"Double click to remove this point"}};function p(e){var r=s.positions;return i.cartographicToCartesian(new t.EllipsoidGeodesic(i.cartesianToCartographic(r[e]),i.cartesianToCartographic(r[e<r.length-1?e+1:0])).interpolateUsingFraction(.5))}l.addBillboards(s.positions,u),this._markers=l;for(var f=[],v=0,y=s.positions.length+(this.isPolygon?0:-1);v<y;v++)f.push(p(v));var _={dragHandlers:{onDragStart:function(t,e){this.index=t+1,s.positions.splice(this.index,0,e),s._createPrimitive=!0},onDrag:function(t,e){s.positions[this.index]=e,s._createPrimitive=!0},onDragEnd:function(t,e){l.insertBillboard(this.index,e,u),h.getBillboard(this.index-1).position=p(this.index-1),h.insertBillboard(this.index,p(this.index),_),s._createPrimitive=!0,d()}},tooltip:function(){return"Drag to create a new point"}};h.addBillboards(f,_),this._editMarkers=h,this._globeClickhandler=new t.ScreenSpaceEventHandler(a.canvas),this._globeClickhandler.setInputAction(function(t){var e=a.pick(t.position);e&&e.primitive||s.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),l.setOnTop(),h.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._editMarkers.remove(),this._markers=null,this._editMarkers=null,this._globeClickhandler.destroy()),this._editMode=!1}t.Billboard.prototype.setEditable=function(){if(!this._editable){this._editable=!0;var e=this,r=this;E(e,"leftDown",function(a){function s(t){l.destroy(),o(!0),r.executeListeners({name:"dragEnd",positions:t})}var l=new t.ScreenSpaceEventHandler(n._scene.canvas);l.setInputAction(function(t){var o,a=n._scene.camera.pickEllipsoid(t.endPosition,i);a?(o=a,e.position=o,r.executeListeners({name:"drag",positions:o})):s(a)},t.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction(function(t){s(n._scene.camera.pickEllipsoid(t.position,i))},t.ScreenSpaceEventType.LEFT_UP),o(!1)}),T(e)}function o(t){n._scene.screenSpaceCameraController.enableRotate=t}},e.PolylinePrimitive.prototype.setEditable=function(){if(!this.setEditMode){this.isPolygon=!1,this.asynchronous=!1,n.registerEditableShape(this),this.setEditMode=s;var e=this.width;this.setHighlighted=function(t){!0!==this._editMode&&(t?(n.setHighlighted(this),this.setWidth(2*e)):this.setWidth(e))},this.getExtent=function(){return t.Extent.fromCartographicArray(i.cartesianArrayToCartographicArray(this.positions))},T(this),this.setEditMode(!1)}},e.PolygonPrimitive.prototype.setEditable=function(){var e=this;e.asynchronous=!1;var i=n._scene;n.registerEditableShape(e),e.setEditMode=function(a){if(this._editMode!=a)if(n.disableAllHighlights(),a){if(n.setEdited(this),null==this._markers){var s=new o.BillboardGroup(n,g);r.billBoard.push(s);var l={dragHandlers:{onDrag:function(t,i){var r=e.custom;r[t]=v(i);var o=xp.algorithm.doubleArrow(r);e.positions=o.polygonalPoint,e.custom=o.controlPoint,e._createPrimitive=!0,s.updateBillboardsPositions(_(e.custom))},onDragEnd:function(t,i){e.executeListeners({name:"onEdited",positions:e.positions})}},tooltip:function(){return"拖动以钳击形状"}},h=e.custom;s.addBillboards(_(h),l),this._markers=s,this._globeClickhandler=new t.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var r=i.pick(t.position);console.log("PolygonPrimitive单击"),r&&r.primitive||e.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=a,T(e),e.setEditMode(!1)},e.TailedAttackPrimitive.prototype.setEditable=function(){var e=this;e.asynchronous=!1;var i=n._scene;n.registerEditableShape(e),e.setEditMode=function(a){if(this._editMode!=a)if(n.disableAllHighlights(),a){if(n.setEdited(this),null==this._markers){var s=new o.BillboardGroup(n,g);r.billBoard.push(s);var l={dragHandlers:{onDrag:function(t,i){var r=e.custom;r[t]=v(i);var o=xp.algorithm.tailedAttackArrow(r);e.positions=o.polygonalPoint,e.custom=o.controlPoint,e._createPrimitive=!0,s.updateBillboardsPositions(_(e.custom))},onDragEnd:function(t,i){e.executeListeners({name:"onEdited",positions:e.positions})}},tooltip:function(){return"拖动以改变形状"}},h=e.custom;s.addBillboards(_(h),l),this._markers=s,this._globeClickhandler=new t.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var r=i.pick(t.position);console.log("TailedAttackPrimitive单击"),r&&r.primitive||e.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=a,T(e),e.setEditMode(!1)},e.ExtentPrimitive.prototype.setEditable=function(){if(!this.setEditMode){var e=this,i=n._scene;n.registerEditableShape(e),e.asynchronous=!1,e.setEditMode=function(a){if(this._editMode!=a)if(n.disableAllHighlights(),a){if(n.setEdited(this),null==this._markers){var s=new o.BillboardGroup(n,g);r.billBoard.push(s);var l={dragHandlers:{onDrag:function(t,i){var r=v(i),o=v(s.getBillboard((t+1)%2).position),n=0==t?y(r,o):y(o,r);e.setExtent(n),s.updateBillboardsPositions(f(e.extent))},onDragEnd:function(t,i){e.executeListeners({name:"onEdited",extent:e.extent})}},tooltip:function(){return"拖动以改变此箭头形状"}};s.addBillboards(f(e.extent),l),this._markers=s,this._globeClickhandler=new t.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var r=i.pick(t.position);console.log("ExtentPrimitive单击"),r&&r.primitive||e.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=a,T(e),e.setEditMode(!1)}}},o.DrawHelperWidget=function(){return function(e,i){if(!t.defined(i.container))throw new t.DeveloperError("Container is required");b(i,{markerIcon:"./img/glyphicons_242_google_maps.png",polylineIcon:"./img/glyphicons_097_vector_path_line.png",polygonIcon:"./img/qianjijiantou.png",circleIcon:"./img/glyphicons_095_vector_path_circle.png",tailedAttackArrowIcon:"./img/gongjijiantou.png",extentIcon:"./img/zhijiaojiantou.png",clearIcon:"./img/glyphicons_067_cleaning.png",polylineDrawingOptions:d,polygonDrawingOptions:l,extentDrawingOptions:h,circleDrawingOptions:c});var o=this,n=document.createElement("DIV");function a(t,e,i,r){var o=document.createElement("DIV");o.className="button",o.title=i,n.appendChild(o),o.onclick=r;var a=document.createElement("SPAN");o.appendChild(a);var s=document.createElement("IMG");return s.src=e,a.appendChild(s),o}n.className="toolbar",i.container.appendChild(n);var s=e._scene;a(0,i.extentIcon,"点击以绘制直箭头",function(){e.startDrawingExtent({callback:function(t){o.executeListeners({name:"extentCreated",extent:t})}})}),a(0,i.polygonIcon,"点击以绘制钳击箭头",function(){e.startDrawingPolygon({callback:function(t,e){o.executeListeners({name:"polygonCreated",positions:t,custom:e})}})}),a(0,i.tailedAttackArrowIcon,"点击以绘制攻击箭头",function(){e.startDrawingTailedAttack({callback:function(t,e){o.executeListeners({name:"tailedAttackCreated",positions:t,custom:e})}})});var u=document.createElement("DIV");u.className="divider",n.appendChild(u),a(0,i.clearIcon,"Remove all primitives",function(){for(var t=r.primitives.length,e=r.billBoard.length,i=0;i<t;i++){var o=r.primitives.pop();o._globeClickhandler.destroy(),s.primitives.remove(o)}for(i=0;i<e;i++)r.billBoard.pop().remove()}),T(this)}}(),o.prototype.addToolbar=function(t,e){return e=C(e,{container:t}),new o.DrawHelperWidget(this,e)},o.DrawWidget=function(t){return function(t,e){var i=this;"extentCreated"==e&&t.startDrawingExtent({callback:function(t){i.executeListeners({name:"extentCreated",extent:t})}}),"polygonCreated"==e&&t.startDrawingPolygon({callback:function(t,e){i.executeListeners({name:"polygonCreated",positions:t,custom:e})}}),"tailedAttackCreated"==e&&t.startDrawingTailedAttack({callback:function(t,e){i.executeListeners({name:"tailedAttackCreated",positions:t,custom:e})}}),T(this)}}(),o.ClearWidget=function(){return function(){var t=drawHelper._scene,e=r.primitives.length,i=r.billBoard.length;if(0!=e&&r.primitives[e-1]._editMode){for(var o=0;o<1;o++){var n=r.primitives[e-1];n._globeClickhandler.destroy(),t.primitives.remove(n)}for(o=0;o<1;o++)r.billBoard[i-1].remove();r={billBoard:[],primitives:[]},T(this)}}}(),o.prototype.active=function(t){return new o.DrawWidget(this,t)},o.prototype.clear=function(){return new o.ClearWidget(this)};function w(t,e){if(null==t||"object"!=typeof t)return t;if(t.constructor!=Object&&t.constructor!=Array)return t;if(t.constructor==Date||t.constructor==RegExp||t.constructor==Function||t.constructor==String||t.constructor==Number||t.constructor==Boolean)return new t.constructor(t);e=e||new t.constructor;for(var i in t)e[i]=void 0===e[i]?w(t[i],null):e[i];return e}function b(t,e){var i;t=t||{};for(i in e)void 0===t[i]&&(t[i]=w(e[i]))}function C(t,e){var i,r=w(t);for(i in e)void 0===r[i]&&(r[i]=w(e[i]));return r}function E(t,e,i){t[e]=i}function T(t){t._listeners={},t.addListener=function(t,e){return this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._listeners[t].length},t.executeListeners=function(t,e){if(this._listeners[t.name]&&this._listeners[t.name].length>0)for(var i=0;i<this._listeners[t.name].length;i++)this._listeners[t.name][i](t);else e&&e(t)}}return o}()}(window.Cesium);var P={version:"1.0.0"};P.PlotUtils={},P.PlotUtils.distance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},P.PlotUtils.wholeDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=P.PlotUtils.distance(t[i],t[i+1]);return e},P.PlotUtils.getBaseLength=function(t){return Math.pow(P.PlotUtils.wholeDistance(t),.99)},P.PlotUtils.mid=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},P.PlotUtils.getCircleCenterOfThreePoints=function(t,e,i){var r=[(t[0]+e[0])/2,(t[1]+e[1])/2],o=[r[0]-t[1]+e[1],r[1]+t[0]-e[0]],n=[(t[0]+i[0])/2,(t[1]+i[1])/2],a=[n[0]-t[1]+i[1],n[1]+t[0]-i[0]];return P.PlotUtils.getIntersectPoint(r,o,n,a)},P.PlotUtils.getIntersectPoint=function(t,e,i,r){if(t[1]==e[1]){var o=(r[0]-i[0])/(r[1]-i[1]),n=o*(t[1]-i[1])+i[0],a=t[1];return[n,a]}if(i[1]==r[1]){var s=(e[0]-t[0])/(e[1]-t[1]);return[n=s*(i[1]-t[1])+t[0],a=i[1]]}return s=(e[0]-t[0])/(e[1]-t[1]),o=(r[0]-i[0])/(r[1]-i[1]),[n=s*(a=(s*t[1]-t[0]-o*i[1]+i[0])/(s-o))-s*t[1]+t[0],a]},P.PlotUtils.getAzimuth=function(t,e){var i,r=Math.asin(Math.abs(e[1]-t[1])/P.PlotUtils.distance(t,e));return e[1]>=t[1]&&e[0]>=t[0]?i=r+Math.PI:e[1]>=t[1]&&e[0]<t[0]?i=P.Constants.TWO_PI-r:e[1]<t[1]&&e[0]<t[0]?i=r:e[1]<t[1]&&e[0]>=t[0]&&(i=Math.PI-r),i},P.PlotUtils.getAngleOfThreePoints=function(t,e,i){var r=P.PlotUtils.getAzimuth(e,t)-P.PlotUtils.getAzimuth(e,i);return 0>r?r+P.Constants.TWO_PI:r},P.PlotUtils.isClockWise=function(t,e,i){return(i[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(i[0]-t[0])},P.PlotUtils.getPointOnLine=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]},P.PlotUtils.getCubicValue=function(t,e,i,r,o){var n=1-(t=Math.max(Math.min(t,1),0)),a=t*t,s=a*t,l=n*n,h=l*n;return[h*e[0]+3*l*t*i[0]+3*n*a*r[0]+s*o[0],h*e[1]+3*l*t*i[1]+3*n*a*r[1]+s*o[1]]},P.PlotUtils.getThirdPoint=function(t,e,i,r,o){var n=P.PlotUtils.getAzimuth(t,e),a=o?n+i:n-i,s=r*Math.cos(a),l=r*Math.sin(a);return[e[0]+s,e[1]+l]},P.PlotUtils.getArcPoints=function(t,e,i,r){var o,n,a=[],s=r-i;s=0>s?s+P.Constants.TWO_PI:s;for(var l=0;l<=P.Constants.FITTING_COUNT;l++){var h=i+s*l/P.Constants.FITTING_COUNT;o=t[0]+e*Math.cos(h),n=t[1]+e*Math.sin(h),a.push([o,n])}return a},P.PlotUtils.getBisectorNormals=function(t,e,i,r){var o=P.PlotUtils.getNormal(e,i,r),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]),a=o[0]/n,s=o[1]/n,l=P.PlotUtils.distance(e,i),h=P.PlotUtils.distance(i,r);if(n>P.Constants.ZERO_TOLERANCE)if(P.PlotUtils.isClockWise(e,i,r)){var c=t*l,d=i[0]-c*s,u=i[1]+c*a,p=[d,u];c=t*h;var g=[d=i[0]+c*s,u=i[1]-c*a]}else c=t*l,d=i[0]+c*s,u=i[1]-c*a,p=[d,u],c=t*h,d=i[0]-c*s,u=i[1]+c*a,g=[d,u];else d=i[0]+t*(e[0]-i[0]),u=i[1]+t*(e[1]-i[1]),p=[d,u],d=i[0]+t*(r[0]-i[0]),u=i[1]+t*(r[1]-i[1]),g=[d,u];return[p,g]},P.PlotUtils.getNormal=function(t,e,i){var r=t[0]-e[0],o=t[1]-e[1],n=Math.sqrt(r*r+o*o);r/=n,o/=n;var a=i[0]-e[0],s=i[1]-e[1],l=Math.sqrt(a*a+s*s);return[r+(a/=l),o+(s/=l)]},P.PlotUtils.getCurvePoints=function(t,e){for(var i=[P.PlotUtils.getLeftMostControlPoint(e)],r=0;r<e.length-2;r++){var o=e[r],n=e[r+1],a=e[r+2],s=P.PlotUtils.getBisectorNormals(t,o,n,a);i=i.concat(s)}var l=P.PlotUtils.getRightMostControlPoint(e);i.push(l);var h=[];for(r=0;r<e.length-1;r++){o=e[r],n=e[r+1],h.push(o);for(t=0;t<P.Constants.FITTING_COUNT;t++){var c=P.PlotUtils.getCubicValue(t/P.Constants.FITTING_COUNT,o,i[2*r],i[2*r+1],n);h.push(c)}h.push(n)}return h},P.PlotUtils.getLeftMostControlPoint=function(e){var i=e[0],r=e[1],o=e[2],n=P.PlotUtils.getBisectorNormals(0,i,r,o)[0],a=P.PlotUtils.getNormal(i,r,o);if(Math.sqrt(a[0]*a[0]+a[1]*a[1])>P.Constants.ZERO_TOLERANCE)var s=P.PlotUtils.mid(i,r),l=i[0]-s[0],h=i[1]-s[1],c=P.PlotUtils.distance(i,r),d=2/c,u=-d*h,p=d*l,g=u*u-p*p,m=2*u*p,f=p*p-u*u,v=n[0]-s[0],y=n[1]-s[1],_=s[0]+g*v+m*y,w=s[1]+m*v+f*y;else _=i[0]+t*(r[0]-i[0]),w=i[1]+t*(r[1]-i[1]);return[_,w]},P.PlotUtils.getRightMostControlPoint=function(e){var i=e.length,r=e[i-3],o=e[i-2],n=e[i-1],a=P.PlotUtils.getBisectorNormals(0,r,o,n)[1],s=P.PlotUtils.getNormal(r,o,n);if(Math.sqrt(s[0]*s[0]+s[1]*s[1])>P.Constants.ZERO_TOLERANCE)var l=P.PlotUtils.mid(o,n),h=n[0]-l[0],c=n[1]-l[1],d=P.PlotUtils.distance(o,n),u=2/d,p=-u*c,g=u*h,m=p*p-g*g,f=2*p*g,v=g*g-p*p,y=a[0]-l[0],_=a[1]-l[1],w=l[0]+m*y+f*_,b=l[1]+f*y+v*_;else w=n[0]+t*(o[0]-n[0]),b=n[1]+t*(o[1]-n[1]);return[w,b]},P.PlotUtils.getBezierPoints=function(t){if(t.length<=2)return t;for(var e=[],i=t.length-1,r=0;1>=r;r+=.01){for(var o=y=0,n=0;i>=n;n++){var a=P.PlotUtils.getBinomialFactor(i,n),s=Math.pow(r,n),l=Math.pow(1-r,i-n);o+=a*s*l*t[n][0],y+=a*s*l*t[n][1]}e.push([o,y])}return e.push(t[i]),e},P.PlotUtils.getBinomialFactor=function(t,e){return P.PlotUtils.getFactorial(t)/(P.PlotUtils.getFactorial(e)*P.PlotUtils.getFactorial(t-e))},P.PlotUtils.getFactorial=function(t){if(1>=t)return 1;if(2==t)return 2;if(3==t)return 6;if(4==t)return 24;if(5==t)return 120;for(var e=1,i=1;t>=i;i++)e*=i;return e},P.PlotUtils.getQBSplinePoints=function(t){if(t.length<=2)return t;var e=[],i=t.length-2-1;e.push(t[0]);for(var r=0;i>=r;r++)for(var o=0;1>=o;o+=.05){for(var n=y=0,a=0;2>=a;a++){var s=P.PlotUtils.getQuadricBSplineFactor(a,o);n+=s*t[r+a][0],y+=s*t[r+a][1]}e.push([n,y])}return e.push(t[t.length-1]),e},P.PlotUtils.getQuadricBSplineFactor=function(t,e){return 0==t?Math.pow(e-1,2)/2:1==t?(-2*Math.pow(e,2)+2*e+1)/2:2==t?Math.pow(e,2)/2:0},P.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},function(t){"use strict";var e=t.MeasureAreaWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.entityNames=[],this.labelNames=[]};function i(e,i,r,o){var n=e.add(new t.LabelCollection);n.name="result_labelArea"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0}),n.get(n.length-1).position=r[r.length-1]}function r(t,e){for(var i=0;i<e.length;i++)void 0!==e.get(i).name&&e.get(i).name.indexOf(t)>-1&&(e.remove(e.get(i)),i--)}function o(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name.indexOf(t)>-1&&(e.remove(i[r]),r--)}e.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r,o=this,n=[];this._array_=n,this._polylines_=e,this._labels_=i,this.handler.setInputAction(function(i){o.lastP=i;var a=o.camera.getPickRay(i.position),s=o.scene.globe.pick(a,o.scene);s&&(n.push(s),1==n.length&&((e=o.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=o.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=o.color,e.get(e.length-1).positions=n),n.length>=3&&(e.get(e.length-1).positions=n,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&o.measureEnd()),o._polylines_=e,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&((r=o.primitives.add(new t.PointPrimitiveCollection)).name="draw_point",r.add({position:s,color:t.Color.WHITE,outlineColor:t.Color.RED,outlineWidth:1,pixelSize:5})))},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(r){if(!/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)){var a=o.camera.getPickRay(r.endPosition),s=o.scene.globe.pick(a,o.scene);if(!s)return void(i&&(o.primitives.remove(i),i=null));if(n.length>=1){var l=n.concat();l.push(s),e.get(e.length-1).positions=l}i?i.get(i.length-1).position=s:((i=o.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0}),i.get(i.length-1).position=s),o._labels_=i}},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){o.measureEnd(),o.handler=o.handler&&o.handler.destroy(),o.viewer.canvas.style.cursor="default"},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.selectFeatures=function(e){this.handler=this.handler&&this.handler.destroy(),this.handler=new t.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction(function(e){var r=i.viewer.scene.pick(new t.Cartesian2(e.position.x,e.position.y));if(void 0!=r&&void 0!=r.id&&void 0!=r.id.polygon){r.id.polygon.material.color=t.Color.CHARTREUSE;var o=r.id.name,n=o.replace(/draw_polygon/,"result_labelArea");i.entityNames.push(o),i.labelNames.push(n)}},t.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.delete=function(){this.handler=this.handler&&this.handler.destroy();for(var t=0;t<this.entityNames.length;t++)o(this.entityNames[t],this.viewer.entities);for(var e=0;e<this.labelNames.length;e++)r(this.labelNames[e],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[]},e.prototype.measureEnd=function(e){if(void 0!=this._array_&&0!=this._array_.length){this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),e||(e=this.lastP);var r=this.camera.getPickRay(e.position),o=this.scene.globe.pick(r,this.scene);if(o){this._array_.push(o),this._polylines_.get(this._polylines_.length-1).material.uniforms.color=t.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({name:"draw_polygon"+this.count,polygon:{hierarchy:{positions:this._array_},material:this.color}});for(var n=[],a=0;a<this._array_.length;a++){var s=t.Cartographic.fromCartesian(this._array_[a]),l=t.Math.toDegrees(s.longitude),h=t.Math.toDegrees(s.latitude);n.push([l,h])}n.push(n[0]);var c,d=turf.polygon([n]),u=turf.area(d);c=u<1e6?"总面积："+u.toFixed(2)+"m²":"总面积："+(u/1e6).toFixed(2)+"km²",/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?this.primitives.length>4?(this.primitives.remove(this.primitives.get(this.primitives.length-2)),i(this.primitives,c,this._array_)):i(this.primitives,c,this._array_):(i(this.primitives,c,this._array_,this.count),this.count++)}}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelArea",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),o("draw_polygon",this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.MeasureDistanceWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=e.mode?e.mode:1,this.count=0,this.tags=[]};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=0;i<e.length;i++)e.get(i).tag==t&&(e.remove(e.get(i)),i--)}function o(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].tag==t&&(e.remove(i[r]),r--)}e.prototype.activate=function(){var e=this;e.count++,this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var i,r,o,n=[];this._array_=n,this._polylines_=i,this._labels_=r,this.handler.setInputAction(function(r){e.lastP=r;var a=e.camera.getPickRay(r.position),s=e.scene.globe.pick(a,e.scene);if(s){var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;n.push(h),n.push(c),n.push(d),3==n.length&&((i=e.primitives.add(new t.PolylineCollection)).tag=e.mode+"_"+e.count,i.name="draw_polyline",i.add({polyline:{}}),i.get(i.length-1).width=e.lineWidth,i.get(i.length-1).material.uniforms.color=e.color,i.get(i.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(n)),n.length>3&&(i.get(i.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(n)),e._polylines_=i,(o=e.primitives.add(new t.PointPrimitiveCollection)).tag=e.mode+"_"+e.count,o.name="draw_point",o.add({position:s,color:t.Color.WHITE,outlineColor:t.Color.RED,outlineWidth:1,pixelSize:e.pixelSize}),e.flag=!1,e.measureEnd(r)}},t.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(o){var a=e.camera.getPickRay(o.endPosition),s=e.scene.globe.pick(a,e.scene);if(s){var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))r=null;else{if(n.length>=3){var u=n.concat();u.push(h),u.push(c),u.push(d),i.get(i.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(u)}r||((r=e.primitives.add(new t.LabelCollection)).name="draw_label",r.tag=e.mode+"_"+e.count,r.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0}),r.get(r.length-1).position=t.Cartesian3.fromDegrees(h,c,d))}e._labels_=r}else r&&(e.primitives.remove(r),r=null)},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){e.flag=!0,i=e.lastP;var r=e.camera.getPickRay(i.position),n=e.scene.globe.pick(r,e.scene);if(n){var a=t.Cartographic.fromCartesian(n),s=t.Math.toDegrees(a.longitude),l=t.Math.toDegrees(a.latitude),h=a.height;(o=e.primitives.add(new t.PointPrimitiveCollection)).tag=e.mode+"_"+e.count,o.name="draw_point",o.add({position:n,color:t.Color.WHITE,outlineColor:t.Color.RED,outlineWidth:1,pixelSize:e.pixelSize}),e._array_.push(s),e._array_.push(l),e._array_.push(h),e.measureEnd(i),e.handler=e.handler&&e.handler.destroy(),e.viewer.canvas.style.cursor="default",e._array_=[],e._polylines_=null}},t.ScreenSpaceEventType.RIGHT_CLICK)},e.prototype.measureEnd=function(e){if(void 0!=this._array_&&0!=this._array_.length){if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))this._array_=this._array_;else if(!e){e=this.lastP;var i=this.camera.getPickRay(e.position),r=this.scene.globe.pick(i,this.scene);if(!r)return;var o=t.Cartographic.fromCartesian(r),n=t.Math.toDegrees(o.longitude),a=t.Math.toDegrees(o.latitude),s=o.height;this._array_[this._array_.length-1]==s&&this._array_[this._array_.length-2]==a&&this._array_[this._array_.length-3]==n?this._array_=this._array_:(this._array_.push(n),this._array_.push(a),this._array_.push(s))}this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var l=this.mode;if(2==this.mode){var h=function(e,i){for(var r=[],o=0;o<e.length/3-1;o++){var n=3*o,a=e[n],s=e[n+1],l=e[n+2],h=e[n+3],c=e[n+4],d=e[n+5];r.push(a),r.push(s),r.push(l);for(var u=0;u<100;u++){var p={longitude:t.Math.toRadians(a),latitude:t.Math.toRadians(s),height:l},g={longitude:t.Math.toRadians(h),latitude:t.Math.toRadians(c),height:d},m=t.Math.lerp(p.longitude,g.longitude,.01*(u+1)),f=t.Math.lerp(p.latitude,g.latitude,.01*(u+1)),v={longitude:m,latitude:f},y=i.globe.getHeight(v);r.push(t.Math.toDegrees(m)),r.push(t.Math.toDegrees(f)),r.push(y)}r.push(h),r.push(c),r.push(d)}return r}(this._array_,this.scene);this._polylines_.get(this._polylines_.length-1).material.uniforms.color=t.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({tag:this.mode+"_"+this.count,name:"draw_polyline",polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(h),width:this.lineWidth,material:this.color}})}var c,d,u,p,g,m,f,v=t.Cartesian3.fromDegreesArrayHeights(this._array_),y=0,_=new t.EllipsoidGeodesic;if(1==l){for(var w=1;w<v.length;w++){var P=t.Cartographic.fromCartesian(v[w-1]),b=t.Math.toDegrees(P.longitude),C=t.Math.toDegrees(P.latitude),E=t.Cartographic.fromCartesian(v[w]),T=t.Math.toDegrees(E.longitude),A=t.Math.toDegrees(E.latitude),S=turf.point([b,C]),M=turf.point([T,A]);y+=turf.distance(S,M)}c=0==y?"起点":y>0&&y<1?this.flag?"总长："+(1e3*y).toFixed(2)+"m":(1e3*y).toFixed(2)+"m":this.flag?"总长："+y.toFixed(2)+"km":y.toFixed(2)+"km"}else if(2==l){for(w=1;w<v.length;w++){var x=t.Cartographic.fromCartesian(v[w-1]),I=t.Cartographic.fromCartesian(v[w]);_.setEndPoints(x,I),y+=Math.round(_.surfaceDistance),y=Number(y)}c=0==y?"起点":y>0&&y<1e3?this.flag?"总长："+y.toFixed(2)+"m":y.toFixed(2)+"m":this.flag?"总长："+(y/1e3).toFixed(2)+"km":(y/1e3).toFixed(2)+"km"}d=l,u=this.count,p=this.primitives,g=c,m=v,(f=p.add(new t.LabelCollection)).name="result_label",f.tag=d+"_"+u,f.add({text:g,font:"16px sans-serif",showBackground:!0,pixelOffset:new t.Cartesian2(10,10)}),f.get(f.length-1).position=m[m.length-1]}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_point",this.primitives),i("result_label",this.primitives),i("draw_label",this.primitives),i("draw_polyline",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_polyline",this.viewer.entities)},e.prototype.selectFeatures=function(){var e=this;this.handler||(this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(i){var r=viewer.scene.pick(i.position);r&&(r.primitive._polylineCollection&&(e.tags.push(r.primitive._polylineCollection.tag),r.primitive.material.uniforms.color=t.Color.YELLOW.withAlpha(.5)),r.id&&(e.tags.push(r.id.tag),r.id._polyline.material.color=t.Color.YELLOW.withAlpha(.5)))},t.ScreenSpaceEventType.LEFT_CLICK))},e.prototype.delete=function(t){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&this.tags.length>0)for(var e=0;e<this.tags.length;e++)r(this.tags[e],this.primitives),o(this.tags[e],this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.MeasureElevationWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.YELLOW,this.pixelSize=e.pixelSize?e.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.tags=[]};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=0;i<e.length;i++)e.get(i).tag==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){this.count++,this.handler&&(this.handler=this.handler&&this.handler.destroy()),this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.position),s=r.scene.globe.pick(a,r.scene);if(s){o[0]=s,e?e.removeAll():((e=r.primitives.add(new t.PointPrimitiveCollection)).tag=r.count,e.name="draw_point"),e.add({position:s,color:r.color,pixelSize:r.pixelSize}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null);var l,h,c,d,u,p="高程值："+t.Cartographic.fromCartesian(o[0]).height.toFixed(2)+"m";l=r.primitives,h=p,c=o,d=r.count,(u=l.add(new t.LabelCollection)).name="result_label",u.tag=d,u.add({text:h,font:"16px sans-serif",showBackground:!0,pixelOffset:new t.Cartesian2(6,2)}),u.get(u.length-1).position=c[c.length-1]}},t.ScreenSpaceEventType.LEFT_DOWN)},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("result_label",this.primitives),i("draw_point",this.primitives)},e.prototype.selectFeatures=function(){var e=this;this.handler||(this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(i){var r=viewer.scene.pick(i.position);r&&(console.log(r),r.primitive&&(e.tags.push(r.collection.tag),r.primitive.color=t.Color.YELLOW.withAlpha(.5)))},t.ScreenSpaceEventType.LEFT_CLICK))},e.prototype.delete=function(t){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&this.tags.length>0)for(var e=0;e<this.tags.length;e++)r(this.tags[e],this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.MeasureHeightWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||function(){},this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]};function i(e,i,r,o){var n=e.add(new t.LabelCollection);n.name="result_labelHeight"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0}),n.get(n.length-1).position=t.Cartesian3.fromDegrees(r[r.length-3],r[r.length-2],r[r.length-1])}function r(t,e){for(var i=0;i<e.length;i++)void 0!==e.get(i).name&&e.get(i).name.indexOf(t)>-1&&(e.remove(e.get(i)),i--)}function o(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this._array_=o,this._polylines_=e,this._labels_=void 0,this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.position),s=r.scene.globe.pick(a,r.scene);if(s){var l=t.Cartographic.fromCartesian(s),h=t.Math.toDegrees(l.longitude),c=t.Math.toDegrees(l.latitude),d=l.height;o.length>0&&(9==o.length&&(o[3]=h,o[4]=c,o[5]=d,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),(i=r.primitives.add(new t.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:s,color:r.color,pixelSize:r.pixelSize}),r._array_=o,r.measureEnd()),0==o.length&&(o.push(h),o.push(c),o.push(d),o.push(h),o.push(c),o.push(d),o.push(h),o.push(c),o.push(d),(e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline"+r.count,e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o),(i=r.primitives.add(new t.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:s,color:r.color,pixelSize:r.pixelSize}))}},t.ScreenSpaceEventType.LEFT_CLICK)}},e.prototype.selectFeatures=function(e){this.handler=this.handler&&this.handler.destroy(),this.handler=new t.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction(function(e){var r=i.viewer.scene.pick(e.position);if(void 0!=r&&void 0!=r.collection&&void 0!=r.collection.name&&void 0!=r.primitive&&void 0!=r.primitive.material){r.primitive.material.uniforms.color=t.Color.CHARTREUSE;var o=r.collection.name,n=o.replace(/draw_polyline/,"result_labelHeight"),a=o.replace(/draw_polyline/,"draw_point");i.entityNames.push(o),i.labelNames.push(n),i.pointNames.push(a)}},t.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.delete=function(t){this.handler=this.handler&&this.handler.destroy();for(var e=0;e<this.entityNames.length;e++)o(this.entityNames[e],this.primitives);for(var i=0;i<this.labelNames.length;i++)o(this.labelNames[i],this.primitives);for(i=0;i<this.pointNames.length;i++)o(this.pointNames[i],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]},e.prototype.measureEnd=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var t=1e3*turf.distance(turf.point([this._array_[0],this._array_[1]]),turf.point([this._array_[3],this._array_[4]]));(o=[]).push((this._array_[0]+this._array_[3])/2),o.push((this._array_[1]+this._array_[4])/2),this._array_[2]>=this._array_[5]?o.push(this._array_[5]):o.push(this._array_[2]),e=t<1e3?"水平距离："+t.toFixed(2)+"m":"水平距离："+(t/1e3).toFixed(2)+"km",i(this.primitives,e,o,this.count);var e,r=Math.abs(this._array_[2]-this._array_[5]),o=[];this._array_[2]>=this._array_[5]?(o.push(this._array_[0]),o.push(this._array_[1])):(o.push(this._array_[3]),o.push(this._array_[4])),o.push((this._array_[2]+this._array_[5])/2),e=r<1e3?"垂直高度："+r.toFixed(2)+"m":"垂直高度："+(r/1e3).toFixed(2)+"km",i(this.primitives,e,o,this.count),(o=[]).push((this._array_[0]+this._array_[3])/2),o.push((this._array_[1]+this._array_[4])/2),o.push((this._array_[2]+this._array_[5])/2);var n=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));e=n<1e3?"空间距离："+n.toFixed(2)+"m":"空间距离："+(n/1e3).toFixed(2)+"km",i(this.primitives,e,o,this.count),this.count++,this.callback(t,r,n,this._array_)},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelHeight",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives)}}(window.Cesium),function(t){"use strict";t.Map=function(e,i){if((i=i||{}).baseLayerPicker=t.defaultValue(i.baseLayerPicker,!1),i.timeline=t.defaultValue(i.timeline,!1),i.animation=t.defaultValue(i.animation,!1),i.homeButton=t.defaultValue(i.homeButton,!1),i.navigationHelpButton=t.defaultValue(i.navigationHelpButton,!1),i.orderIndependentTranslucency=t.defaultValue(i.orderIndependentTranslucency,!1),i.sceneMode=t.defaultValue(i.sceneMode,t.SceneMode.SCENE3D),i.scene3DOnly=t.defaultValue(i.scene3DOnly,!0),i.maxLevel=t.defaultValue(i.maxLevel,25),i.geocoder=t.defaultValue(i.geocoder,!1),i.fullscreenButton=t.defaultValue(i.fullscreenButton,!1),!t.defined(i.imageryProvider)){var r=function(){for(var t="",e=new RegExp("(^|(.*?\\/))(Cesium.js)(\\?|$)"),i=document.getElementsByTagName("script"),r=0,o=i.length;r<o;r++){var n=i[r].getAttribute("src");if(n){var a=n.match(e);if(a){t=a[1];break}}}return t}(),o=new t.SingleTileImageryProvider({url:r+"Assets/images/Earth.jpg",rectangle:t.Rectangle.fromDegrees(-180,-90,180,90)});i.imageryProvider=o}return new t.Viewer(e,i)}}(window.Cesium),function(t){"use strict";var e=t.SingleBuildingWidget=function(e,i,r){this.viewer=e.viewer,this.scene=this.viewer.scene,this.globe=this.viewer.scene.globe,this.data=e.data?e.data:{},this.entities=this.viewer.entities,this.callback_click=i||function(){},this.callback_move=r||function(){},this.show=void 0===e.show||e.show,this.fillColor=e.fillColor?e.fillColor:t.Color.CORNFLOWERBLUE.withAlpha(.3),this.outline=void 0!==e.outline&&e.outline,this.outlineColor=e.outlineColor?e.outlineColor:t.Color.WHITE,this.highlightColor_click=e.highlightColor_click?e.highlightColor_click:t.Color.YELLOW.withAlpha(.3),this.highlightColor_move=e.highlightColor_move?e.highlightColor_move:t.Color.WHITE.withAlpha(.2),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.handler=new t.ScreenSpaceEventHandler(this.viewer.canvas)};function i(t,e){var i=null,r=t.drillPick(e);if(r&&r.length>0){for(var o=[],n=0;n<r.length;n++)r[n].id&&"GEO_EXTRUDE_POLYGON"==r[n].id.name&&o.push(r[n].id);if(o&&o.length>0){i=o[0];for(var a=0;a<o.length-1;a++)i=i.id<o[a+1].id?o[a+1]:i}}return i}t.defineProperties(e.prototype,{show:{set:function(t){this._show=t;for(var e=this.entities.values,i=0;i<e.length;i++)"GEO_EXTRUDE_POLYGON"==e[i].name&&(e[i].show=t)},get:function(){return this._show}}}),e.prototype.extrudeToBuilding=function(){if(this.clear(),this.data&&this.data.geometry){var e=0;this.data.properties.baseHeight?e=this.data.properties.baseHeight:(e=this.globe.getHeight({longitude:t.Math.toRadians(this.data.geometry.coordinates[0][0][0]),latitude:t.Math.toRadians(this.data.geometry.coordinates[0][0][1])}))||console.error("地形还未准备好！");for(var i=this.data.properties.levels,r=[],o=0;o<this.data.geometry.coordinates[0].length;o++)r.push(this.data.geometry.coordinates[0][o][0]),r.push(this.data.geometry.coordinates[0][o][1]);for(var n=0,a=0;a<i.length;a++){var s=e+n,l=s+i[a],h=new t.Entity({id:a+1,name:"GEO_EXTRUDE_POLYGON",description:{data:this.data,level:a+1},polygon:{hierarchy:t.Cartesian3.fromDegreesArray(r),fill:!0,material:this.fillColor,outline:this.outline,outlineColor:this.outlineColor,outlineWidth:1,height:s,extrudedHeight:l,show:this.show,closeTop:!0,closeBottom:!0}});n+=i[a],this.entities.add(h)}}},e.prototype.activate=function(){var e=this;e.handler.setInputAction(function(t){var r=i(e.scene,t.position);if(r){if(e.callback_click(r),e._INTERSECTED_FLOOR&&e._INTERSECTED_FLOOR!=r&&(e._INTERSECTED_FLOOR.polygon.material=e.fillColor),e._INTERSECTED_FLOOR=r,e._INTERSECTED_FLOOR3&&e._INTERSECTED_FLOOR3.polygon.material._color._value.equals(e.highlightColor_click)&&(e._INTERSECTED_FLOOR3.polygon.material=e.fillColor),e._INTERSECTED_FLOOR.polygon.material._color._value.equals(e.highlightColor_click))return;e._INTERSECTED_FLOOR.polygon.material=e.highlightColor_click}},t.ScreenSpaceEventType.LEFT_CLICK),e.handler.setInputAction(function(t){var r=i(e.scene,t.endPosition);if(r){if(e.callback_move(r),e._INTERSECTED_FLOOR2&&e._INTERSECTED_FLOOR2!=r&&(e._INTERSECTED_FLOOR2.polygon.material=e.fillColor),e._INTERSECTED_FLOOR2=r,e._INTERSECTED_FLOOR&&e._INTERSECTED_FLOOR.polygon.material._color._value.equals(e.fillColor)&&(e._INTERSECTED_FLOOR.polygon.material=e.highlightColor_click),e._INTERSECTED_FLOOR2.polygon.material._color._value.equals(e.highlightColor_move))return;e._INTERSECTED_FLOOR2.polygon.material=e.highlightColor_move}},t.ScreenSpaceEventType.MOUSE_MOVE)},e.prototype.highlightFloor=function(t){if(this.data&&this.data.geometry&&this._show){var e=this.entities.getById(t);this._INTERSECTED_FLOOR3&&this._INTERSECTED_FLOOR3!=e&&(this._INTERSECTED_FLOOR3.polygon.material=this.fillColor),this._INTERSECTED_FLOOR3=e,this._INTERSECTED_FLOOR3.polygon.material=this.highlightColor_click}},e.prototype.clear=function(){for(var t=this.entities.values,e=0;e<t.length;e++)"GEO_EXTRUDE_POLYGON"==t[e].name&&(this.entities.remove(t[e]),e--)},e.prototype.deActivate=function(){this.handler.removeInputAction(t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.destroy=function(){this.clear(),this.handler=this.handler&&this.handler.destroy(),this.viewer=void 0,this.data=void 0,this.fillColor=void 0,this.outlineColor=void 0,this.highlightColor_click=void 0,this.highlightColor_move=void 0,this._INTERSECTED_FLOOR=void 0,this._INTERSECTED_FLOOR2=void 0}}(window.Cesium),function(t){"use strict";var e=t.VisibilityAnalysisWidget=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=e||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=0;i<e._entities._array.length;i++)e._entities._array[i].name==t&&(e.remove(e._entities._array[i]),i--)}e.prototype.activate=function(){this.scene.pickTranslucentDepth=!0,this.scene.globe.depthTestAgainstTerrain=!0,this.viewer.canvas.style.cursor="crosshair";var e,r=null,o=null,n=null,a=null,s=null,l=null,h=[],c=[],d=[],u=[],p=[],g=[],m=[],f=(u=[],!0),v=null,y=[],_=[],w=0,P=0,b=null,C=null,E=null,T=!0,A=this;this.labels=e;var S=!0;A.newAdd=S,this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(e){var S=A.camera.getPickRay(e.position),M=A.scene.globe.pick(S,A.scene),x=t.Cartographic.fromCartesian(M);if(T){r=t.Math.toDegrees(x.longitude).toFixed(8),o=t.Math.toDegrees(x.latitude).toFixed(8),n=x.height,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)||"draw_labelTip"==A.labels.name&&i("draw_labelTip",A.primitives);var I={name:"VisibilityAnalysis_point",position:t.Cartesian3.fromDegrees(parseFloat(r),parseFloat(o),parseFloat(n)),billboard:{image:"/geomap-api/JsCesuimDemo/resource/images/common/startPoint.png",scale:.2,verticalOrigin:t.VerticalOrigin.BOTTOM}};A.viewer.entities.add(I),T=!1}else{/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)||"draw_labelTip"==A.labels.name&&i("draw_labelTip",A.primitives),a=t.Math.toDegrees(x.longitude).toFixed(8),s=t.Math.toDegrees(x.latitude).toFixed(8),l=x.height;var k={name:"VisibilityAnalysis_point",position:t.Cartesian3.fromDegrees(parseFloat(a),parseFloat(s),parseFloat(l)),billboard:{image:"/geomap-api/JsCesuimDemo/resource/images/common/endPoint.png",scale:.2,verticalOrigin:t.VerticalOrigin.BOTTOM}};A.viewer.entities.add(k);for(var R=0;R<=1e3;R++)h[R]=parseFloat(r)+parseFloat(R*(a-r)/1e3),c[R]=parseFloat(o)+parseFloat(R*(s-o)/1e3),d[R]=parseFloat(n)+parseFloat(R*(l-n)/1e3),m[R]={longitude:t.Math.toRadians(h[R]),latitude:t.Math.toRadians(c[R])},u.push(A.scene.globe.getHeight(m[R])),p.push(t.Cartographic.fromDegrees(h[R],c[R],d[R])),g.push(t.Cartographic.fromDegrees(h[R],c[R],d[R]));for(R=1;R<=1001;R++){var D=d[R-1];u[R-1]-D>.5&&(R=1001,f=!1)}if(1==f){var O=t.Ellipsoid.WGS84.cartographicArrayToCartesianArray(g);A.viewer.entities.add({name:"VisibilityAnalysis_polyline",polyline:{positions:O,width:4,material:t.Color.GREEN}});v="通视"}else{for(var L=1;L<=1001;L++){var F=d[L-1],B=u[L-1],H=u[L],U=d[L];F>=B?U<H&&(y[w]=L,w++):U>=H&&(_[P]=L,P++)}var N=g.slice(0,y[0]),W=g.slice(y[0]),G=t.Ellipsoid.WGS84.cartographicArrayToCartesianArray(N),z=(A.viewer.entities.add({name:"VisibilityAnalysis_polyline",polyline:{positions:G,width:4,material:t.Color.GREEN}}),t.Ellipsoid.WGS84.cartographicArrayToCartesianArray(W));A.viewer.entities.add({name:"VisibilityAnalysis_polyline",polyline:{positions:z,width:4,material:t.Color.RED}});A.scene.globe.depthTestAgainstTerrain=!1,v="不通视"}b=turf.distance(turf.point([r,o]),turf.point([a,s])),C=Math.abs(l-n)/1e3,E=Math.sqrt(b*b+C*C);var V="                     通视分析\n起点坐标:"+parseFloat(r).toFixed(3)+"°,"+parseFloat(o).toFixed(3)+"°,"+parseFloat(n/1e3).toFixed(3)+"Km\n终点坐标:"+parseFloat(a).toFixed(3)+"°,"+parseFloat(s).toFixed(3)+"°,"+parseFloat(l/1e3).toFixed(3)+"Km\n水平距离:"+parseFloat(b).toFixed(3)+"Km\n垂直距离:"+parseFloat(C).toFixed(3)+"Km\n空间距离:"+parseFloat(E).toFixed(3)+"Km\n空间可视:"+v,q=A.primitives.add(new t.LabelCollection);q.name="VisibilityAnalysis_label",q.add({text:V,font:"16px sans-serif",showBackground:!0,scaleByDistance:new t.NearFarScalar(0,2,1e5,0),pixelOffset:new t.Cartesian2(12,-5)}),q.get(q.length-1).position=t.Cartesian3.fromDegrees(a,s,l+20),A.handler.destroy(),A.viewer.canvas.style.cursor="default"}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)){var r=A.camera.getPickRay(i.endPosition),o=A.scene.globe.pick(r,A.scene);if(o){var n=t.Cartographic.fromCartesian(o),a=t.Math.toDegrees(n.longitude),s=t.Math.toDegrees(n.latitude),l=n.height;T?A.labels?e.get(e.length-1).position=t.Cartesian3.fromDegrees(a,s,l):((e=A.primitives.add(new t.LabelCollection)).name="draw_labelTip",e.add({text:"左键单击选择观察点",font:"16px sans-serif",showBackground:!0,backgroundColor:t.Color.MEDIUMSPRINGGREEN}),e.get(e.length-1).position=t.Cartesian3.fromDegrees(a,s,l),A.labels=e):"draw_labelTip"==A.labels.name&&A.newAdd?((e=A.primitives.add(new t.LabelCollection)).name="draw_labelTip",e.add({text:"左键单击选择目标点",font:"16px sans-serif",showBackground:!0,backgroundColor:t.Color.PALEVIOLETRED}),e.get(e.length-1).position=t.Cartesian3.fromDegrees(a,s,l),A.labels=e,S=!1,A.newAdd=S):e.get(e.length-1).position=t.Cartesian3.fromDegrees(a,s,l)}else e&&(A.primitives.remove(e),e=null)}},t.ScreenSpaceEventType.MOUSE_MOVE)},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("VisibilityAnalysis_label",this.primitives),r("VisibilityAnalysis_polyline",this.entities),r("VisibilityAnalysis_point",this.entities),r("draw_labelTip",this.entities)}}(window.Cesium),function(t){"use strict";t.FlyAround=function(e){this.viewer=e.viewer,this.direct=e.direct,this.pitch=e.pitch,this.height=e.height,this.distance=e.distance,this.lon=e.lon,this.lat=e.lat,this.isFlying=e.isFlying,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.center=new t.Cartesian3,this.deltaHeight=0,this.deltaRadians=t.Math.toRadians(1),this.deltaDistance=0,this.keyEvent()},t.FlyAround.prototype.play=function(e,i){var r=this,o=this.camera.heading,n=t.Math.toRadians(-30);this.scene.preRender.addEventListener(function(a,s){if(r.isFlying){var l=o+=t.Math.toRadians(speed);r.direct=t.Math.toDegrees(l).toFixed(1),r.pitch=t.Math.toDegrees(n).toFixed(1),r.height=(i[2]+r.deltaHeight).toFixed(1),r.distance=(e+r.deltaDistance).toFixed(1),r.camera.setView({destination:t.Cartesian3.fromDegrees(i[0],i[1],i[2]+r.deltaHeight),orientation:{heading:l,pitch:n}}),r.camera.moveBackward(e+r.deltaDistance)}})},t.FlyAround.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.play,this)},t.FlyAround.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.scene.postRender.addEventListener(this.play,this)):this.viewer.scene.postRender.removeEventListener(this.play,this)},t.FlyAround.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption)},t.FlyAround.prototype.keyEvent=function(){var t=this;document.addEventListener("keydown",function(e){switch(e.keyCode){case 40:e.shiftKey?t.deltaHeight-=10:t.pitch-=t.deltaRadians;break;case 38:e.shiftKey?t.deltaHeight+=10:t.pitch+=t.deltaRadians;break;case 39:e.shiftKey||(t.deltaDistance-=50);break;case 37:e.shiftKey||(t.deltaDistance+=50)}})}}(window.Cesium),function(t){"use strict";t.FreeFlight=function(e){this.viewer=e.viewer,this.direct=e.direct,this.pitch=e.pitch,this.roll=e.roll,this.height=e.height,this.speed=e.speed,this.lon=e.lon,this.lat=e.lat,this.planePrimitive=e.planePrimitive,this.hpRoll=e.hpRoll,this.fromBehind=e.fromBehind,this.isFlying=e.isFlying,this.position=e.position,this.fixedFrameTransform=e.fixedFrameTransform,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.pathPosition=new t.SampledPositionProperty,this.speedVector=new t.Cartesian3,this.center=new t.Cartesian3,this.hpRange=new t.HeadingPitchRange,this.deltaRadians=t.Math.toRadians(3),this.init(),this.keyEvent()},t.FreeFlight.prototype.init=function(){var e=this,i=this.scene.screenSpaceCameraController,r=0;this.planePrimitive.readyPromise.then(function(o){o.activeAnimations.addAll({speedup:.5,loop:t.ModelAnimationLoop.REPEAT}),r=2*Math.max(o.boundingSphere.radius,e.camera.frustum.near),i.minimumZoomDistance=.5*r,t.Matrix4.multiplyByPoint(o.modelMatrix,o.boundingSphere.center,e.center);var n=t.Math.toRadians(230),a=t.Math.toRadians(-20);e.hpRange.heading=n,e.hpRange.pitch=a,e.hpRange.range=50*r,e.camera.lookAt(e.center,e.hpRange)}),viewer.entities.add({position:this.pathPosition,name:"path",path:{show:!0,leadTime:0,trailTime:60,width:2,resolution:1,material:new t.PolylineGlowMaterialProperty({glowPower:.3,color:t.Color.PALEGOLDENROD})}})},t.FreeFlight.prototype.animation=function(){if(this.isFlying){this.direct=t.Math.toDegrees(this.hpRoll.heading).toFixed(1),this.pitch=t.Math.toDegrees(this.hpRoll.pitch).toFixed(1),this.roll=t.Math.toDegrees(this.hpRoll.roll).toFixed(1),this.speed=this.speed,this.speedVector=t.Cartesian3.multiplyByScalar(t.Cartesian3.UNIT_X,this.speed/10,this.speedVector);var e=t.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.speedVector,this.position);this.pathPosition.addSample(t.JulianDate.now(),e),t.Transforms.headingPitchRollToFixedFrame(e,this.hpRoll,t.Ellipsoid.WGS84,this.fixedFrameTransform,this.planePrimitive.modelMatrix);var i=t.Cartographic.fromCartesian(e);this.lon=t.Math.toDegrees(i.longitude),this.lat=t.Math.toDegrees(i.latitude),this.height=i.height,this.fromBehind&&(t.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.planePrimitive.boundingSphere.center,this.center),this.hpRange.heading=this.hpRoll.heading,this.hpRange.pitch=this.hpRoll.pitch,this.camera.lookAt(this.center,this.hpRange))}},t.FreeFlight.prototype.play=function(){this.viewer.scene.postRender.addEventListener(this.animation,this)},t.FreeFlight.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.FreeFlight.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.FreeFlight.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.scene.primitives.removeAll(),document.removeEventListener("keydown",this.keydownOption)},t.FreeFlight.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",function(i){switch(i.keyCode){case 40:i.shiftKey?e.speed=Math.max(--e.speed,1):(e.hpRoll.pitch-=e.deltaRadians,e.hpRoll.pitch<-t.Math.TWO_PI&&(e.hpRoll.pitch+=t.Math.TWO_PI));break;case 38:i.shiftKey?e.speed=Math.min(++e.speed,100):(e.hpRoll.pitch+=e.deltaRadians,e.hpRoll.pitch>t.Math.TWO_PI&&(e.hpRoll.pitch-=t.Math.TWO_PI));break;case 39:i.shiftKey?(e.hpRoll.roll+=this.deltaRadians,e.hpRoll.roll>t.Math.TWO_PI&&(e.hpRoll.roll-=t.Math.TWO_PI)):(e.hpRoll.heading+=e.deltaRadians,e.hpRoll.heading>t.Math.TWO_PI&&(e.hpRoll.heading-=t.Math.TWO_PI));break;case 37:i.shiftKey?(e.hpRoll.roll-=e.deltaRadians,e.hpRoll.roll<0&&(e.hpRoll.roll+=t.Math.TWO_PI)):(e.hpRoll.heading-=e.deltaRadians,e.hpRoll.heading<0&&(e.hpRoll.heading+=t.Math.TWO_PI))}})}}(window.Cesium),function(t){"use strict";t.RouteFly=function(e){this.viewer=e.viewer,this.cartographicArray=e.cartographicArray,this.pointArray=e.lnglatArray,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.cartesian3=new t.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=0,this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.keyEvent()},t.RouteFly.prototype.init=function(){for(var e=0;e<this.pointArray.length;e++)this.point.push(turf.point(this.pointArray[e]));for(var i=0;i<this.point.length-1;i++)this.bearing.push(turf.bearing(this.point[i],this.point[i+1]));for(e=0;e<this.bearing.length;e++)this.initialHeading.push(t.Math.toRadians(this.bearing[e]));for(var r=0;r<this.bearing.length-1;r++)this.bearing[r+1]-this.bearing[r]<-180?(this.differentBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r]+360)),this.reduceBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r]+360))):this.bearing[r+1]-this.bearing[r]>180?(this.differentBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r]-360)),this.reduceBearing.push(t.Math.toRadians(Math.abs(this.bearing[r+1]-this.bearing[r]-360)))):(this.differentBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r])),this.reduceBearing.push(t.Math.toRadians(Math.abs(this.bearing[r+1]-this.bearing[r]))))},t.RouteFly.prototype.initializationFly=function(){this.viewer.clock.startTime=start.clone(),this.viewer.clock.stopTime=stop.clone(),this.viewer.clock.currentTime=start.clone(),this.viewer.clock.clockRange=t.ClockRange.CLAMPED},t.RouteFly.prototype.computeCirclularFlight=function(e){for(var i=new t.SampledPositionProperty,r=0;r<e.length;r++){var o=t.JulianDate.addSeconds(start,r,new t.JulianDate),n=t.Cartesian3.fromRadians(Number(e[r][0]),Number(e[r][1]),Number(e[r][2]));i.addSample(o,n),viewer.entities.add({position:n,point:{pixelSize:2,color:t.Color.TRANSPARENT,outlineColor:t.Color.YELLOW,outlineWidth:2}})}return i},t.RouteFly.prototype.animation=function(){var e=this.computeCirclularFlight(this.cartographicArray),i=this.viewer.entities.add({availability:new t.TimeIntervalCollection([new t.TimeInterval({start:start,stop:stop})]),position:e});this.cartesian3=i.position.getValue(this.viewer.clock.currentTime);var r=this.scene.globe.ellipsoid;if(void 0==this.cartesian3)viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation);else{var o=r.cartesianToCartographic(this.cartesian3),n=Math.floor(1e5*t.Math.toDegrees(o.latitude))/1e5,a=Math.floor(1e5*t.Math.toDegrees(o.longitude))/1e5,s=(Math.floor(1e5*o.height),1e3*turf.distance(turf.point(this.pointArray[this.i+1]),turf.point([a,n,0])));Math.abs(a-this.pointArray[this.pointArray.length-1][0])<=5e-5&&Math.abs(n-this.pointArray[this.pointArray.length-1][1])<=5e-5&&(viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),viewer.scene.postRender.removeEventListener(this.animation,this)),s<=1*(50+this.deltaHeight)/10?(this.camera.setView({destination:t.Cartesian3.fromDegrees(t.Math.toDegrees(cartographicArray[this.i+1][0]),t.Math.toDegrees(cartographicArray[this.i+1][1]),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i]+this.HorizontalRadian,pitch:t.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=0,this.i<this.reduceBearing.length&&(this.reduceBearing[this.i]<1e-5?(this.HorizontalRadian=0,this.i+=1,this.viewer.clock.multiplier=speed):(this.HorizontalRadian+=this.differentBearing[this.i]/200,this.reduceBearing[this.i]-=Math.abs(this.differentBearing[this.i]/200)))):(this.camera.setView({destination:t.Cartesian3.fromDegrees(t.Math.toDegrees(o.longitude),t.Math.toDegrees(o.latitude),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i],pitch:t.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=speed)}},t.RouteFly.prototype.play=function(){this.initializationFly(),this.init(),this.scene.postRender.addEventListener(this.animation,this)},t.RouteFly.prototype.pause=function(){this.scene.postRender.removeEventListener(this.animation,this)},t.RouteFly.prototype.continue=function(){this.scene.postRender.removeEventListener(this.animation,this),this.scene.postRender.addEventListener(this.animation,this)},t.RouteFly.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),DrawPolylineWidget.clear(),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption)},t.RouteFly.prototype.reset=function(){this.initializationFly(),this.viewer.clock.multiplier=speed/200,this.viewer.camera.setView({orientation:{heading:this.initialHeading[0],pitch:t.Math.toRadians(0)}}),this.i=0,this.scene.postRender.addEventListener(this.animation,this)},t.RouteFly.prototype.keyEvent=function(){this.keydownOption=function(t){switch(t.keyCode){case 40:t.shiftKey?this.deltaHeight-=1:this.VerticalRadians-=.01;break;case 38:t.shiftKey?this.deltaHeight+=1:this.VerticalRadians+=.01}},document.addEventListener("keydown",this.keydownOption)}}(window.Cesium),function(t){"use strict";t.WalkBrowse=function(t){this.viewer=t.viewer,this.pointArray=t.pointArray,this.orientationAngle=[],this.point1=turf.point(this.pointArray[0]),this.point2=turf.point(this.pointArray[1]),this.point3=turf.point(this.pointArray[2]),this.bearing1=turf.bearing(this.point1,this.point2),this.bearing2=turf.bearing(this.point2,this.point3),this.drawMarker(),this.init()},t.WalkBrowse.prototype.animation=function(){var e=this.viewer.scene.globe.ellipsoid,i=this.viewer.camera.position,r=e.cartesianToCartographic(i),o=Math.floor(1e5*t.Math.toDegrees(r.latitude))/1e5,n=Math.floor(1e5*t.Math.toDegrees(r.longitude))/1e5;n==this.pointArray[1][0]&&o==this.pointArray[1][1]?(this.orientationAngle.push(t.Math.toDegrees(this.viewer.camera.heading)),this.bearing2-t.Math.toDegrees(this.viewer.camera.heading)>=1e-12?(this.viewer.camera.moveForward(0),this.viewer.camera.lookRight(t.Math.toRadians((this.bearing2-this.orientationAngle[0])/200))):(this.orientationAngle=[],this.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1],this.pointArray[1][2]),orientation:{heading:t.Math.toRadians(this.bearing2),pitch:t.Math.toRadians(0)}}),this.viewer.camera.moveForward(this.viewer.clock.multiplier))):n-this.pointArray[2][0]>-1e-5&&o-this.pointArray[2][1]>-1e-5?this.viewer.camera.moveForward(0):this.viewer.camera.moveForward(this.viewer.clock.multiplier)},t.WalkBrowse.prototype.init=function(){this.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:t.Math.toRadians(this.bearing1),pitch:t.Math.toRadians(0)}})},t.WalkBrowse.prototype.drawMarker=function(){this.viewer.entities.add({position:t.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1]),point:{pixelSize:2,color:t.Color.TRANSPARENT,outlineColor:t.Color.YELLOW,outlineWidth:2}}),this.viewer.entities.add({position:t.Cartesian3.fromDegrees(this.pointArray[2][0],this.pointArray[2][1]),point:{pixelSize:2,color:t.Color.TRANSPARENT,outlineColor:t.Color.RED,outlineWidth:2}})},t.WalkBrowse.prototype.play=function(){0==this.viewer.entities._entities.length&&this.drawMarker(),this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:t.Math.toRadians(this.bearing1),pitch:t.Math.toRadians(0)}}),this.viewer.scene.postRender.addEventListener(this.animation,this)},t.WalkBrowse.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.WalkBrowse.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.WalkBrowse.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.init()}}(window.Cesium),function(t){"use strict";var e=t.GeoTerrainProvider=function(e){if(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),!t.defined(e.urls))throw new t.DeveloperError("options.urls is required.");this._dataType=t.defaultValue(e.dataType,t.GeoTerrainProvider.INT),this._urls=e.urls,this._urls_length=this._urls.length,this._url_i=0,this._url_step=0,this._maxTerrainLevel=e.maxTerrainLevel-1,this._errorEvent=new t.Event,this._ready=!1,this._readyPromise=t.when.defer(),this._proxy=e.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0};var i=e.credit;"string"==typeof i&&(i=new t.Credit(i)),this._credit=i,this._tilingScheme=void 0,this._rectangles=[];var r=t.defaultValue(e.ellipsoid,t.Ellipsoid.WGS84);this._tilingScheme=new t.GeographicTilingScheme({ellipsoid:r}),this._heightmapWidth=64,this._heightmapHeight=64,this._levelZeroMaximumGeometricError=t.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(r,Math.min(this._heightmapWidth,this._heightmapHeight),this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0),this._name=e.name,this._opacity=e.opacity,this._maxExtent=e.maxExtent,this._topLevel=e.topLevel,this._bottomLevel=e.bottomLevel};function i(e,i){return(i=t.defined(i)?i:new t.Request).url=e,i.requestFunction=function(){var i,r,o=new XMLHttpRequest;return o.open("GET",e,!0),o.responseType="arraybuffer",o.async=!1,o.send(null),i=o,r=t.when.defer(),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status&&t.defined(i.response)){for(var e=new DataView(i.response),o=new Uint8Array(e.byteLength),n=0;n<e.byteLength;)o[n]=e.getUint8(n,!0),n++;var a=function(e){if(!(e.length<1e3)){var i=new Zlib.Inflate(e);return t.defined(i)?i.decompress():void 0}}(o);t.defined(a)?r.resolve(a):r.reject(void 0)}},r.promise},t.RequestScheduler.request(i)}t.defineProperties(e.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new t.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}}),e.prototype.requestTileGeometry=function(e,r,n,a){if(!this.ready)throw new t.DeveloperError("requestTileGeometry must not be called before ready returns true.");this._urls_length>1&&(this._url_step<8?this._url_step++:(this._url_step=0,this._url_i++,this._url_i>=this._urls_length&&(this._url_i=0)));var s=this._urls[this._url_i];this._tilingScheme.getNumberOfYTilesAtLevel(n);if(n<25&&n>=2){var l,h=s+(-1===s.indexOf("?")?"?":"&")+"x="+e+"&y="+r+"&l="+(n+1),c=this._proxy;if(t.defined(c)&&(h=c.getURL(h)),a=t.defaultValue(a,!0)){if(l=i(h,a),!t.defined(l))return}else l=i(h);var d=this;return t.when(l,function(i){var a=d.transformBuffer(i);if(t.defined(a)){var s=new t.HeightmapTerrainData({buffer:a,width:d._heightmapWidth,height:d._heightmapHeight,childTileMask:o(d,e,r,n),structure:d._terrainDataStructure});return s._skirtHeight=6e3,s}})}if(n<2){var u=this._heightmapWidth,p=this._heightmapHeight,g=o(this,e,r,n),m=this._terrainDataStructure;return new t.HeightmapTerrainData({buffer:this.getvHeightBuffer(),width:u,height:p,childTileMask:g,structure:m})}},e.prototype.getLevelMaximumGeometricError=function(e){if(!this.ready)throw new t.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<e)},e.prototype.getTileDataAvailable=function(t,e,i){if(i<25)return!0},e.prototype.getvHeightBuffer=function(){var e=this._vHeightBuffer;if(!t.defined(e)){e=new Uint8ClampedArray(this._heightmapWidth*this._heightmapHeight*4);for(var i=0;i<this._heightmapWidth*this._heightmapHeight*4;)e[i++]=15,e[i++]=66,e[i++]=64,e[i++]=255;this._vHeightBuffer=e}return e},e.prototype.transformBuffer=function(e){var i=2;this._dataType===t.GeoTerrainProvider.INT?i=2:this._dataType===t.GeoTerrainProvider.FLOAT&&(i=4);var r=e;if(r.length===22500*i){for(var o,n,a,s,l,h=new ArrayBuffer(i),c=new DataView(h),d=this._heightmapWidth,u=this._heightmapHeight,p=new Uint8Array(d*u*4),g=0;g<u;g++)for(var m=0;m<d;m++){s=parseInt(149*g/(u-1)),l=parseInt(149*m/(d-1)),149*g/(u-1),149*m/(d-1),4===i?(n=i*(150*s+l),c.setInt8(0,r[n]),c.setInt8(1,r[n+1]),c.setInt8(2,r[n+2]),c.setInt8(3,r[n+3]),o=c.getFloat32(0,!0)):o=r[n=i*(150*s+l)]+256*r[n+1],(o>1e4||o<-2e3)&&(o=0);var f=(o+1e3)/.001;p[a=4*(g*d+m)]=f/65536,p[a+1]=(f-256*p[a]*256)/256,p[a+2]=f-256*p[a]*256-256*p[a+1],p[a+3]=255}return p}return null};var r=new t.Rectangle;function o(e,i,o,a){for(var s=e._tilingScheme,l=e._rectangles,h=s.tileXYToRectangle(i,o,a),c=0,d=0;d<l.length&&15!==c;++d){var u=l[d];if(!(u.maxLevel<=a)){var p=u.rectangle,g=t.Rectangle.intersection(p,h,r);t.defined(g)&&(n(s,p,2*i,2*o,a+1)&&(c|=4),n(s,p,2*i+1,2*o,a+1)&&(c|=8),n(s,p,2*i,2*o+1,a+1)&&(c|=1),n(s,p,2*i+1,2*o+1,a+1)&&(c|=2))}}return c}function n(e,i,o,n,a){var s=e.tileXYToRectangle(o,n,a);return t.defined(t.Rectangle.intersection(s,i,r))}e.INT="int",e.FLOAT="float"}(window.Cesium),function(t){"use strict";var e=t.defaultValue;t.defined;function i(i){i=e(i,e.EMPTY_OBJECT),this.viewer=i.viewer,this.tileset=i.tileset,this.source=i.source,this.autoActivate=e(i.autoActivate,!0),this.active=e(i.active,null),this.showDefaultSelectedEntity=e(i.showDefaultSelectedEntity,!0),this.originalColor=e(i.originalColor,t.Color.fromBytes(255,50,50,1)),this.moveColor=e(i.moveColor,t.Color.fromBytes(255,50,50,122)),this.selectedColor=e(i.selectedColor,t.Color.fromBytes(50,255,50,122)),this.selectedFeature=void 0,this.dataSource=void 0,this.selectedEntity=new t.Entity,this.wrappedBoxDataSource=void 0,this.source&&"geojson"===this.source.type&&this._loadGeoJSON(this.source.data),this.handler=new t.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.autoActivate&&this.activateAction(),this._seletedEvent=new t.Event}t.defineProperties(i.prototype,{seletedEvent:{get:function(){return this._seletedEvent}}}),i.prototype._loadGeoJSON=function(e){var i=this;t.GeoJsonDataSource.load(e).then(function(t){i.dataSource=t,i.viewer.dataSources.add(t);for(var e=t.entities.values,r=0;r<e.length;r++){var o=e[r],n=i.originalColor;o.polygon.material=n,o.polygon.outline=!1,o.polygon.height=o.properties.minheight,o.polygon.extrudedHeight=o.properties.maxheight}})},i.prototype.reloadGeoJSON=function(t){this.dataSource=this.viewer.dataSources.remove(this.dataSource)?null:this.dataSource,this._loadGeoJSON(t)},i.prototype.showSelectedEntity=function(t){if(t&&t.id){this.selectedEntity.name=t.id.name,this.viewer.selectedEntity=this.selectedEntity;for(var e=t.id.properties.propertyNames,i='<table class="cesium-infoBox-defaultTable"><tbody>',r=0;r<e.length;r++)i+="<tr><th>"+e[r]+"</th><td>"+t.id.properties[e[r]].getValue()+"</td></tr>";i+="</tbody></table>",this.selectedEntity.description=i}},i.prototype.isContaintFeature=function(t){for(var e=this.dataSource.entities.values,i=0;i<e.length;i++)if(e[i]===t.id)return!0;return!1},i.prototype.showWrappedBox=function(e){var i=this;i.hideWrappedBox(),t.GeoJsonDataSource.load(e).then(function(t){i.viewer.dataSources.add(t);for(var e=t.entities.values,r=0;r<e.length;r++){var o=e[r],n=i.selectedColor;o.polygon.material=n,o.polygon.outline=!1,o.polygon.height=o.properties.minheight,o.polygon.extrudedHeight=o.properties.maxheight}i.wrappedBoxDataSource=t})},i.prototype.hideWrappedBox=function(){this.wrappedBoxDataSource&&(this.viewer.dataSources.remove(this.wrappedBoxDataSource),this.wrappedBoxDataSource=void 0)},i.prototype.activateAction=function(){if(!0!==this.active){this.active=!0;var e=this,i=null,r=null;e.handler.setInputAction(function(o){if(i&&i.id){if(r&&r.id&&i&&i.id&&i.id.id===r.id.id)return;i.id.polygon.material=e.originalColor,i=void 0}for(var n=void 0,a=e.viewer.scene.drillPick(o.endPosition,10),s=0;s<a.length;s++)if(a[s].id&&a[s].id instanceof t.Entity){n=a[s];break}if(t.defined(n)&&(!r&&n&&n.id||n&&n.id&&r&&r.id&&n.id.id!==r.id.id)){if(!e.isContaintFeature(n))return;i=n,n.id.polygon.material=e.moveColor}},t.ScreenSpaceEventType.MOUSE_MOVE),e.handler.setInputAction(function(o){r&&(r.id.polygon.material=e.originalColor,r=void 0,e.selectedFeature=r);for(var n=void 0,a=e.viewer.scene.drillPick(o.position,10),s=0;s<a.length;s++)if(a[s].id&&a[s].id instanceof t.Entity){n=a[s];break}if(t.defined(n)){if(r!==n){if(n&&n.id&&r!==n){if(!e.isContaintFeature(n))return;r=n,n.id.polygon.material=e.selectedColor,e.selectedFeature=r}n&&r&&i&&n.id===i.id&&(i=void 0),n&&n.id?(e.showDefaultSelectedEntity?e.showSelectedEntity(n):e.viewer.selectedEntity=null,e._seletedEvent.raiseEvent(n)):e.viewer.selectedEntity=null}}else e.viewer.selectedEntity=null},t.ScreenSpaceEventType.LEFT_CLICK)}},i.prototype.deactivateAction=function(){if(!0===this.active){this.active=!1;this.selectedFeature&&this.selectedFeature.id&&(this.selectedFeature.id.polygon.material=this.originalColor,this.selectedFeature=null,this.viewer.selectedEntity=null),this.handler.removeInputAction(t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)}},i.prototype.destroy=function(){this.deactivateAction(),this.handler=this.handler&&this.handler.destroy(),this.dataSource=this.viewer.dataSources.remove(this.dataSource)?null:this.dataSource,this.viewer=void 0,this.tileset=void 0,this.source=void 0,this.originalColor=void 0,this.moveColor=void 0,this.selectedColor=void 0,this.selectedFeature=void 0,this.selectedEntity=void 0},t.Cesium3DTilesetMonomer=i}(window.Cesium),function(t){"use strict";var e=t.BoundingSphere,i=t.Cartesian2,r=t.Cartesian3,o=t.Cartesian4,n=t.Cartographic,a=t.defaultValue,s=t.defined,l=t.defineProperties,h=t.DeveloperError,c=t.EasingFunction,d=t.Ellipsoid,u=t.EllipsoidGeodesic,p=t.Event,g=t.HeadingPitchRange,m=t.HeadingPitchRoll,f=t.Intersect,v=t.IntersectionTests,y=t.Math,_=t.Matrix3,w=t.Matrix4,P=t.OrthographicFrustum,b=t.OrthographicOffCenterFrustum,C=t.PerspectiveFrustum,E=t.Quaternion,T=t.Ray,A=t.Rectangle,S=t.Transforms,M=t.CameraFlightPath,x=t.MapMode2D,I=t.SceneMode;function k(t){if(!s(t))throw new h("scene is required.");this._scene=t,this._transform=w.clone(w.IDENTITY),this._invTransform=w.clone(w.IDENTITY),this._actualTransform=w.clone(w.IDENTITY),this._actualInvTransform=w.clone(w.IDENTITY),this._transformChanged=!1,this.position=new r,this._position=new r,this._positionWC=new r,this._positionCartographic=new n,this.direction=new r,this._direction=new r,this._directionWC=new r,this.up=new r,this._up=new r,this._upWC=new r,this.right=new r,this._right=new r,this._rightWC=new r,this.frustum=new C,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=y.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new p,this._moveEnd=new p,this._changed=new p,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new w,this._invViewMatrix=new w,R(this),this._mode=I.SCENE3D,this._modeChanged=!0;var e=t.mapProjection;this._projection=e,this._maxCoord=e.project(new n(Math.PI,y.PI_OVER_TWO)),this._max2Dfrustum=void 0,this._suspendTerrainAdjustment=!1,Kt(this,k.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=r.magnitude(this.position);i+=i*k.DEFAULT_VIEW_FACTOR,r.normalize(this.position,this.position),r.multiplyByScalar(this.position,i,this.position)}function R(t){w.computeView(t._position,t._direction,t._up,t._right,t._viewMatrix),w.multiply(t._viewMatrix,t._actualInvTransform,t._viewMatrix),w.inverseTransformation(t._viewMatrix,t._invViewMatrix)}k.TRANSFORM_2D=new w(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),k.TRANSFORM_2D_INVERSE=w.inverseTransformation(k.TRANSFORM_2D,new w),k.DEFAULT_VIEW_RECTANGLE=A.fromDegrees(-95,-20,-70,90),k.DEFAULT_VIEW_FACTOR=.5,k.DEFAULT_OFFSET=new g(0,-y.PI_OVER_FOUR,0),k.prototype._updateCameraChanged=function(){if(0!==this._changed.numberOfListeners){var t=this.percentageChanged;if(this._mode!==I.SCENE2D){if(!s(this._changedDirection))return this._changedPosition=r.clone(this.positionWC,this._changedPosition),void(this._changedDirection=r.clone(this.directionWC,this._changedDirection));var e,i=y.acosClamped(r.dot(this.directionWC,this._changedDirection));e=s(this.frustum.fovy)?i/(.5*this.frustum.fovy):i;var o=r.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height;(e>t||o>t)&&(this._changed.raiseEvent(Math.max(e,o)),this._changedPosition=r.clone(this.positionWC,this._changedPosition),this._changedDirection=r.clone(this.directionWC,this._changedDirection))}else{if(!s(this._changedFrustum))return this._changedPosition=r.clone(this.position,this._changedPosition),void(this._changedFrustum=this.frustum.clone());var n,a=this.position,l=this._changedPosition,h=this.frustum,c=this._changedFrustum,d=a.x+h.left,u=a.x+h.right,p=l.x+c.left,g=l.x+c.right,m=a.y+h.bottom,f=a.y+h.top,v=l.y+c.bottom,_=l.y+c.top,w=Math.max(d,p),P=Math.min(u,g),b=Math.max(m,v),C=Math.min(f,_);if(w>=P||b>=f)n=1;else{var E=c;d<p&&u>g&&m<v&&f>_&&(E=h),n=1-(P-w)*(C-b)/((E.right-E.left)*(E.top-E.bottom))}n>t&&(this._changed.raiseEvent(n),this._changedPosition=r.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}}};var D=new w,O=new n;k.prototype._adjustHeightForTerrain=function(){var t=this._scene,e=t.screenSpaceCameraController,i=e.enableCollisionDetection,o=e.minimumCollisionTerrainHeight,n=e.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&i){var a=this._mode,l=t.globe;if(s(l)&&a!==I.SCENE2D&&a!==I.MORPHING){var h,c,d=l.ellipsoid,u=t.mapProjection;w.equals(this.transform,w.IDENTITY)||(h=w.clone(this.transform,D),c=r.magnitude(this.position),this._setTransform(w.IDENTITY));var p=O;a===I.SCENE3D?d.cartesianToCartographic(this.position,p):u.unproject(this.position,p);var g=!1;if(p.height<o){var m=l.getHeight(p);s(m)&&(m+=n,p.height<m&&(p.height=m,a===I.SCENE3D?d.cartographicToCartesian(p,this.position):u.project(p,this.position),g=!0))}s(h)&&(this._setTransform(h),g&&(r.normalize(this.position,this.position),r.negate(this.position,this.direction),r.multiplyByScalar(this.position,Math.max(c,n),this.position),r.normalize(this.direction,this.direction),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up)))}}};var L=new n,F=new r,B=new r,H=new o,U=new o,N=new o,W=new o,G=new o;var z=new r;function V(t){var e=t._mode,i=!1,n=0;e===I.SCENE2D&&(i=(n=t.frustum.right-t.frustum.left)!==t._positionCartographic.height);var a=t._position,s=!r.equals(a,t.position)||i;s&&(a=r.clone(t.position,t._position));var l=t._direction,h=!r.equals(l,t.direction);h&&(r.normalize(t.direction,t.direction),l=r.clone(t.direction,t._direction));var c=t._up,d=!r.equals(c,t.up);d&&(r.normalize(t.up,t.up),c=r.clone(t.up,t._up));var u=t._right,p=!r.equals(u,t.right);p&&(r.normalize(t.right,t.right),u=r.clone(t.right,t._right));var g,m=t._transformChanged||t._modeChanged;t._transformChanged=!1,m&&(w.inverseTransformation(t._transform,t._invTransform),t._mode===I.COLUMBUS_VIEW||t._mode===I.SCENE2D?w.equals(w.IDENTITY,t._transform)?w.clone(k.TRANSFORM_2D,t._actualTransform):t._mode===I.COLUMBUS_VIEW?(g=t,S.basisTo2D(g._projection,g._transform,g._actualTransform)):function(t){var e=t._projection,i=e.ellipsoid,n=w.getColumn(t._transform,3,H),a=i.cartesianToCartographic(n,L),s=e.project(a,F),l=U;l.x=s.z,l.y=s.x,l.z=s.y,l.w=1;var h=o.clone(o.UNIT_X,G),c=o.add(w.getColumn(t._transform,0,B),n,B);i.cartesianToCartographic(c,a),e.project(a,s);var d=N;d.x=s.z,d.y=s.x,d.z=s.y,d.w=0,r.subtract(d,l,d),d.x=0;var u=W;if(r.magnitudeSquared(d)>y.EPSILON10)r.cross(h,d,u);else{var p=o.add(w.getColumn(t._transform,1,B),n,B);i.cartesianToCartographic(p,a),e.project(a,s),u.x=s.z,u.y=s.x,u.z=s.y,u.w=0,r.subtract(u,l,u),u.x=0,r.magnitudeSquared(u)<y.EPSILON10&&(o.clone(o.UNIT_Y,d),o.clone(o.UNIT_Z,u))}r.cross(u,h,d),r.normalize(d,d),r.cross(h,d,u),r.normalize(u,u),w.setColumn(t._actualTransform,0,d,t._actualTransform),w.setColumn(t._actualTransform,1,u,t._actualTransform),w.setColumn(t._actualTransform,2,h,t._actualTransform),w.setColumn(t._actualTransform,3,l,t._actualTransform)}(t):w.clone(t._transform,t._actualTransform),w.inverseTransformation(t._actualTransform,t._actualInvTransform),t._modeChanged=!1);var f=t._actualTransform;if(s||m)if(t._positionWC=w.multiplyByPoint(f,a,t._positionWC),e===I.SCENE3D||e===I.MORPHING)t._positionCartographic=t._projection.ellipsoid.cartesianToCartographic(t._positionWC,t._positionCartographic);else{var v=z;v.x=t._positionWC.y,v.y=t._positionWC.z,v.z=t._positionWC.x,e===I.SCENE2D&&(v.z=n),t._projection.unproject(v,t._positionCartographic)}if(h||d||p){var _=r.dot(l,r.cross(c,u,z));if(Math.abs(1-_)>y.EPSILON2){var P=1/r.magnitudeSquared(c),b=r.dot(c,l)*P,C=r.multiplyByScalar(l,b,z);c=r.normalize(r.subtract(c,C,t._up),t._up),r.clone(c,t.up),u=r.cross(l,c,t._right),r.clone(u,t.right)}}(h||m)&&(t._directionWC=w.multiplyByPointAsVector(f,l,t._directionWC),r.normalize(t._directionWC,t._directionWC)),(d||m)&&(t._upWC=w.multiplyByPointAsVector(f,c,t._upWC),r.normalize(t._upWC,t._upWC)),(p||m)&&(t._rightWC=w.multiplyByPointAsVector(f,u,t._rightWC),r.normalize(t._rightWC,t._rightWC)),(s||h||d||p||m)&&R(t)}function q(t,e){var i;return i=y.equalsEpsilon(Math.abs(t.z),1,y.EPSILON3)?Math.atan2(e.y,e.x)-y.PI_OVER_TWO:Math.atan2(t.y,t.x)-y.PI_OVER_TWO,y.TWO_PI-y.zeroToTwoPi(i)}function j(t){return y.PI_OVER_TWO-y.acosClamped(t.z)}function Z(t,e,i){var r=0;return y.equalsEpsilon(Math.abs(t.z),1,y.EPSILON3)||(r=Math.atan2(-i.z,e.z),r=y.zeroToTwoPi(r+y.TWO_PI)),r}var Y=new w,K=new w;l(k.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return V(this),this._invTransform}},viewMatrix:{get:function(){return V(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return V(this),this._invViewMatrix}},positionCartographic:{get:function(){return V(this),this._positionCartographic}},positionWC:{get:function(){return V(this),this._positionWC}},directionWC:{get:function(){return V(this),this._directionWC}},upWC:{get:function(){return V(this),this._upWC}},rightWC:{get:function(){return V(this),this._rightWC}},heading:{get:function(){if(this._mode!==I.MORPHING){var t=this._projection.ellipsoid,e=w.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,t,K);this._setTransform(i);var r=q(this.direction,this.up);return this._setTransform(e),r}}},pitch:{get:function(){if(this._mode!==I.MORPHING){var t=this._projection.ellipsoid,e=w.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,t,K);this._setTransform(i);var r=j(this.direction);return this._setTransform(e),r}}},roll:{get:function(){if(this._mode!==I.MORPHING){var t=this._projection.ellipsoid,e=w.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,t,K);this._setTransform(i);var r=Z(this.direction,this.up,this.right);return this._setTransform(e),r}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),k.prototype.update=function(t){if(!s(t))throw new h("mode is required.");if(t===I.SCENE2D&&!(this.frustum instanceof b))throw new h("An OrthographicOffCenterFrustum is required in 2D.");if(!(t!==I.SCENE3D&&t!==I.COLUMBUS_VIEW||this.frustum instanceof C||this.frustum instanceof P))throw new h("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");var e=!1;if(t!==this._mode&&(this._mode=t,this._modeChanged=t!==I.MORPHING,e=this._mode===I.SCENE2D),e){var i=this._max2Dfrustum=this.frustum.clone();if(!(i instanceof b))throw new h("The camera frustum is expected to be orthographic for 2D camera control.");var r=i.top/i.right;i.right=2*this._maxCoord.x,i.left=-i.right,i.top=r*i.right,i.bottom=-i.top}this._mode===I.SCENE2D&&ft(this,this.position);var o=this._scene.globe,n=!s(o)||o._surface.tileProvider.ready&&0===o._surface._tileLoadQueueHigh.length&&0===o._surface._tileLoadQueueMedium.length&&0===o._surface._tileLoadQueueLow.length&&0===o._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!n),this._adjustHeightForTerrain()};var X=new r,Q=new r,J=new r;k.prototype._setTransform=function(t){var e=r.clone(this.positionWC,X),i=r.clone(this.upWC,Q),o=r.clone(this.directionWC,J);w.clone(t,this._transform),this._transformChanged=!0,V(this);var n=this._actualInvTransform;w.multiplyByPoint(n,e,this.position),w.multiplyByPointAsVector(n,o,this.direction),w.multiplyByPointAsVector(n,i,this.up),r.cross(this.direction,this.up,this.right),V(this)};var $=new i,tt=new T,et=new r,it=new r;k.prototype._adjustOrthographicFrustum=function(t){if(this.frustum instanceof P&&(t||!(this._positionCartographic.height<15e4)))if(w.equals(w.IDENTITY,this.transform)){var e,i,o=this._scene,n=o._globe;if(s(n)){var a=$;a.x=o.drawingBufferWidth/2,a.y=o.drawingBufferHeight/2;var l=this.getPickRay(a,tt);if(e=n.pick(l,o,et),o.pickPositionSupported&&(i=o.pickPositionWorldCoordinates(a,it)),s(e)&&s(i)){var h=s(i)?r.distance(i,this.positionWC):Number.POSITIVE_INFINITY,c=s(e)?r.distance(e,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(h,c)}else s(i)?this.frustum.width=r.distance(i,this.positionWC):s(e)&&(this.frustum.width=r.distance(e,this.positionWC))}if(!s(n)||!s(e)&&!s(i)){var d=Math.max(this.positionCartographic.height,0);this.frustum.width=d}}else this.frustum.width=r.magnitude(this.position)};var rt=new r,ot=new w,nt=new w,at=new E,st=new _,lt=new n;var ht=new r,ct=new r,dt=new r;function ut(t,e,i,o){var n=r.clone(i.direction,ht),a=r.clone(i.up,ct);if(t._scene.mode===I.SCENE3D){var s=t._projection.ellipsoid,l=S.eastNorthUpToFixedFrame(e,s,Y),h=w.inverseTransformation(l,K);w.multiplyByPointAsVector(h,n,n),w.multiplyByPointAsVector(h,a,a)}var c=r.cross(n,a,dt);return o.heading=q(n,a),o.pitch=j(n),o.roll=Z(n,a,c),o}var pt={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},gt=new m;k.prototype.setView=function(t){t=a(t,a.EMPTY_OBJECT);var e=a(t.orientation,a.EMPTY_OBJECT),o=this._mode;if(o!==I.MORPHING){s(t.endTransform)&&this._setTransform(t.endTransform);var n=a(t.convert,!0),l=a(t.destination,r.clone(this.positionWC,rt));s(l)&&s(l.west)&&(l=this.getRectangleCameraCoordinates(l,rt),n=!1),s(e.direction)&&(e=ut(this,l,e,pt.orientation)),gt.heading=a(e.heading,0),gt.pitch=a(e.pitch,-y.PI_OVER_TWO),gt.roll=a(e.roll,0),this._suspendTerrainAdjustment=!1,o===I.SCENE3D?function(t,e,i){var o=w.clone(t.transform,ot),n=S.eastNorthUpToFixedFrame(e,t._projection.ellipsoid,nt);t._setTransform(n),r.clone(r.ZERO,t.position),i.heading=i.heading-y.PI_OVER_TWO;var a=E.fromHeadingPitchRoll(i,at),s=_.fromQuaternion(a,st);_.getColumn(s,0,t.direction),_.getColumn(s,2,t.up),r.cross(t.direction,t.up,t.right),t._setTransform(o),t._adjustOrthographicFrustum(!0)}(this,l,gt):o===I.SCENE2D?function(t,e,o,n){var a=w.clone(t.transform,ot);if(t._setTransform(w.IDENTITY),!r.equals(e,t.positionWC)){if(n){var s=t._projection,l=s.ellipsoid.cartesianToCartographic(e,lt);e=s.project(l,rt)}i.clone(e,t.position);var h=.5*-e.z,c=-h,d=t.frustum;if(c>h){var u=d.top/d.right;d.right=c,d.left=h,d.top=d.right*u,d.bottom=-d.top}}if(t._scene.mapMode2D===x.ROTATE){o.heading=o.heading-y.PI_OVER_TWO,o.pitch=-y.PI_OVER_TWO,o.roll=0;var p=E.fromHeadingPitchRoll(o,at),g=_.fromQuaternion(p,st);_.getColumn(g,2,t.up),r.cross(t.direction,t.up,t.right)}t._setTransform(a)}(this,l,gt,n):function(t,e,i,o){var n=w.clone(t.transform,ot);if(t._setTransform(w.IDENTITY),!r.equals(e,t.positionWC)){if(o){var a=t._projection,s=a.ellipsoid.cartesianToCartographic(e,lt);e=a.project(s,rt)}r.clone(e,t.position)}i.heading=i.heading-y.PI_OVER_TWO;var l=E.fromHeadingPitchRoll(i,at),h=_.fromQuaternion(l,st);_.getColumn(h,0,t.direction),_.getColumn(h,2,t.up),r.cross(t.direction,t.up,t.right),t._setTransform(n),t._adjustOrthographicFrustum(!0)}(this,l,gt,n)}};var mt=new r;function ft(t,e){var i,r,o=t._scene.mapMode2D===x.ROTATE,n=t._maxCoord.x,a=t._maxCoord.y;o?i=-(r=n):(r=e.x-2*n,i=e.x+2*n),e.x>n&&(e.x=r),e.x<-n&&(e.x=i),e.y>a&&(e.y=a),e.y<-a&&(e.y=-a)}k.prototype.flyHome=function(t){var e=this._mode;if(e===I.MORPHING&&this._scene.completeMorph(),e===I.SCENE2D)this.flyTo({destination:k.DEFAULT_VIEW_RECTANGLE,duration:t,endTransform:w.IDENTITY});else if(e===I.SCENE3D){var i=this.getRectangleCameraCoordinates(k.DEFAULT_VIEW_RECTANGLE),o=r.magnitude(i);o+=o*k.DEFAULT_VIEW_FACTOR,r.normalize(i,i),r.multiplyByScalar(i,o,i),this.flyTo({destination:i,duration:t,endTransform:w.IDENTITY})}else if(e===I.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,a=new r(0,-1,1);a=r.multiplyByScalar(r.normalize(a,a),5*n,a),this.flyTo({destination:a,duration:t,orientation:{heading:0,pitch:-Math.acos(r.normalize(a,mt).z),roll:0},endTransform:w.IDENTITY,convert:!1})}},k.prototype.worldToCameraCoordinates=function(t,e){if(!s(t))throw new h("cartesian is required.");return s(e)||(e=new o),V(this),w.multiplyByVector(this._actualInvTransform,t,e)},k.prototype.worldToCameraCoordinatesPoint=function(t,e){if(!s(t))throw new h("cartesian is required.");return s(e)||(e=new r),V(this),w.multiplyByPoint(this._actualInvTransform,t,e)},k.prototype.worldToCameraCoordinatesVector=function(t,e){if(!s(t))throw new h("cartesian is required.");return s(e)||(e=new r),V(this),w.multiplyByPointAsVector(this._actualInvTransform,t,e)},k.prototype.cameraToWorldCoordinates=function(t,e){if(!s(t))throw new h("cartesian is required.");return s(e)||(e=new o),V(this),w.multiplyByVector(this._actualTransform,t,e)},k.prototype.cameraToWorldCoordinatesPoint=function(t,e){if(!s(t))throw new h("cartesian is required.");return s(e)||(e=new r),V(this),w.multiplyByPoint(this._actualTransform,t,e)},k.prototype.cameraToWorldCoordinatesVector=function(t,e){if(!s(t))throw new h("cartesian is required.");return s(e)||(e=new r),V(this),w.multiplyByPointAsVector(this._actualTransform,t,e)};var vt=new r;k.prototype.move=function(t,e){if(!s(t))throw new h("direction is required.");var i=this.position;r.multiplyByScalar(t,e,vt),r.add(i,vt,i),this._mode===I.SCENE2D&&ft(this,i),this._adjustOrthographicFrustum(!0)},k.prototype.moveForward=function(t){t=a(t,this.defaultMoveAmount),this.move(this.direction,t)},k.prototype.moveBackward=function(t){t=a(t,this.defaultMoveAmount),this.move(this.direction,-t)},k.prototype.moveUp=function(t){t=a(t,this.defaultMoveAmount),this.move(this.up,t)},k.prototype.moveDown=function(t){t=a(t,this.defaultMoveAmount),this.move(this.up,-t)},k.prototype.moveRight=function(t){t=a(t,this.defaultMoveAmount),this.move(this.right,t)},k.prototype.moveLeft=function(t){t=a(t,this.defaultMoveAmount),this.move(this.right,-t)},k.prototype.lookLeft=function(t){t=a(t,this.defaultLookAmount),this.look(this.up,-t)},k.prototype.lookRight=function(t){t=a(t,this.defaultLookAmount),this.look(this.up,t)},k.prototype.lookUp=function(t){t=a(t,this.defaultLookAmount),this.look(this.right,-t)},k.prototype.lookDown=function(t){t=a(t,this.defaultLookAmount),this.look(this.right,t)};var yt=new E,_t=new _;k.prototype.look=function(t,e){if(!s(t))throw new h("axis is required.");var i=a(e,this.defaultLookAmount),r=E.fromAxisAngle(t,-i,yt),o=_.fromQuaternion(r,_t),n=this.direction,l=this.up,c=this.right;_.multiplyByVector(o,n,n),_.multiplyByVector(o,l,l),_.multiplyByVector(o,c,c)},k.prototype.twistLeft=function(t){t=a(t,this.defaultLookAmount),this.look(this.direction,t)},k.prototype.twistRight=function(t){t=a(t,this.defaultLookAmount),this.look(this.direction,-t)};var wt=new E,Pt=new _;k.prototype.rotate=function(t,e){if(!s(t))throw new h("axis is required.");var i=a(e,this.defaultRotateAmount),o=E.fromAxisAngle(t,-i,wt),n=_.fromQuaternion(o,Pt);_.multiplyByVector(n,this.position,this.position),_.multiplyByVector(n,this.direction,this.direction),_.multiplyByVector(n,this.up,this.up),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},k.prototype.rotateDown=function(t){At(this,t=a(t,this.defaultRotateAmount))},k.prototype.rotateUp=function(t){At(this,-(t=a(t,this.defaultRotateAmount)))};var bt=new r,Ct=new r,Et=new r,Tt=new r;function At(t,e){var i=t.position,o=r.normalize(i,bt);if(s(t.constrainedAxis)){var n=r.equalsEpsilon(o,t.constrainedAxis,y.EPSILON2),a=r.equalsEpsilon(o,r.negate(t.constrainedAxis,Tt),y.EPSILON2);if(n||a)(n&&e<0||a&&e>0)&&t.rotate(t.right,e);else{var l=r.normalize(t.constrainedAxis,Ct),h=r.dot(o,l),c=y.acosClamped(h);e>0&&e>c&&(e=c-y.EPSILON4),h=r.dot(o,r.negate(l,Tt)),c=y.acosClamped(h),e<0&&-e>c&&(e=-c+y.EPSILON4);var d=r.cross(l,o,Et);t.rotate(d,e)}}else t.rotate(t.right,e)}function St(t,e){s(t.constrainedAxis)?t.rotate(t.constrainedAxis,e):t.rotate(t.up,e)}function Mt(t,e){var i,r=t.frustum;if(!(r instanceof b&&s(r.left)&&s(r.right)&&s(r.bottom)&&s(r.top)))throw new h("The camera frustum is expected to be orthographic for 2D camera control.");if(e*=.5,Math.abs(r.top)+Math.abs(r.bottom)>Math.abs(r.left)+Math.abs(r.right)){var o=r.top-e,n=r.bottom+e,a=t._maxCoord.y;t._scene.mapMode2D===x.ROTATE&&(a*=t.maximumZoomFactor),n>a&&(n=a,o=-a),o<=n&&(o=1,n=-1),i=r.right/r.top,r.top=o,r.bottom=n,r.right=r.top*i,r.left=-r.right}else{var l=r.right-e,c=r.left+e,d=t._maxCoord.x;t._scene.mapMode2D===x.ROTATE&&(d*=t.maximumZoomFactor),l>d&&(l=d,c=-d),l<=c&&(l=1,c=-1),i=r.top/r.right,r.right=l,r.left=c,r.top=r.right*i,r.bottom=-r.top}}function xt(t,e){t.move(t.direction,e)}k.prototype.rotateRight=function(t){St(this,-(t=a(t,this.defaultRotateAmount)))},k.prototype.rotateLeft=function(t){St(this,t=a(t,this.defaultRotateAmount))},k.prototype.zoomIn=function(t){t=a(t,this.defaultZoomAmount),this._mode===I.SCENE2D?Mt(this,t):xt(this,t)},k.prototype.zoomOut=function(t){t=a(t,this.defaultZoomAmount),this._mode===I.SCENE2D?Mt(this,-t):xt(this,-t)},k.prototype.getMagnitude=function(){return this._mode===I.SCENE3D?r.magnitude(this.position):this._mode===I.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===I.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var It=new w;k.prototype.lookAt=function(t,e){if(!s(t))throw new h("target is required");if(!s(e))throw new h("offset is required");if(this._mode===I.MORPHING)throw new h("lookAt is not supported while morphing.");var i=S.eastNorthUpToFixedFrame(t,d.WGS84,It);this.lookAtTransform(i,e)};var kt=new r,Rt=new E,Dt=new E,Ot=new _;function Lt(t,e,i){e=y.clamp(e,-y.PI_OVER_TWO,y.PI_OVER_TWO),t=y.zeroToTwoPi(t)-y.PI_OVER_TWO;var o=E.fromAxisAngle(r.UNIT_Y,-e,Rt),n=E.fromAxisAngle(r.UNIT_Z,-t,Dt),a=E.multiply(n,o,n),s=_.fromQuaternion(a,Ot),l=r.clone(r.UNIT_X,kt);return _.multiplyByVector(s,l,l),r.negate(l,l),r.multiplyByScalar(l,i,l),l}k.prototype.lookAtTransform=function(t,e){if(!s(t))throw new h("transform is required");if(this._mode===I.MORPHING)throw new h("lookAtTransform is not supported while morphing.");if(this._setTransform(t),s(e)){var o;if(o=s(e.heading)?Lt(e.heading,e.pitch,e.range):e,this._mode===I.SCENE2D){i.clone(i.ZERO,this.position),r.negate(o,this.up),this.up.z=0,r.magnitudeSquared(this.up)<y.EPSILON10&&r.clone(r.UNIT_Y,this.up),r.normalize(this.up,this.up),this._setTransform(w.IDENTITY),r.negate(r.UNIT_Z,this.direction),r.cross(this.direction,this.up,this.right),r.normalize(this.right,this.right);var n=this.frustum,a=n.top/n.right;return n.right=.5*r.magnitude(o),n.left=-n.right,n.top=a*n.right,n.bottom=-n.top,void this._setTransform(t)}r.clone(o,this.position),r.negate(this.position,this.direction),r.normalize(this.direction,this.direction),r.cross(this.direction,r.UNIT_Z,this.right),r.magnitudeSquared(this.right)<y.EPSILON10&&r.clone(r.UNIT_X,this.right),r.normalize(this.right,this.right),r.cross(this.right,this.direction,this.up),r.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var Ft,Bt=new n,Ht=new n,Ut=new r,Nt=new r,Wt=new r,Gt=new r,zt=new r,Vt=new r,qt=new r,jt=new r,Zt={direction:new r,right:new r,up:new r};function Yt(t,e,i,o){return Math.abs(r.dot(e,i))/o-r.dot(t,i)}function Kt(t,e,i,o){var n=t._projection.ellipsoid,a=o?t:Zt,l=e.north,h=e.south,c=e.east,d=e.west;d>c&&(c+=y.TWO_PI);var p,g=.5*(d+c);if(h<-y.PI_OVER_TWO+y.RADIANS_PER_DEGREE&&l>y.PI_OVER_TWO-y.RADIANS_PER_DEGREE)p=0;else{var m=Bt;m.longitude=g,m.latitude=l,m.height=0;var f=Ht;f.longitude=g,f.latitude=h,f.height=0;var v=Ft;s(v)&&v.ellipsoid===n||(Ft=v=new u(void 0,void 0,n)),v.setEndPoints(m,f),p=v.interpolateUsingFraction(.5,Bt).latitude}var _=Bt;_.longitude=g,_.latitude=p,_.height=0;var w=n.cartographicToCartesian(_,qt),b=Bt;b.longitude=c,b.latitude=l;var C=n.cartographicToCartesian(b,Ut);b.longitude=d;var E=n.cartographicToCartesian(b,Wt);b.longitude=g;var T=n.cartographicToCartesian(b,zt);b.latitude=h;var A=n.cartographicToCartesian(b,Vt);b.longitude=c;var S=n.cartographicToCartesian(b,Gt);b.longitude=d;var M=n.cartographicToCartesian(b,Nt);r.subtract(E,w,E),r.subtract(S,w,S),r.subtract(C,w,C),r.subtract(M,w,M),r.subtract(T,w,T),r.subtract(A,w,A);var x=n.geodeticSurfaceNormal(w,a.direction);r.negate(x,x);var I=r.cross(x,r.UNIT_Z,a.right);r.normalize(I,I);var k,R=r.cross(I,x,a.up);if(t.frustum instanceof P){var D,O,L=Math.max(r.distance(C,E),r.distance(S,M)),F=Math.max(r.distance(C,S),r.distance(E,M)),B=t.frustum._offCenterFrustum.right/t.frustum._offCenterFrustum.top,H=F*B;L>H?O=(D=L)/B:(O=F,D=H),k=Math.max(D,O)}else{var U=Math.tan(.5*t.frustum.fovy),N=t.frustum.aspectRatio*U;if(k=Math.max(Yt(x,R,E,U),Yt(x,R,S,U),Yt(x,R,C,U),Yt(x,R,M,U),Yt(x,R,T,U),Yt(x,R,A,U),Yt(x,I,E,N),Yt(x,I,S,N),Yt(x,I,C,N),Yt(x,I,M,N),Yt(x,I,T,N),Yt(x,I,A,N)),h<0&&l>0){var W=Bt;W.longitude=d,W.latitude=0,W.height=0;var G=n.cartographicToCartesian(W,jt);r.subtract(G,w,G),k=Math.max(k,Yt(x,R,G,U),Yt(x,I,G,N)),W.longitude=c,G=n.cartographicToCartesian(W,jt),r.subtract(G,w,G),k=Math.max(k,Yt(x,R,G,U),Yt(x,I,G,N))}}return r.add(w,r.multiplyByScalar(x,-k,jt),i)}var Xt=new n,Qt=new r,Jt=new r;var $t=new n,te=new r,ee=new r;k.prototype.getRectangleCameraCoordinates=function(t,e){if(!s(t))throw new h("rectangle is required");var i=this._mode;return s(e)||(e=new r),i===I.SCENE3D?Kt(this,t,e):i===I.COLUMBUS_VIEW?function(t,e,i){var r=t._projection;e.west>e.east&&(e=A.MAX_VALUE);var o=t._actualTransform,n=t._actualInvTransform,a=Xt;a.longitude=e.east,a.latitude=e.north;var l=r.project(a,Qt);w.multiplyByPoint(o,l,l),w.multiplyByPoint(n,l,l),a.longitude=e.west,a.latitude=e.south;var h=r.project(a,Jt);if(w.multiplyByPoint(o,h,h),w.multiplyByPoint(n,h,h),i.x=.5*(l.x-h.x)+h.x,i.y=.5*(l.y-h.y)+h.y,s(t.frustum.fovy)){var c=Math.tan(.5*t.frustum.fovy),d=t.frustum.aspectRatio*c;i.z=.5*Math.max((l.x-h.x)/d,(l.y-h.y)/c)}else{var u=l.x-h.x,p=l.y-h.y;i.z=Math.max(u,p)}return i}(this,t,e):i===I.SCENE2D?function(t,e,i){var r=t._projection;e.west>e.east&&(e=A.MAX_VALUE);var o=$t;o.longitude=e.east,o.latitude=e.north;var n=r.project(o,te);o.longitude=e.west,o.latitude=e.south;var a,s,l=r.project(o,ee),h=.5*Math.abs(n.x-l.x),c=.5*Math.abs(n.y-l.y),d=t.frustum.right/t.frustum.top,u=c*d;return h>u?s=(a=h)/d:(s=c,a=u),c=Math.max(2*a,2*s),i.x=.5*(n.x-l.x)+l.x,i.y=.5*(n.y-l.y)+l.y,(o=r.unproject(i,o)).height=c,i=r.project(o,i)}(this,t,e):void 0};var ie=new T;var re=new T;var oe=new T;k.prototype.pickEllipsoid=function(t,e,i){if(!s(t))throw new h("windowPosition is required.");var o=this._scene.canvas;if(0!==o.clientWidth&&0!==o.clientHeight){if(s(i)||(i=new r),e=a(e,d.WGS84),this._mode===I.SCENE3D)i=function(t,e,i,r){i=a(i,d.WGS84);var o=t.getPickRay(e,ie),n=v.rayEllipsoid(o,i);if(n){var s=n.start>0?n.start:n.stop;return T.getPoint(o,s,r)}}(this,t,e,i);else if(this._mode===I.SCENE2D)i=function(t,e,i,r){var o=t.getPickRay(e,re).origin;o.z=0;var n=i.unproject(o);if(!(n.latitude<-y.PI_OVER_TWO||n.latitude>y.PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(n,r)}(this,t,this._projection,i);else{if(this._mode!==I.COLUMBUS_VIEW)return;i=function(t,e,i,o){var n=t.getPickRay(e,oe),a=-n.origin.x/n.direction.x;T.getPoint(n,a,o);var s=i.unproject(new r(o.y,o.z,0));if(!(s.latitude<-y.PI_OVER_TWO||s.latitude>y.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(s,o)}(this,t,this._projection,i)}return i}};var ne=new r,ae=new r,se=new r;var le=new r;k.prototype.getPickRay=function(t,e){if(!s(t))throw new h("windowPosition is required.");s(e)||(e=new T);var i=this.frustum;return s(i.aspectRatio)&&s(i.fov)&&s(i.near)?function(t,e,i){var o=t._scene.canvas,n=o.clientWidth,a=o.clientHeight,s=Math.tan(.5*t.frustum.fovy),l=t.frustum.aspectRatio*s,h=t.frustum.near,c=2/n*e.x-1,d=2/a*(a-e.y)-1,u=t.positionWC;r.clone(u,i.origin);var p=r.multiplyByScalar(t.directionWC,h,ne);r.add(u,p,p);var g=r.multiplyByScalar(t.rightWC,c*h*l,ae),m=r.multiplyByScalar(t.upWC,d*h*s,se),f=r.add(p,g,i.direction);return r.add(f,m,f),r.subtract(f,u,f),r.normalize(f,f),i}(this,t,e):function(t,e,i){var o=t._scene.canvas,n=o.clientWidth,a=o.clientHeight,l=t.frustum;s(l._offCenterFrustum)&&(l=l._offCenterFrustum);var h=2/n*e.x-1;h*=.5*(l.right-l.left);var c=2/a*(a-e.y)-1;c*=.5*(l.top-l.bottom);var d=i.origin;return r.clone(t.position,d),r.multiplyByScalar(t.right,h,le),r.add(le,d,d),r.multiplyByScalar(t.up,c,le),r.add(le,d,d),r.clone(t.directionWC,i.direction),t._mode===I.COLUMBUS_VIEW&&r.fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}(this,t,e)};var he=new r,ce=new r;k.prototype.distanceToBoundingSphere=function(t){if(!s(t))throw new h("boundingSphere is required.");var e=r.subtract(this.positionWC,t.center,he),i=r.multiplyByScalar(this.directionWC,r.dot(e,this.directionWC),ce);return Math.max(0,r.magnitude(i)-t.radius)};var de=new i;k.prototype.getPixelSize=function(t,e,i){if(!s(t))throw new h("boundingSphere is required.");if(!s(e))throw new h("drawingBufferWidth is required.");if(!s(i))throw new h("drawingBufferHeight is required.");var r=this.distanceToBoundingSphere(t),o=this.frustum.getPixelDimensions(e,i,r,de);return Math.max(o.x,o.y)};var ue=new r,pe=new r,ge=new r,me=new r;function fe(t,e){var i=t.position,o=t.direction,n=t.worldToCameraCoordinatesVector(r.UNIT_X,ue),a=-r.dot(n,i)/r.dot(n,o),s=r.add(i,r.multiplyByScalar(o,a,pe),pe);t.cameraToWorldCoordinatesPoint(s,s),i=t.cameraToWorldCoordinatesPoint(t.position,ge);var l,h,d,u,p,g,m,f=Math.tan(.5*t.frustum.fovy),v=t.frustum.aspectRatio*f,y=r.magnitude(r.subtract(i,s,me)),_=v*y,w=f*y,P=t._maxCoord.x,b=t._maxCoord.y,C=Math.max(_-P,P),E=Math.max(w-b,b);if(i.z<-C||i.z>C||i.y<-E||i.y>E){var T=s.y<-C||s.y>C,A=s.z<-E||s.z>E;if(T||A)return l=t,h=i,d=s,u=C,p=E,g=e,m=r.clone(h),d.y>u?m.y-=d.y-u:d.y<-u&&(m.y+=-u-d.y),d.z>p?m.z-=d.z-p:d.z<-p&&(m.z+=-p-d.z),{easingFunction:c.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:g,update:function(t){var e=r.lerp(h,m,t.time,new r);l.worldToCameraCoordinatesPoint(e,l.position)}}}}k.prototype.createCorrectPositionTween=function(t){if(!s(t))throw new h("duration is required.");if(this._mode===I.COLUMBUS_VIEW)return fe(this,t)};var ve=new r,ye={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};k.prototype.cancelFlight=function(){s(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},k.prototype.flyTo=function(t){var e=(t=a(t,a.EMPTY_OBJECT)).destination;if(!s(e))throw new h("destination is required.");if(this._mode!==I.MORPHING){this.cancelFlight();var i=a(t.orientation,a.EMPTY_OBJECT);if(s(i.direction)&&(i=ut(this,e,i,pt.orientation)),s(t.duration)&&t.duration<=0){var r=pt;return r.destination=t.destination,r.orientation.heading=i.heading,r.orientation.pitch=i.pitch,r.orientation.roll=i.roll,r.convert=t.convert,r.endTransform=t.endTransform,this.setView(r),void("function"==typeof t.complete&&t.complete())}var o=s(e.west);o&&(e=this.getRectangleCameraCoordinates(e,ve));var n,l=this;ye.destination=e,ye.heading=i.heading,ye.pitch=i.pitch,ye.roll=i.roll,ye.duration=t.duration,ye.complete=function(){n===l._currentFlight&&(l._currentFlight=void 0),s(t.complete)&&t.complete()},ye.cancel=t.cancel,ye.endTransform=t.endTransform,ye.convert=!o&&t.convert,ye.maximumHeight=t.maximumHeight,ye.pitchAdjustHeight=t.pitchAdjustHeight,ye.flyOverLongitude=t.flyOverLongitude,ye.flyOverLongitudeWeight=t.flyOverLongitudeWeight,ye.easingFunction=t.easingFunction;var c=this._scene;n=c.tweens.add(M.createTween(c,ye)),this._currentFlight=n}};var _e=100;function we(t,e,i){s(i)||(i=g.clone(k.DEFAULT_OFFSET));var r,o,n,a,l=t._scene.screenSpaceCameraController.minimumZoomDistance,h=t._scene.screenSpaceCameraController.maximumZoomDistance,c=i.range;if(!s(c)||0===c){var d=e.radius;0===d?i.range=_e:t.frustum instanceof P||t._mode===I.SCENE2D?i.range=function(t,e){var i,r,o=t.frustum;s(o._offCenterFrustum)&&(o=o._offCenterFrustum);var n=o.right/o.top,a=e*n;return e>a?r=(i=e)/n:(r=e,i=a),1.5*Math.max(i,r)}(t,d):i.range=(r=d,o=t.frustum,n=Math.tan(.5*o.fovy),a=o.aspectRatio*n,Math.max(r/a,r/n)),i.range=y.clamp(i.range,l,h)}return i}k.prototype.viewBoundingSphere=function(t,e){if(!s(t))throw new h("boundingSphere is required.");if(this._mode===I.MORPHING)throw new h("viewBoundingSphere is not supported while morphing.");e=we(this,t,e),this.lookAt(t.center,e)};var Pe=new w,be=new r,Ce=new r,Ee=new r,Te=new r,Ae=new o,Se=new E,Me=new _;k.prototype.flyToBoundingSphere=function(t,e){if(!s(t))throw new h("boundingSphere is required.");e=a(e,a.EMPTY_OBJECT);var i=this._mode===I.SCENE2D||this._mode===I.COLUMBUS_VIEW;this._setTransform(w.IDENTITY);var o,n=we(this,t,e.offset);o=i?r.multiplyByScalar(r.UNIT_Z,n.range,be):Lt(n.heading,n.pitch,n.range);var l,c,u=S.eastNorthUpToFixedFrame(t.center,d.WGS84,Pe);if(w.multiplyByPoint(u,o,o),!i){if(l=r.subtract(t.center,o,Ce),r.normalize(l,l),c=w.multiplyByPointAsVector(u,r.UNIT_Z,Ee),1-Math.abs(r.dot(l,c))<y.EPSILON6){var p=E.fromAxisAngle(l,n.heading,Se),g=_.fromQuaternion(p,Me);r.fromCartesian4(w.getColumn(u,1,Ae),c),_.multiplyByVector(g,c,c)}var m=r.cross(l,c,Te);r.cross(m,l,c),r.normalize(c,c)}this.flyTo({destination:o,orientation:{direction:l,up:c},duration:e.duration,complete:e.complete,cancel:e.cancel,endTransform:e.endTransform,maximumHeight:e.maximumHeight,easingFunction:e.easingFunction,flyOverLongitude:e.flyOverLongitude,flyOverLongitudeWeight:e.flyOverLongitudeWeight,pitchAdjustHeight:e.pitchAdjustHeight})};var xe=new r,Ie=new r,ke=new r,Re=new r,De=[new r,new r,new r,new r];var Oe=new i,Le=new r,Fe=[new n,new n,new n,new n];function Be(t,e,i,r,o,n){Oe.x=t,Oe.y=e;var a=r.pickEllipsoid(Oe,o,Le);return s(a)?(Fe[i]=o.cartesianToCartographic(a,Fe[i]),1):(Fe[i]=o.cartesianToCartographic(n[i],Fe[i]),0)}k.prototype.computeViewRectangle=function(t,i){t=a(t,d.WGS84);var o=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),n=new e(r.ZERO,t.maximumRadius);if(o.computeVisibility(n)!==f.OUTSIDE){var s=this._scene.canvas,l=s.clientWidth,h=s.clientHeight,c=0,u=function(t,e){var i,o,n=e.radii,a=t.positionWC,s=r.multiplyComponents(e.oneOverRadii,a,xe),l=r.magnitude(s),h=r.normalize(s,Ie);r.equalsEpsilon(h,r.UNIT_Z,y.EPSILON10)?(i=new r(0,1,0),o=new r(0,0,1)):(i=r.normalize(r.cross(r.UNIT_Z,h,ke),ke),o=r.normalize(r.cross(h,i,Re),Re));var c=Math.sqrt(r.magnitudeSquared(s)-1),d=r.multiplyByScalar(h,1/l,xe),u=c/l,p=r.multiplyByScalar(i,u,Ie),g=r.multiplyByScalar(o,u,ke),m=r.add(d,g,De[0]);r.subtract(m,p,m),r.multiplyComponents(n,m,m);var f=r.subtract(d,g,De[1]);r.subtract(f,p,f),r.multiplyComponents(n,f,f);var v=r.subtract(d,g,De[2]);r.add(v,p,v),r.multiplyComponents(n,v,v);var _=r.add(d,g,De[3]);return r.add(_,p,_),r.multiplyComponents(n,_,_),De}(this,t);if(c+=Be(0,0,0,this,t,u),c+=Be(0,h,1,this,t,u),c+=Be(l,h,2,this,t,u),(c+=Be(l,0,3,this,t,u))<2)return A.MAX_VALUE;i=A.fromCartographicArray(Fe,i);for(var p=0,g=Fe[3].longitude,m=0;m<4;++m){var v=Fe[m].longitude,_=Math.abs(v-g);_>y.PI?p+=y.TWO_PI-_:p+=_,g=v}return y.equalsEpsilon(Math.abs(p),y.TWO_PI,y.EPSILON9)&&(i.west=-y.PI,i.east=y.PI,Fe[0].latitude>=0?i.north=y.PI_OVER_TWO:i.south=-y.PI_OVER_TWO),i}},k.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===I.SCENE2D||this.frustum instanceof C)){var t=this._scene;this.frustum=new C,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=y.toRadians(60)}},k.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===I.SCENE2D||this.frustum instanceof P)){var t=this._scene;this.frustum=new P,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=r.magnitude(this.position);var e=this.frustum.projectionMatrix;s(e)&&this._adjustOrthographicFrustum(!0)}},k.clone=function(t,e){return s(e)||(e=new k(t._scene)),r.clone(t.position,e.position),r.clone(t.direction,e.direction),r.clone(t.up,e.up),r.clone(t.right,e.right),w.clone(t._transform,e.transform),e._transformChanged=!0,e},t.GeoCamera=k}(window.Cesium),function(t){"use strict";var e=t.Cartesian2,i=t.defined,r=t.defineProperties,o=t.destroyObject,n=t.DeveloperError,a=t.KeyboardEventModifier,s=t.Math,l=t.ScreenSpaceEventHandler,h=t.ScreenSpaceEventType,c=t.CameraEventType;function d(t,e){var r=t;return i(e)&&(r+="+"+e),r}function u(t,r,o){var n=d(c.PINCH,r),a=t._update,s=t._isDown,l=t._eventStartPosition,u=t._pressTime,p=t._releaseTime;a[n]=!0,s[n]=!1,l[n]=new e;var g=t._movement[n];i(g)||(g=t._movement[n]={}),g.distance={startPosition:new e,endPosition:new e},g.angleAndHeight={startPosition:new e,endPosition:new e},g.prevAngle=0,t._eventHandler.setInputAction(function(i){t._buttonsDown++,s[n]=!0,u[n]=new Date,e.lerp(i.position1,i.position2,.5,l[n])},h.PINCH_START,r),t._eventHandler.setInputAction(function(){t._buttonsDown=Math.max(t._buttonsDown-1,0),s[n]=!1,p[n]=new Date},h.PINCH_END,r),t._eventHandler.setInputAction(function(t){if(s[n]){a[n]?(h=t,c=g,e.clone(h.distance.startPosition,c.distance.startPosition),e.clone(h.distance.endPosition,c.distance.endPosition),e.clone(h.angleAndHeight.startPosition,c.angleAndHeight.startPosition),e.clone(h.angleAndHeight.endPosition,c.angleAndHeight.endPosition),a[n]=!1,g.prevAngle=g.angleAndHeight.startPosition.x):(e.clone(t.distance.endPosition,g.distance.endPosition),e.clone(t.angleAndHeight.endPosition,g.angleAndHeight.endPosition));for(var i=g.angleAndHeight.endPosition.x,r=g.prevAngle,l=2*Math.PI;i>=r+Math.PI;)i-=l;for(;i<r-Math.PI;)i+=l;g.angleAndHeight.endPosition.x=-i*o.clientWidth/12,g.angleAndHeight.startPosition.x=-r*o.clientWidth/12}var h,c},h.PINCH_MOVE,r)}function p(t,r){var o=d(c.WHEEL,r),n=t._update;n[o]=!0;var a=t._movement[o];i(a)||(a=t._movement[o]={}),a.startPosition=new e,a.endPosition=new e,t._eventHandler.setInputAction(function(t){var i=10*s.toRadians(t);n[o]?(e.clone(e.ZERO,a.startPosition),a.endPosition.x=0,a.endPosition.y=i,n[o]=!1):a.endPosition.y=a.endPosition.y+i},h.WHEEL,r)}function g(t,r,o){var n=d(o,r),a=t._isDown,s=t._eventStartPosition,l=t._pressTime,u=t._releaseTime;a[n]=!1,s[n]=new e;var p,g,m=t._lastMovement[n];i(m)||(m=t._lastMovement[n]={startPosition:new e,endPosition:new e,valid:!1}),o===c.LEFT_DRAG?(p=h.LEFT_DOWN,g=h.LEFT_UP):o===c.RIGHT_DRAG?(p=h.RIGHT_DOWN,g=h.RIGHT_UP):o===c.MIDDLE_DRAG&&(p=h.MIDDLE_DOWN,g=h.MIDDLE_UP),t._eventHandler.setInputAction(function(i){t._buttonsDown++,m.valid=!1,a[n]=!0,l[n]=new Date,e.clone(i.position,s[n])},p,r),t._eventHandler.setInputAction(function(){t._buttonsDown=Math.max(t._buttonsDown-1,0),a[n]=!1,u[n]=new Date},g,r)}function m(t,i){e.clone(t.startPosition,i.startPosition),e.clone(t.endPosition,i.endPosition)}function f(t,r){var o=t._update,n=t._movement,a=t._lastMovement,s=t._isDown;for(var l in c)if(c.hasOwnProperty(l)){var u=c[l];if(i(u)){var p=d(u,r);o[p]=!0,i(t._lastMovement[p])||(t._lastMovement[p]={startPosition:new e,endPosition:new e,valid:!1}),i(t._movement[p])||(t._movement[p]={startPosition:new e,endPosition:new e})}}t._eventHandler.setInputAction(function(l){for(var h in c)if(c.hasOwnProperty(h)){var u=c[h];if(i(u)){var p=d(u,r);s[p]&&(o[p]?(m(n[p],a[p]),a[p].valid=!0,m(l,n[p]),o[p]=!1):e.clone(l.endPosition,n[p].endPosition))}}e.clone(l.endPosition,t._currentMousePosition)},h.MOUSE_MOVE,r)}function v(t){if(!i(t))throw new n("canvas is required.");this._eventHandler=new l(t,!0),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new e,p(this,void 0),u(this,void 0,t),g(this,void 0,c.LEFT_DRAG),g(this,void 0,c.RIGHT_DRAG),g(this,void 0,c.MIDDLE_DRAG),f(this,void 0);for(var r in a)if(a.hasOwnProperty(r)){var o=a[r];i(o)&&(p(this,o),u(this,o,t),g(this,o,c.LEFT_DRAG),g(this,o,c.RIGHT_DRAG),g(this,o,c.MIDDLE_DRAG),f(this,o))}}r(v.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var t=!(this._update[d(c.WHEEL)]&&this._update[d(c.WHEEL,a.SHIFT)]&&this._update[d(c.WHEEL,a.CTRL)]&&this._update[d(c.WHEEL,a.ALT)]);return this._buttonsDown>0||t}}}),v.prototype.isMoving=function(t,e){if(!i(t))throw new n("type is required.");var r=d(t,e);return!this._update[r]},v.prototype.getMovement=function(t,e){if(!i(t))throw new n("type is required.");var r=d(t,e);return this._movement[r]},v.prototype.getLastMovement=function(t,e){if(!i(t))throw new n("type is required.");var r=d(t,e),o=this._lastMovement[r];if(o.valid)return o},v.prototype.isButtonDown=function(t,e){if(!i(t))throw new n("type is required.");var r=d(t,e);return this._isDown[r]},v.prototype.getStartMousePosition=function(t,e){if(!i(t))throw new n("type is required.");if(t===c.WHEEL)return this._currentMousePosition;var r=d(t,e);return this._eventStartPosition[r]},v.prototype.getButtonPressTime=function(t,e){if(!i(t))throw new n("type is required.");var r=d(t,e);return this._pressTime[r]},v.prototype.getButtonReleaseTime=function(t,e){if(!i(t))throw new n("type is required.");var r=d(t,e);return this._releaseTime[r]},v.prototype.reset=function(){for(var t in this._update)this._update.hasOwnProperty(t)&&(this._update[t]=!0)},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),o(this)},t.GeoCameraEventAggregator=v}(window.Cesium),function(t){"use strict";var e=t.Cartesian2,i=t.Cartesian3,r=t.Cartesian4,o=t.Cartographic,n=t.defaultValue,a=t.defined,s=t.destroyObject,l=t.DeveloperError,h=t.Ellipsoid,c=t.HeadingPitchRoll,d=t.IntersectionTests,u=t.isArray,p=t.KeyboardEventModifier,g=t.Math,m=t.Matrix3,f=t.Matrix4,v=t.OrthographicFrustum,y=t.Plane,_=t.Quaternion,w=t.Ray,P=t.Transforms,b=t.CameraEventAggregator,C=t.CameraEventType,E=t.MapMode2D,T=t.SceneMode,A=t.SceneTransforms,S=t.TweenCollection;function M(r){if(!a(r))throw new l("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=C.LEFT_DRAG,this.zoomEventTypes=[C.WHEEL,C.PINCH],this.rotateEventTypes=C.LEFT_DRAG,this.tiltEventTypes=[C.RIGHT_DRAG,C.MIDDLE_DRAG,C.PINCH,{eventType:C.LEFT_DRAG,modifier:p.CTRL},{eventType:C.RIGHT_DRAG,modifier:p.CTRL}],this.lookEventTypes={eventType:C.LEFT_DRAG,modifier:p.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=-75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=r,this._globe=void 0,this._ellipsoid=void 0,t.GeoOption&&t.GeoOption.GeoCameraEventAggregator?this._aggregator=new t.GeoCameraEventAggregator(r.canvas):this._aggregator=new b(r.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new S,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new e(-1,-1),this._tiltCenter=new i,this._rotateMousePosition=new e(-1,-1),this._rotateStartPosition=new i,this._strafeStartPosition=new i,this._zoomMouseStart=new e(-1,-1),this._zoomWorldPosition=new i,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1;var n=r.mapProjection;this._maxCoord=n.project(new o(Math.PI,g.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}var x=.4;function I(t,i,r,o,n,s,l){var h=s[l];a(h)||(h=s[l]={startPosition:new e,endPosition:new e,motion:new e,active:!1});var c,d=t.getButtonPressTime(i,r),u=t.getButtonReleaseTime(i,r),p=d&&u&&(u.getTime()-d.getTime())/1e3,m=new Date,f=u&&(m.getTime()-u.getTime())/1e3;if(d&&u&&p<x){var v=function(t,e){if(t<0)return 0;var i=25*(1-e);return Math.exp(-i*t)}(f,o);if(h.active)h.startPosition=e.clone(h.endPosition,h.startPosition),h.endPosition=e.multiplyByScalar(h.motion,v,h.endPosition),h.endPosition=e.add(h.startPosition,h.endPosition,h.endPosition),h.motion=e.clone(e.ZERO,h.motion);else{var y=t.getLastMovement(i,r);if(!a(y)||(c=y,e.equalsEpsilon(c.startPosition,c.endPosition,g.EPSILON14)))return;h.motion.x=.5*(y.endPosition.x-y.startPosition.x),h.motion.y=.5*(y.endPosition.y-y.startPosition.y),h.startPosition=e.clone(y.startPosition,h.startPosition),h.endPosition=e.multiplyByScalar(h.motion,v,h.endPosition),h.endPosition=e.add(h.startPosition,h.endPosition,h.endPosition),h.active=!0}if(isNaN(h.endPosition.x)||isNaN(h.endPosition.y)||e.distance(h.startPosition,h.endPosition)<.5)return void(h.active=!1);if(!t.isButtonDown(i,r))n(s,t.getStartMousePosition(i,r),h)}else h.active=!1}var k=[];function R(t,e,i,r,o,n){if(a(i)){var s=t._aggregator;u(i)||(k[0]=i,i=k);for(var l=i.length,h=0;h<l;++h){var c=i[h],d=a(c.eventType)?c.eventType:c,p=c.modifier,g=s.isMoving(d,p)&&s.getMovement(d,p),m=s.getStartMousePosition(d,p);t.enableInputs&&e&&(g?r(t,m,g):o<1&&I(s,d,p,o,r,t,n))}}}var D=new w,O=new i,L=new e,F=new i,B=new e,H=new i,U=new i,N=new i,W=new i,G=new i,z=new i,V=new i,q=new i,j=new i,Z=new i,Y=new i,K=new i,X=new i,Q=new i,J=new i,$=new i,tt=new i,et=new i,it={orientation:new c};function rt(t,r,o,n,s,l){var h=1;a(l)&&(h=g.clamp(Math.abs(l),.25,1));var c=t.minimumZoomDistance*h,d=t.maximumZoomDistance,u=n*(s-c);u=g.clamp(u,t._minimumZoomRate,t._maximumZoomRate);var p=(o.endPosition.y-o.startPosition.y)/t._scene.canvas.clientHeight,m=u*(p=Math.min(p,t.maximumMovementRatio));if(!(m>0&&Math.abs(s-c)<1||m<0&&Math.abs(s-d)<1)){s-m<c?m=s-c-1:s-m>d&&(m=s-d);var f=t._scene,y=f.camera,_=f.mode,w=it.orientation;if(w.heading=y.heading,w.pitch=y.pitch,w.roll=y.roll,y.frustum instanceof v)Math.abs(m)>0&&(y.zoomIn(m),y._adjustOrthographicFrustum());else{var P,b=e.equals(r,t._zoomMouseStart),C=t._zoomingOnVector,E=t._rotatingZoom;if(b||(t._zoomMouseStart=e.clone(r,t._zoomMouseStart),a(t._globe)&&(P=_!==T.SCENE2D?mt(t,r,O):y.getPickRay(r,D).origin),a(P)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=i.clone(P,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,C=t._zoomingOnVector=!1,E=t._rotatingZoom=!1),t._useZoomWorldPosition){var S=_===T.COLUMBUS_VIEW;if(y.positionCartographic.height<2e6&&(E=!0),!b||E){if(_===T.SCENE2D){var M=t._zoomWorldPosition,x=y.position;if(!i.equals(M,x)&&y.positionCartographic.height<2*t._maxCoord.x){var I=y.position.x,k=i.subtract(M,x,F);i.normalize(k,k);var R=i.distance(M,x)*m/(.5*y.getMagnitude());y.move(k,.5*R),(y.position.x<0&&I>0||y.position.x>0&&I<0)&&(P=y.getPickRay(r,D).origin,t._zoomWorldPosition=i.clone(P,t._zoomWorldPosition))}}else if(_===T.SCENE3D){var rt=i.normalize(y.position,G);if(y.positionCartographic.height<3e3&&Math.abs(i.dot(y.direction,rt))<.6)S=!0;else{var ot=f.canvas,nt=B;nt.x=ot.clientWidth/2,nt.y=ot.clientHeight/2;var at=mt(t,nt,H);if(a(at)&&y.positionCartographic.height<1e6){var st=V;i.clone(y.position,st);var lt=t._zoomWorldPosition,ht=z;if(ht=i.normalize(lt,ht),i.dot(ht,rt)<0)return;var ct=J,dt=Z;i.clone(y.direction,dt),i.add(st,i.multiplyByScalar(dt,1e3,$),ct);var ut=Y,pt=K;i.subtract(lt,st,ut),i.normalize(ut,pt);var gt=i.dot(rt,pt);if(gt>=0)return void(t._zoomMouseStart.x=-1);var ft=Math.acos(-gt),vt=i.magnitude(st),yt=i.magnitude(lt),_t=vt-m,wt=i.magnitude(ut),Pt=Math.asin(g.clamp(wt/yt*Math.sin(ft),-1,1))-Math.asin(g.clamp(_t/yt*Math.sin(ft),-1,1))+ft,bt=q;i.normalize(st,bt);var Ct=j;Ct=i.cross(pt,bt,Ct),Ct=i.normalize(Ct,Ct),i.normalize(i.cross(bt,Ct,$),dt),i.multiplyByScalar(i.normalize(ct,$),i.magnitude(ct)-m,ct),i.normalize(st,st),i.multiplyByScalar(st,_t,st);var Et=X;i.multiplyByScalar(i.add(i.multiplyByScalar(bt,Math.cos(Pt)-1,tt),i.multiplyByScalar(dt,Math.sin(Pt),et),$),_t,Et),i.add(st,Et,st),i.normalize(ct,bt),i.normalize(i.cross(bt,Ct,$),dt);var Tt=Q;return i.multiplyByScalar(i.add(i.multiplyByScalar(bt,Math.cos(Pt)-1,tt),i.multiplyByScalar(dt,Math.sin(Pt),et),$),i.magnitude(ct),Tt),i.add(ct,Tt,ct),i.clone(st,y.position),i.normalize(i.subtract(ct,st,$),y.direction),i.clone(y.direction,y.direction),i.cross(y.direction,y.up,y.right),i.cross(y.right,y.direction,y.up),void y.setView(it)}if(a(at)){var At=i.normalize(at,U),St=i.normalize(t._zoomWorldPosition,N),Mt=i.dot(St,At);if(Mt>0&&Mt<1){var xt=g.acosClamped(Mt),It=i.cross(St,At,W),kt=m/(Math.abs(xt)>g.toRadians(20)?.75*y.positionCartographic.height:y.positionCartographic.height-m);y.rotate(It,xt*kt)}}else S=!0}}t._rotatingZoom=!S}if(!b&&S||C){var Rt=A.wgs84ToWindowCoordinates(f,t._zoomWorldPosition,L),Dt=(_!==T.COLUMBUS_VIEW&&e.equals(r,t._zoomMouseStart)&&a(Rt)?y.getPickRay(Rt,D):y.getPickRay(r,D)).direction;_===T.COLUMBUS_VIEW&&i.fromElements(Dt.y,Dt.z,Dt.x,Dt),y.move(Dt,m),t._zoomingOnVector=!0}else y.zoomIn(m);y.setView(it)}else y.zoomIn(m)}}}var ot=new w,nt=new w,at=new i;function st(t,e,r){var o=t._scene.camera,n=o.getPickRay(r.startPosition,ot).origin,a=o.getPickRay(r.endPosition,nt).origin,s=i.subtract(n,a,at),l=i.magnitude(s);l>0&&(i.normalize(s,s),o.move(s,l))}function lt(t,e,i){a(i.distance)&&(i=i.distance);var r=t._scene.camera;rt(t,e,i,t._zoomFactor,r.getMagnitude())}var ht=new e,ct=new e;function dt(t,i,r){if(a(r.angleAndHeight))!function(t,e,i){var r=t._rotateFactor*t._rotateRateRangeAdjustment;r>t._maximumRotateRate&&(r=t._maximumRotateRate);r<t._minimumRotateRate&&(r=t._minimumRotateRate);var o=t._scene,n=o.camera,a=o.canvas,s=(i.endPosition.x-i.startPosition.x)/a.clientWidth;s=Math.min(s,t.maximumMovementRatio);var l=r*s*Math.PI*4;n.twistRight(l)}(t,0,r.angleAndHeight);else{var o=t._scene,n=o.camera,s=o.canvas,l=s.clientWidth,h=s.clientHeight,c=ht;c.x=2/l*r.startPosition.x-1,c.y=2/h*(h-r.startPosition.y)-1,c=e.normalize(c,c);var d=ct;d.x=2/l*r.endPosition.x-1,d.y=2/h*(h-r.endPosition.y)-1,d=e.normalize(d,d);var u=g.acosClamped(c.x);c.y<0&&(u=g.TWO_PI-u);var p=g.acosClamped(d.x);d.y<0&&(p=g.TWO_PI-p);var m=p-u;n.twistRight(m)}}var ut=new w,pt=new i,gt=new i;function mt(t,e,r){var o=t._scene,n=t._globe,s=o.camera;if(a(n)){var l;o.pickPositionSupported&&(l=o.pickPositionWorldCoordinates(e,pt));var h=s.getPickRay(e,ut),c=n.pick(h,o,gt);return(a(l)?i.distance(l,s.positionWC):Number.POSITIVE_INFINITY)<(a(c)?i.distance(c,s.positionWC):Number.POSITIVE_INFINITY)?i.clone(l,r):i.clone(c,r)}}var ft=new w,vt=new w,yt=new i,_t=new i,wt=new i,Pt=new i,bt=new y(i.UNIT_X,0),Ct=new e,Et=new e;function Tt(t,r,o){if(i.equals(r,t._translateMousePosition)||(t._looking=!1),i.equals(r,t._strafeMousePosition)||(t._strafing=!1),t._looking)Le(t,r,o);else if(t._strafing)Xt(t,r,o);else{var n,s=t._scene.camera,l=e.clone(o.startPosition,Ct),h=e.clone(o.endPosition,Et),c=s.getPickRay(l,ft),u=i.clone(i.ZERO,Pt),p=i.UNIT_X;if(s.position.z<t._minimumPickingTerrainHeight&&(n=mt(t,l,yt),a(n)&&(u.x=n.x)),u.x>s.position.z&&a(n))return i.clone(n,t._strafeStartPosition),t._strafing=!0,Xt(t,r,o),void(t._strafeMousePosition=e.clone(r,t._strafeMousePosition));var m=y.fromPointNormal(u,p,bt);c=s.getPickRay(l,ft);var f=d.rayPlane(c,m,yt),v=s.getPickRay(h,vt),_=d.rayPlane(v,m,_t);if(!a(f)||!a(_))return t._looking=!0,Le(t,r,o),void e.clone(r,t._translateMousePosition);var w=i.subtract(f,_,wt),P=w.x;w.x=w.y,w.y=w.z,w.z=P;var b=i.magnitude(w);b>g.EPSILON6&&(i.normalize(w,w),s.move(w,b))}}var At=new e,St=new w,Mt=new i,xt=new i,It=new f,kt=new f,Rt=new i,Dt=new y(i.UNIT_X,0),Ot=new i,Lt=new o,Ft=new f,Bt=new _,Ht=new m,Ut=new i;function Nt(t,r,o){if(a(o.angleAndHeight)&&(o=o.angleAndHeight),e.equals(r,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking)Le(t,r,o);else{var n=t._scene.camera,s=t._maxCoord,l=Math.abs(n.position.x)-s.x<0&&Math.abs(n.position.y)-s.y<0;t._tiltCVOffMap||!l||n.position.z>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,function(t,r,o){var n=t._scene,s=n.camera,l=n.canvas,c=At;c.x=l.clientWidth/2,c.y=l.clientHeight/2;var d,u=s.getPickRay(c,St),p=i.UNIT_X,m=u.origin,v=u.direction,y=i.dot(p,v);Math.abs(y)>g.EPSILON6&&(d=-i.dot(p,m)/y);if(!a(d)||d<=0)return t._looking=!0,Le(t,r,o),void e.clone(r,t._tiltCenterMousePosition);var _=i.multiplyByScalar(v,d,Mt);i.add(m,_,_);var w=n.mapProjection,b=w.ellipsoid;i.fromElements(_.y,_.z,_.x,_);var C=w.unproject(_,Lt);b.cartographicToCartesian(C,_);var E=P.eastNorthUpToFixedFrame(_,b,It),T=t._globe,A=t._ellipsoid;t._globe=void 0,t._ellipsoid=h.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var S=f.clone(s.transform,Ft);s._setTransform(E),re(t,r,o,i.UNIT_Z),s._setTransform(S),t._globe=T,t._ellipsoid=A;var M=A.maximumRadius;t._rotateFactor=1/M,t._rotateRateRangeAdjustment=M}(t,r,o)):function(t,r,o){var n,s,l=t._scene,c=l.camera,u=i.UNIT_X;if(e.equals(r,t._tiltCenterMousePosition))n=i.clone(t._tiltCenter,Mt);else{if(c.position.z<t._minimumPickingTerrainHeight&&(n=mt(t,r,Mt)),!a(n)){var p,v=(s=c.getPickRay(r,St)).origin,w=s.direction,b=i.dot(u,w);if(Math.abs(b)>g.EPSILON6&&(p=-i.dot(u,v)/b),!a(p)||p<=0)return t._looking=!0,Le(t,r,o),void e.clone(r,t._tiltCenterMousePosition);n=i.multiplyByScalar(w,p,Mt),i.add(v,n,n)}e.clone(r,t._tiltCenterMousePosition),i.clone(n,t._tiltCenter)}var C=l.canvas,E=At;E.x=C.clientWidth/2,E.y=t._tiltCenterMousePosition.y,s=c.getPickRay(E,St);var T=i.clone(i.ZERO,Rt);T.x=n.x;var A=y.fromPointNormal(T,u,Dt),S=d.rayPlane(s,A,xt),M=c._projection,x=M.ellipsoid;i.fromElements(n.y,n.z,n.x,n);var I=M.unproject(n,Lt);x.cartographicToCartesian(I,n);var k,R=P.eastNorthUpToFixedFrame(n,x,It);a(S)?(i.fromElements(S.y,S.z,S.x,S),I=M.unproject(S,Lt),x.cartographicToCartesian(I,S),k=P.eastNorthUpToFixedFrame(S,x,kt)):k=R;var D=t._globe,O=t._ellipsoid;t._globe=void 0,t._ellipsoid=h.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var L=i.UNIT_Z,F=f.clone(c.transform,Ft);c._setTransform(R);var B=i.cross(i.UNIT_Z,i.normalize(c.position,Ot),Ot),H=i.dot(c.right,B);if(re(t,r,o,L,!1,!0),c._setTransform(k),H<0){o.startPosition.y>o.endPosition.y&&(L=void 0);var U=c.constrainedAxis;c.constrainedAxis=void 0,re(t,r,o,L,!0,!1),c.constrainedAxis=U}else re(t,r,o,L,!0,!1);if(a(c.constrainedAxis)){var N=i.cross(c.direction,c.constrainedAxis,Ut);i.equalsEpsilon(N,i.ZERO,g.EPSILON6)||(i.dot(N,c.right)<0&&i.negate(N,N),i.cross(N,c.direction,c.up),i.cross(c.direction,c.up,c.right),i.normalize(c.up,c.up),i.normalize(c.right,c.right))}c._setTransform(F),t._globe=D,t._ellipsoid=O;var W=O.maximumRadius;t._rotateFactor=1/W,t._rotateRateRangeAdjustment=W;var G=i.clone(c.positionWC,Ot);if(c._adjustHeightForTerrain(),!i.equals(c.positionWC,G)){c._setTransform(k),c.worldToCameraCoordinatesPoint(G,G);var z=i.magnitudeSquared(G);i.magnitudeSquared(c.position)>z&&(i.normalize(c.position,c.position),i.multiplyByScalar(c.position,Math.sqrt(z),c.position));var V=i.angleBetween(G,c.position),q=i.cross(G,c.position,G);i.normalize(q,q);var j=_.fromAxisAngle(q,V,Bt),Z=m.fromQuaternion(j,Ht);m.multiplyByVector(Z,c.direction,c.direction),m.multiplyByVector(Z,c.up,c.up),i.cross(c.direction,c.up,c.right),i.cross(c.right,c.direction,c.up),c._setTransform(F)}}(t,r,o)}}var Wt=new e,Gt=new w,zt=new i;function Vt(t,e,r){a(r.distance)&&(r=r.distance);var o=t._scene,n=o.camera,s=o.canvas,l=Wt;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var h,c,d=n.getPickRay(l,Gt);if(n.position.z<t._minimumPickingTerrainHeight&&(h=mt(t,l,zt)),a(h))c=i.distance(d.origin,h);else{var u=i.UNIT_X,p=d.origin,g=d.direction;c=-i.dot(u,p)/i.dot(u,g)}rt(t,e,r,t._zoomFactor,c)}var qt=new w,jt=new y(i.UNIT_X,0),Zt=new i,Yt=new i,Kt=new i;function Xt(t,e,r){var o=t._scene,n=o.camera,s=mt(t,r.startPosition,Kt);if(a(s)){var l=r.endPosition,h=n.getPickRay(l,qt),c=i.clone(n.direction,Yt);o.mode===T.COLUMBUS_VIEW&&i.fromElements(c.z,c.x,c.y,c);var u=y.fromPointNormal(s,c,jt),p=d.rayPlane(h,u,Zt);a(p)&&(c=i.subtract(s,p,c),o.mode===T.COLUMBUS_VIEW&&i.fromElements(c.y,c.z,c.x,c),i.add(n.position,c,n.position))}}var Qt=new i,Jt=new o,$t=new i,te=new h,ee=new i;function ie(t,r,o){var n=t._scene.camera;if(f.equals(n.transform,f.IDENTITY)){var s,l,c,d=t._ellipsoid.geodeticSurfaceNormal(n.position,ee),u=t._ellipsoid.cartesianToCartographic(n.positionWC,Jt).height,p=t._globe;if(a(p)&&u<t._minimumPickingTerrainHeight&&(c=mt(t,o.startPosition,Kt),a(c))){var g=n.getPickRay(o.startPosition,ut),m=t._ellipsoid.geodeticSurfaceNormal(c);Math.abs(i.dot(g.direction,m))<.05&&!t._looking&&(t._rotating=!1,t._strafing=!0)}e.equals(r,t._rotateMousePosition)?t._looking?Le(t,r,o,d):t._rotating?re(t,r,o):t._strafing?(i.clone(c,t._strafeStartPosition),Xt(t,0,o)):(s=i.magnitude(t._rotateStartPosition),(l=$t).x=l.y=l.z=s,ue(t,r,o,h.fromCartesian3(l,te))):(t._looking=!1,t._rotating=!1,t._strafing=!1,a(p)&&u<t._minimumPickingTerrainHeight?a(c)?i.magnitude(n.position)<i.magnitude(c)?(i.clone(c,t._strafeStartPosition),t._strafing=!0,Xt(t,0,o)):(s=i.magnitude(c),(l=$t).x=l.y=l.z=s,ue(t,r,o,h.fromCartesian3(l,te)),i.clone(c,t._rotateStartPosition)):(t._looking=!0,Le(t,r,o,d)):a(n.pickEllipsoid(o.startPosition,t._ellipsoid,Qt))?(ue(t,r,o,t._ellipsoid),i.clone(Qt,t._rotateStartPosition)):u>t._minimumTrackBallHeight?(t._rotating=!0,re(t,r,o)):(t._looking=!0,Le(t,r,o,d)),e.clone(r,t._rotateMousePosition))}else re(t,r,o)}function re(t,e,r,o,s,l){s=n(s,!1),l=n(l,!1);var h=t._scene,c=h.camera,d=h.canvas,u=c.constrainedAxis;a(o)&&(c.constrainedAxis=o);var p=i.magnitude(c.position),g=t._rotateFactor*(p-t._rotateRateRangeAdjustment);g>t._maximumRotateRate&&(g=t._maximumRotateRate),g<t._minimumRotateRate&&(g=t._minimumRotateRate);var m=(r.startPosition.x-r.endPosition.x)/d.clientWidth,f=(r.startPosition.y-r.endPosition.y)/d.clientHeight;m=Math.min(m,t.maximumMovementRatio),f=Math.min(f,t.maximumMovementRatio);var v=g*m*Math.PI*2,y=g*f*Math.PI;s||c.rotateRight(v),l||c.rotateUp(y),c.constrainedAxis=u}var oe=r.clone(r.UNIT_W),ne=r.clone(r.UNIT_W),ae=new i,se=new i,le=new i,he=new i,ce=new e,de=new e;function ue(t,r,o,n){var s=t._scene.camera,l=e.clone(o.startPosition,ce),h=e.clone(o.endPosition,de),c=s.pickEllipsoid(l,n,oe),d=s.pickEllipsoid(h,n,ne);if(!a(c)||!a(d))return t._rotating=!0,void re(t,0,o);if(c=s.worldToCameraCoordinates(c,c),d=s.worldToCameraCoordinates(d,d),a(s.constrainedAxis)){var u=s.constrainedAxis,p=i.mostOrthogonalAxis(u,ae);i.cross(p,u,p),i.normalize(p,p);var m=i.cross(u,p,se),f=i.magnitude(c),v=i.dot(u,c),y=Math.acos(v/f),_=i.multiplyByScalar(u,v,le);i.subtract(c,_,_),i.normalize(_,_);var w=i.magnitude(d),P=i.dot(u,d),b=Math.acos(P/w),C=i.multiplyByScalar(u,P,he);i.subtract(d,C,C),i.normalize(C,C);var E=Math.acos(i.dot(_,p));i.dot(_,m)<0&&(E=g.TWO_PI-E);var T=Math.acos(i.dot(C,p));i.dot(C,m)<0&&(T=g.TWO_PI-T);var A,S=E-T;A=i.equalsEpsilon(u,s.position,g.EPSILON2)?s.right:i.cross(u,s.position,ae);var M,x=i.cross(u,A,ae),I=i.dot(x,i.subtract(c,u,se)),k=i.dot(x,i.subtract(d,u,se));M=I>0&&k>0?b-y:I>0&&k<=0?i.dot(s.position,u)>0?-y-b:y+b:y-b,s.rotateRight(S),s.rotateUp(M)}else{i.normalize(c,c),i.normalize(d,d);var R=i.dot(c,d),D=i.cross(c,d,ae);if(R<1&&!i.equalsEpsilon(D,i.ZERO,g.EPSILON14)){var O=Math.acos(R);s.rotate(D,O)}}}var pe=new i,ge=new o;function me(t,e,r){a(r.distance)&&(r=r.distance);var o=t._ellipsoid,n=t._scene,s=n.camera,l=n.canvas,h=Wt;h.x=l.clientWidth/2,h.y=l.clientHeight/2;var c,d,u=s.getPickRay(h,Gt),p=o.cartesianToCartographic(s.position,ge).height;p<t._minimumPickingTerrainHeight&&(c=mt(t,h,zt)),d=a(c)?i.distance(u.origin,c):p;var g=i.normalize(s.position,pe);rt(t,e,r,t._zoomFactor,d,i.dot(g,s.direction))}var fe=new e,ve=new w,ye=new i,_e=new i,we=new f,Pe=new f,be=new f,Ce=new _,Ee=new m,Te=new o,Ae=new i;function Se(t,r,o){var n=t._scene.camera;if(o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2),f.equals(n.transform,f.IDENTITY))if(a(o.angleAndHeight)&&(o=o.angleAndHeight),e.equals(r,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){Le(t,r,o,t._ellipsoid.geodeticSurfaceNormal(n.position,Ae))}else{var s=t._ellipsoid.cartesianToCartographic(n.position,Te);t._tiltOnEllipsoid||s.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,function(t,r,o){var n=t._ellipsoid,s=t._scene,l=s.camera,c=.25*t.minimumZoomDistance,u=n.cartesianToCartographic(l.positionWC,Me).height;if(u-c-1<g.EPSILON3&&o.endPosition.y-o.startPosition.y<0)return;var p=s.canvas,m=fe;m.x=p.clientWidth/2,m.y=p.clientHeight/2;var v,y=l.getPickRay(m,ve),_=d.rayEllipsoid(y,n);if(a(_))v=w.getPoint(y,_.start,ye);else{if(!(u>t._minimumTrackBallHeight)){t._looking=!0;var b=t._ellipsoid.geodeticSurfaceNormal(l.position,Ae);return Le(t,r,o,b),void e.clone(r,t._tiltCenterMousePosition)}var C=d.grazingAltitudeLocation(y,n);if(!a(C))return;var E=n.cartesianToCartographic(C,Te);E.height=0,v=n.cartographicToCartesian(E,ye)}var T=P.eastNorthUpToFixedFrame(v,n,we),A=t._globe,S=t._ellipsoid;t._globe=void 0,t._ellipsoid=h.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var M=f.clone(l.transform,be);l._setTransform(T),re(t,0,o,i.UNIT_Z),l._setTransform(M),t._globe=A,t._ellipsoid=S;var x=S.maximumRadius;t._rotateFactor=1/x,t._rotateRateRangeAdjustment=x}(t,r,o)):function(t,r,o){var n,s,l,c=t._ellipsoid,u=t._scene,p=u.camera;if(e.equals(r,t._tiltCenterMousePosition))n=i.clone(t._tiltCenter,ye);else{if(n=mt(t,r,ye),!a(n)){if(s=p.getPickRay(r,ve),l=d.rayEllipsoid(s,c),!a(l)){var v=c.cartesianToCartographic(p.position,Te);if(v.height<=t._minimumTrackBallHeight){t._looking=!0;var y=t._ellipsoid.geodeticSurfaceNormal(p.position,Ae);Le(t,r,o,y),e.clone(r,t._tiltCenterMousePosition)}return}n=w.getPoint(s,l.start,ye)}e.clone(r,t._tiltCenterMousePosition),i.clone(n,t._tiltCenter)}var b=u.canvas,C=fe;C.x=b.clientWidth/2,C.y=t._tiltCenterMousePosition.y,s=p.getPickRay(C,ve);var E=i.magnitude(n),T=i.fromElements(E,E,E,$t),A=h.fromCartesian3(T,te);if(l=d.rayEllipsoid(s,A),!a(l))return;var S=i.magnitude(s.origin)>E?l.start:l.stop,M=w.getPoint(s,S,_e),x=P.eastNorthUpToFixedFrame(n,c,we),I=P.eastNorthUpToFixedFrame(M,A,Pe),k=t._globe,R=t._ellipsoid;t._globe=void 0,t._ellipsoid=h.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var D=i.UNIT_Z,O=f.clone(p.transform,be);p._setTransform(x);var L=i.cross(M,p.positionWC,Ut),F=i.dot(p.rightWC,L);if(re(t,0,o,D,!1,!0),p._setTransform(I),F<0){o.startPosition.y>o.endPosition.y&&(D=void 0);var B=p.constrainedAxis;p.constrainedAxis=void 0,re(t,0,o,D,!0,!1),p.constrainedAxis=B}else re(t,0,o,D,!0,!1);if(a(p.constrainedAxis)){var H=i.cross(p.direction,p.constrainedAxis,Ut);i.equalsEpsilon(H,i.ZERO,g.EPSILON6)||(i.dot(H,p.right)<0&&i.negate(H,H),i.cross(H,p.direction,p.up),i.cross(p.direction,p.up,p.right),i.normalize(p.up,p.up),i.normalize(p.right,p.right))}p._setTransform(O),t._globe=k,t._ellipsoid=R;var U=R.maximumRadius;t._rotateFactor=1/U,t._rotateRateRangeAdjustment=U;var N=i.clone(p.positionWC,Ut);if(p._adjustHeightForTerrain(),!i.equals(p.positionWC,N)){p._setTransform(I),p.worldToCameraCoordinatesPoint(N,N);var W=i.magnitudeSquared(N);i.magnitudeSquared(p.position)>W&&(i.normalize(p.position,p.position),i.multiplyByScalar(p.position,Math.sqrt(W),p.position));var G=i.angleBetween(N,p.position),z=i.cross(N,p.position,N);i.normalize(z,z);var V=_.fromAxisAngle(z,G,Ce),q=m.fromQuaternion(V,Ee);m.multiplyByVector(q,p.direction,p.direction),m.multiplyByVector(q,p.up,p.up),i.cross(p.direction,p.up,p.right),i.cross(p.right,p.direction,p.up),p._setTransform(O)}}(t,r,o)}}var Me=new o;var xe=new e,Ie=new e,ke=new w,Re=new w,De=new i,Oe=new i;function Le(t,e,r,o){var s=t._scene.camera,l=xe;l.x=r.startPosition.x,l.y=0;var h=Ie;h.x=r.endPosition.x,h.y=0;var c,d,u=s.getPickRay(l,ke),p=s.getPickRay(h,Re),m=0;s.frustum instanceof v?(c=u.origin,d=p.origin,i.add(s.direction,c,c),i.add(s.direction,d,d),i.subtract(c,s.position,c),i.subtract(d,s.position,d),i.normalize(c,c),i.normalize(d,d)):(c=u.direction,d=p.direction);var f=i.dot(c,d);f<1&&(m=Math.acos(f)),m=r.startPosition.x>r.endPosition.x?-m:m;var y=t._horizontalRotationAxis;if(a(o)?s.look(o,-m):a(y)?s.look(y,-m):s.lookLeft(m),l.x=0,l.y=r.startPosition.y,h.x=0,h.y=r.endPosition.y,u=s.getPickRay(l,ke),p=s.getPickRay(h,Re),m=0,s.frustum instanceof v?(c=u.origin,d=p.origin,i.add(s.direction,c,c),i.add(s.direction,d,d),i.subtract(c,s.position,c),i.subtract(d,s.position,d),i.normalize(c,c),i.normalize(d,d)):(c=u.direction,d=p.direction),(f=i.dot(c,d))<1&&(m=Math.acos(f)),m=r.startPosition.y>r.endPosition.y?-m:m,o=n(o,y),a(o)){var _=s.direction,w=i.negate(o,De),P=i.equalsEpsilon(_,o,g.EPSILON2),b=i.equalsEpsilon(_,w,g.EPSILON2);if(P||b)(P&&m<0||b&&m>0)&&s.look(s.right,-m);else{f=i.dot(_,o);var C=g.acosClamped(f);m>0&&m>C&&(m=C-g.EPSILON4),f=i.dot(_,w),C=g.acosClamped(f),m<0&&-m>C&&(m=-C+g.EPSILON4);var E=i.cross(o,_,Oe);s.look(E,m)}}else s.lookUp(m)}M.prototype.update=function(){f.equals(this._scene.camera.transform,f.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=a(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=h.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var t=this._ellipsoid.maximumRadius;this._rotateFactor=1/t,this._rotateRateRangeAdjustment=t;var e,r,o,n=this._scene.mode;n===T.SCENE2D?(o=(r=this)._scene.mapMode2D===E.ROTATE,f.equals(f.IDENTITY,r._scene.camera.transform)?(R(r,r.enableTranslate,r.translateEventTypes,st,r.inertiaTranslate,"_lastInertiaTranslateMovement"),R(r,r.enableZoom,r.zoomEventTypes,lt,r.inertiaZoom,"_lastInertiaZoomMovement"),o&&R(r,r.enableRotate,r.tiltEventTypes,dt,r.inertiaSpin,"_lastInertiaTiltMovement")):(R(r,r.enableZoom,r.zoomEventTypes,lt,r.inertiaZoom,"_lastInertiaZoomMovement"),o&&R(r,r.enableRotate,r.translateEventTypes,dt,r.inertiaSpin,"_lastInertiaSpinMovement"))):n===T.COLUMBUS_VIEW?(this._horizontalRotationAxis=i.UNIT_Z,function(t){var e=t._scene.camera;if(f.equals(f.IDENTITY,e.transform)){var i=t._tweens;if(t._aggregator.anyButtonDown&&i.removeAll(),R(t,t.enableTilt,t.tiltEventTypes,Nt,t.inertiaSpin,"_lastInertiaTiltMovement"),R(t,t.enableTranslate,t.translateEventTypes,Tt,t.inertiaTranslate,"_lastInertiaTranslateMovement"),R(t,t.enableZoom,t.zoomEventTypes,Vt,t.inertiaZoom,"_lastInertiaZoomMovement"),R(t,t.enableLook,t.lookEventTypes,Le),!(t._aggregator.anyButtonDown||a(t._lastInertiaZoomMovement)&&t._lastInertiaZoomMovement.active||a(t._lastInertiaTranslateMovement)&&t._lastInertiaTranslateMovement.active||i.contains(t._tween))){var r=e.createCorrectPositionTween(t.bounceAnimationTime);a(r)&&(t._tween=i.add(r))}i.update()}else R(t,t.enableRotate,t.rotateEventTypes,re,t.inertiaSpin,"_lastInertiaSpinMovement"),R(t,t.enableZoom,t.zoomEventTypes,me,t.inertiaZoom,"_lastInertiaZoomMovement")}(this)):n===T.SCENE3D&&(this._horizontalRotationAxis=void 0,R(e=this,e.enableRotate,e.rotateEventTypes,ie,e.inertiaSpin,"_lastInertiaSpinMovement"),R(e,e.enableZoom,e.zoomEventTypes,me,e.inertiaZoom,"_lastInertiaZoomMovement"),R(e,e.enableTilt,e.tiltEventTypes,Se,2,"_lastInertiaTiltMovement"),R(e,e.enableLook,e.lookEventTypes,Le)),this._aggregator.reset()},M.prototype.isDestroyed=function(){return!1},M.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),s(this)},t.GeoScreenSpaceCameraController=M}(window.Cesium),function(t){"use strict";var i=t.defaultValue;t.defined;function r(e){e=i(e,i.EMPTY_OBJECT),this.proxy=e.proxy,this.viewer=e.viewer,this.url=e.url,this.labelGraphics=e.labelGraphics?e.labelGraphics:{},this.billboardGraphics=e.billboardGraphics?e.billboardGraphics:{},this.aotuCollide=!!e.aotuCollide,this.collisionWidthScale=isNaN(e.collisionWidthScale)?parseFloat(e.collisionWidthScale):1,this.collisionHeigthScale=isNaN(e.collisionHeigthScale)?parseFloat(e.collisionHeigthScale):1,this.tileCache=[],this.labelCache=[],this._latelyGrid=[],this._latelyRefreshStamp=0,this._UUID="GEO_WTFS_LABEL_"+t.createGuid(),this.bindEvent()}function o(t,e){var i=t.x,r=t.y,o=2*t.width,n=2*t.height,a=e.x,s=e.y,l=2*e.width,h=2*e.height;return!(i>=a&&i>=a+l)&&(!(i<=a&&i+o<=a)&&(!(r>=s&&r>=s+h)&&!(r<=s&&r+n<=s)))}t.defineProperties(r.prototype,{}),r.prototype.getCacheTile=function(t,e,i){for(var r=0;r<this.tileCache.length;r++)if(this.tileCache[r].x===t&&this.tileCache[r].y===e&&this.tileCache[r].z===i)return this.tileCache[r];return null},r.prototype.addCacheTile=function(t){this.tileCache.length>999&&this.tileCache.splice(0,500),this.removeCacheTile(t.x,t.y,t.z),this.tileCache.push(t)},r.prototype.removeCacheTile=function(t,e,i){for(var r=0;r<this.tileCache.length;r++)if(this.tileCache[r].x===t&&this.tileCache[r].y===e&&this.tileCache[r].z===i){this.tileCache.splice(r,1);break}},r.prototype.getCacheLabel=function(t){for(var e=0;e<this.labelCache.length;e++)if(this.labelCache[e].name===this._UUID&&this.labelCache[e].oid===t)return this.labelCache[e];return null},r.prototype.addCacheLabel=function(t){this.labelCache.length>999&&this.labelCache.splice(0,250),this.removeCacheLabel(t.oid),t.timestamp=(new Date).getTime(),this.labelCache.push(t)},r.prototype.removeCacheLabel=function(t){for(var e=0;e<this.labelCache.length;e++)if(this.labelCache[e].name===this._UUID&&this.labelCache[e].oid===t){this.labelCache.splice(e,1);break}},r.prototype.getTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetTiles?lxys={z},{x},{y}"},r.prototype.getIcoUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetIcon?id={id}"},r.prototype._moveEnd=function(){var t=this;if(clearTimeout(this._timer),0==this.viewer.scene.globe._surface._tilesToRender.length||0!=this.viewer.scene.globe._surface._tileLoadQueueHigh.length)this._timer=setTimeout(function(){t._moveEnd()},200);else{if(this.compareArray(this.viewer.scene.globe._surface._tilesToRender,this._latelyGrid))return;this._latelyGrid=this.viewer.scene.globe._surface._tilesToRender.map(function(t,e,i){return{x:t.x,y:t.y,level:t.level}}),this._latelyRefreshStamp=(new Date).getTime(),this.viewer.scene.globe._surface._tilesToRender.forEach(function(i,r,o){var n=t.getCacheTile(i.x,i.y,i.level+1);if(n)t.addLabelAndIco(n);else{var s=t.getTileUrl().replace("{z}",i.level+1).replace("{y}",i.y).replace("{x}",i.x),l=new XMLHttpRequest;l.open("GET",s,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status<200||l.status>=300)console.error(e);else{var i=t.CutString(l.response);if(i){(r=a(i)).x=this.tile.x,r.y=this.tile.y,r.z=this.tile.z,t.addCacheTile(r),t.addLabelAndIco(r)}else{var r={x:this.tile.x,y:this.tile.y,z:this.tile.z};t.addCacheTile(r),t.delaySynchronous()}}},l.onerror=function(t){console.error(t)},l.send(),l.tile={x:i.x,y:i.y,z:i.level+1}}})}},r.prototype.addLabelAndIco=function(t){if(t.pois)for(var e=0;e<t.pois.length;e++){var i=this.getCacheLabel(t.pois[e].oid);i||(i=this.createLabel(t.pois[e],t)),this.addCacheLabel(i)}this.delaySynchronous()},r.prototype.delaySynchronous=function(){var t=this;clearTimeout(t._timer2),t._timer2=setTimeout(function(){t.synchronousLabel()},200)},r.prototype.synchronousLabel=function(){for(var t=0;t<this.labelCache.length;t++)this.labelCache[t].timestamp>=this._latelyRefreshStamp&&!this.viewer.entities.contains(this.labelCache[t])&&this.viewer.entities.add(this.labelCache[t]);for(t=0;t<this.viewer.entities.values.length;t++)this.viewer.entities.values[t].name&&this.viewer.entities.values[t].name===this._UUID&&this.viewer.entities.values[t].timestamp<this._latelyRefreshStamp&&(this.viewer.entities.remove(this.viewer.entities.values[t]),t--);this.aotuCollide&&this.collisionDetection()},r.prototype.createLabel=function(e,i){if(e){var r={show:!0,position:t.Cartesian3.fromDegrees(e.coordinate[0],e.coordinate[1],e.coordinate[2]),label:{text:e.name}};void 0!==e.fontSize?(r.label.font=e.fontSize+"px ",void 0!==e.fontNameIndex&&i.stringTable&&i.stringTable[e.fontNameIndex]?r.label.font+=i.stringTable[e.fontNameIndex]:r.label.font+="sans-serif"):this.labelGraphics.font&&(r.label.font=this.labelGraphics.font),void 0!==e.fontColor?r.label.fillColor=t.Color.fromCssColorString(this.HexadecimalConversion(e.fontColor)):this.labelGraphics.fillColor&&(r.label.fillColor=this.labelGraphics.fillColor),void 0!==e.shiningColor?r.label.outlineColor=t.Color.fromCssColorString(this.HexadecimalConversion(e.shiningColor)):this.labelGraphics.outlineColor&&(r.label.outlineColor=this.labelGraphics.outlineColor),void 0!==e.outlineWidth?r.label.outlineWidth=e.outlineWidth:void 0!==this.labelGraphics.outlineWidth&&(r.label.outlineWidth=this.labelGraphics.outlineWidth),void 0!==e.showBackground?r.label.showBackground=e.showBackground:void 0!==this.labelGraphics.showBackground&&(r.label.showBackground=this.labelGraphics.showBackground),void 0!==e.backgroundColor?r.label.backgroundColor=e.backgroundColor:void 0!==this.labelGraphics.backgroundColor&&(r.label.backgroundColor=this.labelGraphics.backgroundColor),void 0!==e.backgroundPadding?r.label.backgroundPadding=e.backgroundPadding:void 0!==this.labelGraphics.backgroundPadding&&(r.label.backgroundPadding=this.labelGraphics.backgroundPadding),void 0!==e.verticalOrigin?r.label.verticalOrigin=e.verticalOrigin:void 0!==this.labelGraphics.verticalOrigin&&(r.label.verticalOrigin=this.labelGraphics.verticalOrigin),void 0!==e.horizontalOrigin?r.label.horizontalOrigin=e.horizontalOrigin:void 0!==this.labelGraphics.horizontalOrigin&&(r.label.horizontalOrigin=this.labelGraphics.horizontalOrigin),void 0!==e.eyeOffset?r.label.eyeOffset=e.eyeOffset:void 0!==this.labelGraphics.eyeOffset&&(r.label.eyeOffset=this.labelGraphics.eyeOffset),void 0!==e.pixelOffset?r.label.pixelOffset=e.pixelOffset:void 0!==this.labelGraphics.pixelOffset&&(r.label.pixelOffset=this.labelGraphics.pixelOffset),void 0!==e.style?r.label.style=e.style:void 0!==this.labelGraphics.style&&(r.label.style=this.labelGraphics.style),void 0!==e.scale?r.label.scale=e.scale:void 0!==this.labelGraphics.scale&&(r.label.scale=this.labelGraphics.scale),void 0!==e.symbolID&&e.symbolID>-1&&(r.billboard={image:this.getIcoUrl().replace("{id}",e.symbolID)},void 0!==e.displayHeight?(r.billboard.width=e.displayHeight,r.billboard.height=e.displayHeight):void 0!==this.billboardGraphics.width?r.billboard.width=this.billboardGraphics.width:void 0!==this.billboardGraphics.height&&(r.billboard.height=this.billboardGraphics.height),void 0!==e.verticalOrigin?r.billboard.verticalOrigin=e.verticalOrigin:void 0!==this.billboardGraphics.verticalOrigin&&(r.billboard.verticalOrigin=this.billboardGraphics.verticalOrigin),void 0!==e.horizontalOrigin?r.billboard.horizontalOrigin=e.horizontalOrigin:void 0!==this.billboardGraphics.horizontalOrigin&&(r.billboard.horizontalOrigin=this.billboardGraphics.horizontalOrigin),void 0!==e.eyeOffset?r.billboard.eyeOffset=e.eyeOffset:void 0!==this.billboardGraphics.eyeOffset&&(r.billboard.eyeOffset=this.billboardGraphics.eyeOffset),void 0!==e.pixelOffset?r.billboard.pixelOffset=e.pixelOffset:void 0!==this.billboardGraphics.pixelOffset&&(r.billboard.pixelOffset=this.billboardGraphics.pixelOffset),void 0!==e.rotation?r.billboard.rotation=e.rotation:void 0!==this.billboardGraphics.rotation&&(r.billboard.rotation=this.billboardGraphics.rotation),void 0!==e.alignedAxis?r.billboard.alignedAxis=e.alignedAxis:void 0!==this.billboardGraphics.alignedAxis&&(r.billboard.alignedAxis=this.billboardGraphics.alignedAxis),void 0!==e.color?r.billboard.color=e.color:void 0!==this.billboardGraphics.color&&(r.billboard.color=this.billboardGraphics.color),void 0!==e.scale?r.billboard.scale=e.scale:void 0!==this.billboardGraphics.scale&&(r.billboard.scale=this.billboardGraphics.scale));var o=new t.Entity(r);return o.name=this._UUID,o.oid=e.oid,o}},r.prototype.getPropertyValue=function(t,e,i,r){return void 0!==e[t]?e[t]:void 0!==i[t]?i[t]:r},r.prototype.collisionDetection=function(){for(var e=[],i=t.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.viewer.camera.pickEllipsoid(new t.Cartesian2(this.viewer.canvas.clientWidth/2,this.viewer.canvas.clientHeight/2))),r=0;r<this.viewer.entities.values.length;r++)if(this.viewer.entities.values[r].name&&this.viewer.entities.values[r].name===this._UUID){this.viewer.entities.values[r].show=!0;var n=t.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.viewer.entities.values[r].position.getValue(0)),a=Number.MAX_VALUE;if(void 0!==n&&void 0!==n.x){var s=Math.abs(i.x-n.x),l=Math.abs(i.y-n.y);a=Math.pow(s*s+l*l,.5)}e.push({entity:this.viewer.entities.values[r],distance:a,point:n})}e.sort(function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0});for(r=0;r<e.length;r++)if(e[r].entity.show&&e[r].distance!==Number.MAX_VALUE)for(var h=this.getLabelReact(e[r]),c=r+1;c<e.length;c++){if(e[c].entity.show&&e[c].distance!==Number.MAX_VALUE)o(h,this.getLabelReact(e[c]))&&(e[c].entity.show=!1)}},r.prototype.bindEvent=function(){this.viewer.scene.camera.moveEnd.addEventListener(this._moveEnd,this)},r.prototype.unbindEvent=function(){this.viewer.scene.camera.moveEnd.removeEventListener(this._moveEnd,this)},r.prototype.activate=function(){this._latelyGrid=[],this._moveEnd()},r.prototype.destroy=function(){for(var t=0;t<this.viewer.entities.values.length;t++)this.viewer.entities.values[t].name&&this.viewer.entities.values[t].name===this._UUID&&(this.viewer.entities.remove(this.viewer.entities.values[t]),t--);this.unbindEvent(),this.proxy=void 0,this.viewer=void 0,this.url=void 0,this.labelGraphics=void 0,this.billboardGraphics=void 0,this.aotuCollide=void 0,this.collisionWidthScale=void 0,this.collisionHeigthScale=void 0,this.tileCache=void 0,this.labelCache=void 0,this._latelyGrid=void 0,this._latelyRefreshStamp=void 0},r.prototype.compareArray=function(t,e){for(var i=!1,r=0;r<t.length;r++){for(var o=!1,n=0;n<e.length;n++)if(t[r].x===e[n].x&&t[r].y===e[n].y&&t[r].level===e[n].level){o=!0;break}if(!o){i=!0;break}}return!i},r.prototype.getLabelReact=function(t){var e=parseInt(t.entity.label.font);e=e>0?e:15;var i=n(t.entity.label.text.getValue(0))/2,r=t.entity.billboard.width.getValue(0)*t.entity.billboard.scale.getValue(0),o=t.entity.billboard.height.getValue(0)*t.entity.billboard.scale.getValue(0),a={x:t.point.x-r/2,y:t.point.y-o/2,width:e*t.entity.label.scale.getValue(0)*i+t.entity.label.pixelOffset.getValue(0).x+r,height:e*t.entity.label.scale.getValue(0)+t.entity.label.pixelOffset.getValue(0).y+o/2};return a.width*=this.collisionWidthScale,a.height*=this.collisionHeigthScale,a},r.prototype.CutString=function(t){if(!t)return"";var e=t.byteLength;return e<=28?"":t.slice(19,e-9)},r.prototype.HexadecimalConversion=function(t){var e=4278190080|parseInt(-Number(t));t="";if((e=e.toString(16).substring(1)).length<6)for(var i=6-e.length,r=0;r<i;r++)t+="0";return"#"+t+e};var n=function(t){for(var e=0,i=0;i<t.length;i++){null!=t.charAt(i).match(/[^\x00-\xff]/gi)?e+=2:e+=1}return e},a=function(t){var e={stringTable:[],pois:[],enumGeometryType:[{ePoint:0},{eMultiLineString:1},{ePolygon:2}],enumZCoordType:[{eCloseGround:0},{eCloseSeaSurface:1},{eRelativelyGround:2},{eAbsolute:3}]},i=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;} ;message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI.proto").build("GEOPOI").PBPOITile}(),r=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI2.proto").build("GEOPOI").PBPOITile}();e.pois.length=0;var o,n=t;try{o=r.decode(n)}catch(t){console.log(t.message),o=i.decode(n)}e.version=parseInt(o.Version.toString()),e.titleKey=parseInt(o.TileKey.toString()),e.stringTable=[];for(var a=o.StringTable.s.length,s=0;s<a;s++)e.stringTable.push(o.StringTable.s[s].toString());return o.POIS.forEach(function(t){var i={};i.oid=parseInt(t.OID.toString()),i.name=t.Name.toString(),i.symbolID=parseInt(t.SymbolID.toString()),i.displayHeight=t.DisplayHeight,i.shiningColor=t.ShiningColor,i.fontNameIndex=t.FontNameIndex,i.fontSize=t.FontSize,i.fontColor=t.FontColor,t.ZCoordType&&(i.zCoordType=t.ZCoordType),i.geometryType=t.GeometryType,i.interate=t.Interate,i.coordinate=t.Coordinates,e.pois.push(i)}),e};t.GeoWTFS=r}(window.Cesium),function(t){"use strict";var e=t.LayerManager=function(e){this.map=e,this.serviceLayerGroup=new t.ServiceLayerGroup(e),this.modelLayerGroup=new t.ModelLayerGroup(e),this.vectorLayerGroup=new t.VectorLayerGroup(e),this.terrainLayerGroup=new t.TerrainLayerGroup(e),this.basicLayerGroup=new t.BasicLayerGroup(e)};e.prototype.getMap=function(){return this.map},e.prototype.getServiceLayerGroup=function(){return this.serviceLayerGroup},e.prototype.getModelLayerGroup=function(){return this.modelLayerGroup},e.prototype.getVectorLayerGroup=function(){return this.vectorLayerGroup},e.prototype.getTerrainLayerGroup=function(){return this.terrainLayerGroup},e.prototype.getBasicLayerGroup=function(){return this.basicLayerGroup},e.prototype.remove=function(e){t.defined(e)?e.removeAll():(this.serviceLayerGroup.removeAll(),this.modelLayerGroup.removeAll(),this.vectorLayerGroup.removeAll(),this.terrainLayerGroup.removeAll(),this.basicLayerGroup.removeAll())}}(window.Cesium),function(t){"use strict";var e=t.ServiceLayerGroup=function(){};e.prototype=new t.CompositeEntityCollection,e.prototype.addLayer=function(i,r){var o="";return e.add(r)&&(r.name=i,o=t.createGuid(),r.id=o),o},e.prototype.removeLayer=function(t){var i=e.getLayer(t);return e.remove(i)},e.prototype.queryLayerByName=function(t){for(var i=null,r=0;r<e.length;r++){var o=e.get(r);if(t==o.name){i=o;break}}return i},e.prototype.getLayer=function(t){for(var i=null,r=0;r<e.length;r++){var o=e.get(r);if(t==o.id){i=o;break}}return i},e.prototype.showLayer=function(t){e.getLayer(t).show=!0},e.prototype.hideLayer=function(t){e.getLayer(t).show=!1},e.prototype.addChildLayerGroup=function(t){}}(window.Cesium),function(t){"use strict";var e=t.ModelLayerGroup=function(t){this.map=t};e.prototype=new t.PrimitiveCollection,e.prototype.addLayer=function(t,e){var i=this.map.scene.primitives.add(e),r="";return i&&(e.name=t,void 0!=$("#model-branch-container .layer-item-title").last()[0]&&(r=$("#model-branch-container .layer-item-title").last()[0].id),e.id=r),i},e.prototype.removeLayer=function(t){for(var e=0;e<this.map.scene.primitives.length;e++){var i=this.map.scene.primitives.get(e);if(t==i.id)break}return this.map.scene.primitives.remove(i)},e.prototype.queryLayerByName=function(t){for(var i=null,r=0;r<e.length;r++){var o=e.get(r);if(t==o.name){i=o;break}}return i},e.prototype.getLayer=function(t){var e=null;if(t)for(var i=1;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}else e=this.map.scene.primitives._primitives;return e},e.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}e&&(e.show=!0)},e.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}e&&(e.show=!1)}}(window.Cesium),function(t){"use strict";var e=t.VectorLayerGroup=function(t){this.map=t};e.prototype=new t.DataSourceCollection,e.prototype.addLayer=function(e,i){return i&&(i.id||(i.id=t.createGuid())),this.map.dataSources.add(i),this.map.dataSources.get(this.map.dataSources.length-1).name=e,i.id},e.prototype.removeLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++)if(t==this.map.dataSources.get(i).id){e=this.map.dataSources.get(i);break}try{this.map.dataSources.remove(e)}catch(t){return void console.log("DeveloperError")}},e.prototype.queryLayerByName=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r._name){e=r;break}}return e},e.prototype.getLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}return e},e.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}e&&(e.show=!0)},e.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}e&&(e.show=!1)}}(window.Cesium),function(t){"use strict";var e=t.TerrainLayerCollection=function(t){this._layers=[],this.length=this._layers.length,this.map=t};e.prototype.addTerrainProvider=function(e){if(!defined(e))throw new t.DeveloperError("terrainProvider is required.");return this.map.terrainProvider=e,this._layers=[],this._layers.push(e),this.map.terrainProvider},e.prototype.remove=function(){var e=new t.CesiumTerrainProvider({url:""});return this.map.terrainProvider=e,this._layers=[],0==this.map.terrainProvider._url_size},e.prototype.get=function(e){if(!defined(terrainProvider))throw new t.DeveloperError("id is required.");if(e==this._layers[0].id)return this._layers[0]}}(window.Cesium),function(t){"use strict";var e=t.TerrainLayerGroup=function(t){this.map=t};e.prototype.addLayer=function(e,i){if(i._credit)i.id=i._credit._text;else{var r=t.createGuid();i.id=r}return i.name=e,this.map.terrainProvider=i,i.id},e.prototype.removeLayer=function(e){if(e==this.map.terrainProvider.id){var i=new t.GeoTerrainProvider({proxy:new t.DefaultProxy("/proxyHandler?url="),dataType:t.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=i}return!this.map.terrainProvider.id},e.prototype.getLayer=function(e){var i=null;if(t.defined(e))e==this.map.terrainProvider.id&&(i=this.map.terrainProvider);else i=this.map.terrainProvider;return i},e.prototype.showLayer=function(e){if(e==this.map.terrainProvider.options.credit){var i=new t.GeoTerrainProvider({proxy:new t.DefaultProxy("/proxyHandler?url="),dataType:t.GeoTerrainProvider.FLOAT,urls:this.map.terrainProvider.options._urls,credit:this.map.terrainProvider.options.credit,name:this.map.terrainProvider.options.name,maxExtent:this.map.terrainProvider.options.maxExtent,opacity:this.map.terrainProvider.options.opacity,topLevel:this.map.terrainProvider.options.topLevel,bottomLevel:this.map.terrainProvider.options.bottomLevel});i.id=e,i.name=this.map.terrainProvider.options.name,this.map.terrainProvider=i}},e.prototype.hideLayer=function(e){var i=null;if(e==this.map.terrainProvider.id){var r={_urls:(i=this.map.terrainProvider)._urls,credit:i._credit.text,name:i.name,maxExtent:i._maxExtent,opacity:i._opacity,topLevel:i._topLevel,bottomLevel:i._bottomLevel},o=new t.GeoTerrainProvider({proxy:new t.DefaultProxy("/proxyHandler?url="),dataType:t.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=o,this.map.terrainProvider.options=r}}}(window.Cesium),function(t){"use strict";var e=t.BasicLayerGroup=function(t){this.map=t};e.prototype=new t.ImageryLayerCollection,e.prototype.addLayer=function(t,e){var i=this.map.imageryLayers.addImageryProvider(e),r="";if(i){i.name=t;for(var o=0;o<$("#imagery-branch-container .layer-item-content div").length;o++){if(t==$("#imagery-branch-container .layer-item-content span")[o].innerText){r=$($("#imagery-branch-container .layer-item-content div")[o]).attr("id");break}}i.id=r}return r},e.prototype.removeLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.remove(e)}catch(t){return void console.log("DeveloperError")}},e.prototype.queryLayerByName=function(e){if(!t.defined(e))return!1;for(var i=null,r=0;r<this.map.imageryLayers.length;r++)if(e==this.map.imageryLayers._layers[r].name){i=this.map.imageryLayers._layers[r];break}return i},e.prototype.getLayer=function(t){var e=null;if(t){for(var i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}}else e=this.map.imageryLayers._layers;return e},e.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}e.show=!0},e.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}e.show=!1},e.prototype.moveLayer=function(t,e){for(var i=null,r=null,o=0;o<this.map.imageryLayers.length;o++)if(t==this.map.imageryLayers._layers[o].id){i=this.map.imageryLayers._layers[o];break}for(o=0;o<this.map.imageryLayers.length;o++)if(e==this.map.imageryLayers._layers[o].id){r=this.map.imageryLayers._layers[o];break}var n=this.map.imageryLayers.indexOf(i)-this.map.imageryLayers.indexOf(r);if(n>0)for(o=0;o<n;o++)try{this.map.imageryLayers.raise(i)}catch(t){return void console.log(t)}else console.log("layer located top")},e.prototype.raiseLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.raise(e)}catch(t){return void console.log("DeveloperError")}},e.prototype.lowerLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.lower(e)}catch(t){return void console.log("DeveloperError")}}}(window.Cesium),function(t){"use strict";var e=t.Measure=function(t){this.viewer=t.viewer,this.primitives=this.viewer.scene.primitives};e.prototype.distance=function(e,i){if(e.polyline){var r=e.polyline.positions.getValue();if(!(r.length<=1)){for(var o,n=0,a=0,s=new t.EllipsoidGeodesic,l=1;l<r.length;l++){var h=t.Cartographic.fromCartesian(r[l-1]),c=t.Cartographic.fromCartesian(r[l]);s.setEndPoints(h,c),n+=Math.round(s.surfaceDistance);var d=t.Cartographic.fromCartesian(r[l-1]),u=t.Math.toDegrees(d.longitude),p=t.Math.toDegrees(d.latitude),g=t.Cartographic.fromCartesian(r[l]),m=t.Math.toDegrees(g.longitude),f=t.Math.toDegrees(g.latitude),v=turf.point([u,p]),y=turf.point([m,f]);a+=turf.distance(v,y)}return 2==i?o=n<1e3?n.toFixed(2)+"m":(n/1e3).toFixed(2)+"km":1==i&&(o=a<1?(1e3*a).toFixed(2)+"m":a.toFixed(2)+"km"),o}}},e.prototype.area=function(e){if(e.polygon){var i=e.polygon.hierarchy.getValue().positions;if(!(i.length<=2)){for(var r=[],o=0;o<i.length;o++){var n=t.Cartographic.fromCartesian(i[o]),a=t.Math.toDegrees(n.longitude),s=t.Math.toDegrees(n.latitude);r.push([a,s])}r.push(r[0]);var l=turf.polygon([r]),h=turf.area(l);return h<1e6?h.toFixed(2)+"m²":(h/1e6).toFixed(2)+"km²"}}},e.prototype.height=function(e){if(e.polyline){var i=e.polyline.positions.getValue();if(2==(i=[i[0],i[1]]).length){for(var r=[],o=0;o<i.length;o++){var n=t.Cartographic.fromCartesian(i[o]),a=t.Math.toDegrees(n.longitude),s=t.Math.toDegrees(n.latitude),l=n.height;r.push(a),r.push(s),r.push(l)}r[2]>=r[5]?(r.push(r[0]),r.push(r[1]),r.push(r[5])):(r.push(r[3]),r.push(r[4]),r.push(r[2]));var h={horizontalDistance:null,verticalHeight:null,spaceDistance:null},c=1e3*turf.distance(turf.point([r[0],r[1]]),turf.point([r[3],r[4]]));(u=[]).push((r[0]+r[3])/2),u.push((r[1]+r[4])/2),r[2]>=r[5]?u.push(r[5]):u.push(r[2]),h.horizontalDistance=c<1e3?"水平距离："+c.toFixed(2)+"m":"水平距离："+(c/1e3).toFixed(2)+"km";var d=Math.abs(r[2]-r[5]),u=[];r[2]>=r[5]?(u.push(r[0]),u.push(r[1])):(u.push(r[3]),u.push(r[4])),u.push((r[2]+r[5])/2),h.verticalHeight=d<1e3?"垂直高度："+d.toFixed(2)+"m":"垂直高度："+(d/1e3).toFixed(2)+"km";var p=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));return(u=[]).push((r[0]+r[3])/2),u.push((r[1]+r[4])/2),u.push((r[2]+r[5])/2),h.spaceDistance=p<1e3?"空间距离："+p.toFixed(2)+"m":"空间距离："+(p/1e3).toFixed(2)+"km",h}}},e.prototype.elevation=function(e){if(e.point){var i=[e.position._value];if(1==i.length){t.Cartographic.fromCartesian(i[0]).height.toFixed(2);createResultLabel2(this.options,this.primitives,i)}}}}(window.Cesium),function(t){"use strict";var e=t.MVTProvider=function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),this._tilingScheme=t.defined(e.tilingScheme)?e.tilingScheme:new t.WebMercatorTilingScheme({ellipsoid:e.ellipsoid}),this._tileWidth=t.defaultValue(e.tileWidth,512),this._tileHeight=t.defaultValue(e.tileHeight,512),this._readyPromise=t.when.resolve(!0),this._ol=t.defaultValue(e.ol,ol),this._mvtParser=new this._ol.format.MVT,this._proxy=e.proxy,this._layer=e.layer,this._styleName=e.styleName,this._tileMatrixSetID=e.tileMatrixSetID,this._tileMatrixLabels=e.tileMatrixLabels,this._format="protobuf",this._key=t.defaultValue(e.key,""),this._url=t.defaultValue(e.url,"https://a.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token={k}");var i=this._tilingScheme._rectangleSouthwestInMeters,r=(this._tilingScheme._rectangleNortheastInMeters,null);if(!i)this._tilingScheme.rectangle;this._tilingScheme instanceof t.WebMercatorTilingScheme?r=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]:this._tilingScheme instanceof t.GeographicTilingScheme&&(r=[-180,-270,180,90]),this._resolutions=ol.tilegrid.resolutionsFromExtent(r,22,this._tileWidth),this._pixelRatio=1,this._transform=[.125,0,0,.125,0,0],this._replays=["Default","Image","Polygon","LineString","Text"],this._tileQueue=new t.TileReplacementQueue,this._cacheSize=1e3,this.styleFunc=function(){return[]};var o=this,n=this.getStyleUrl();n=this._proxy.getURL(n),t.loadJson(n).then(function(t){for(var i="mysourceid",r=0;r<t.layers.length;r++)t.layers[r].source=i;t.sources=t.sources||{},t.sources[i]={type:"vector",url:e.url},t.sprite&&(t.sprite=Cfg.proxyHostUrl+t.sprite),t.glyphs&&(t.glyphs=Cfg.proxyHostUrl+t.glyphs),olms.applyStyle(null,t,i,null,o._resolutions).then(function(t){o.styleFunc=t})})};t.defineProperties(e.prototype,{url:{get:function(){return this._url}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}}),e.prototype.getTileCredits=function(t,e,i){},e.prototype.requestImage=function(e,i,r,o){var n=this._tileMatrixLabels,a=t.defined(n)?n[r]:r.toString(),s=function(t,e,i,r){for(var o=r.head;void 0!=o&&(o.xMvt!=t||o.yMvt!=e||o.zMvt!=i);)o=o.replacementNext;return o}(e,i,a,this._tileQueue);if(void 0!=s)return s;var l=this,h=this.getUrlTmpl();h=h.replace("{x}",e).replace("{y}",i).replace("{z}",a).replace("{k}",this._key),h=this._proxy.getURL(h);var c=t.when.defer();return t.loadArrayBuffer(h).then(function(r){var o=document.createElement("canvas");o.width=512,o.height=512;for(var n=o.getContext("2d"),s=l._mvtParser.readFeatures(r),h=l.styleFunc,d=new ol.render.canvas.ReplayGroup(0,[0,0,4096,4096],8,!0,100),u=0;u<s.length;u++)for(var p=s[u],g=h(s[u],l._resolutions[a])||[],m=0;m<g.length;m++)ol.renderer.vector.renderFeature_(d,p,g[m],16);return d.finish(),d.replay(n,l._pixelRatio,l._transform,0,{},l._replays,!0),l._tileQueue.count>l._cacheSize&&function(e,i){for(var r,o,n,a,s=e.tail;e.count>i&&t.defined(s);){var l=s.replacementPrevious;r=e,n=void 0,a=void 0,n=(o=s).replacementPrevious,a=o.replacementNext,o===r._lastBeforeStartOfFrame&&(r._lastBeforeStartOfFrame=a),o===r.head?r.head=a:n.replacementNext=a,o===r.tail?r.tail=n:a.replacementPrevious=n,o.replacementPrevious=void 0,o.replacementNext=void 0,--r.count,s=null,s=l}}(l._tileQueue,l._cacheSize/4),o.xMvt=e,o.yMvt=i,o.zMvt=a,l._tileQueue.markTileRendered(o),d=null,c.resolve(o),o}).otherwise(function(t){console.error(t)}),c.promise},e.prototype.pickFeatures=function(t,e,i,r,o){},e.prototype.getUrlTmpl=function(){var e={LAYER:this._layer,TILEMATRIXSET:this._tileMatrixSetID,FORMAT:this._format,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"},i=this.getParameterString(t.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetTile"},e));return this._url+"?"+i},e.prototype.getStyleUrl=function(){var e={STYLENAME:this._styleName},i=this.getParameterString(t.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetStyle"},e));return this._url+"?"+i},e.prototype.getParameterString=function(t){var e=[];for(var i in t){var r=t[i];if(null!=r&&"function"!=typeof r){var o;if("object"==typeof r&&r.constructor==Array){for(var n,a=[],s=0,l=r.length;s<l;s++)n=r[s],a.push(null===n||void 0===n?"":n);o=a.join(",")}else o=r;e.push(i+"="+o)}}return e.join("&")}}(window.Cesium),function(){"use strict";function t(t){throw t}var e=void 0,i=!0,r=this;function o(t,i){var o,n=t.split("."),a=r;!(n[0]in a)&&a.execScript&&a.execScript("var "+n[0]);for(;n.length&&(o=n.shift());)n.length||i===e?a=a[o]?a[o]:a[o]={}:a[o]=i}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(n?Uint8Array:Array)?e:new(n?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(n?Uint8Array:Array)(i<<1);if(n)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},a.prototype.d=function(t,e,i){var r,o=this.buffer,n=this.index,a=this.i,s=o[n];if(i&&1<e&&(t=8<e?(u[255&t]<<24|u[t>>>8&255]<<16|u[t>>>16&255]<<8|u[t>>>24&255])>>32-e:u[t]>>8-e),8>e+a)s=s<<e|t,a+=e;else for(r=0;r<e;++r)s=s<<1|t>>e-r-1&1,8==++a&&(a=0,o[n++]=u[s],s=0,n===o.length&&(o=this.f()));o[n]=s,this.buffer=o,this.i=a,this.index=n},a.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=u[e[i]],i++),n?t=e.subarray(0,i):(e.length=i,t=e),t};var s,l=new(n?Uint8Array:Array)(256);for(s=0;256>s;++s){for(var h=d=s,c=7,d=d>>>1;d;d>>>=1)h<<=1,h|=1&d,--c;l[s]=(h<<c&255)>>>0}var u=l;function p(t){this.buffer=new(n?Uint16Array:Array)(2*t),this.length=0}function g(t){var e,i,r,o,a,s,l,h,c,d,u=t.length,p=0,g=Number.POSITIVE_INFINITY;for(h=0;h<u;++h)t[h]>p&&(p=t[h]),t[h]<g&&(g=t[h]);for(e=1<<p,i=new(n?Uint32Array:Array)(e),r=1,o=0,a=2;r<=p;){for(h=0;h<u;++h)if(t[h]===r){for(s=0,l=o,c=0;c<r;++c)s=s<<1|1&l,l>>=1;for(d=r<<16|h,c=s;c<e;c+=a)i[c]=d;++o}++r,o<<=1,a<<=1}return[i,p,g]}function m(t,e){this.h=v,this.w=0,this.input=n&&t instanceof Array?new Uint8Array(t):t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=n&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(n?Uint8Array:Array)(32768))}p.prototype.getParent=function(t){return 2*((t-2)/4|0)},p.prototype.push=function(t,e){var i,r,o,n=this.buffer;for(i=this.length,n[this.length++]=e,n[this.length++]=t;0<i&&(r=this.getParent(i),n[i]>n[r]);)o=n[i],n[i]=n[r],n[r]=o,o=n[i+1],n[i+1]=n[r+1],n[r+1]=o,i=r;return this.length},p.prototype.pop=function(){var t,e,i,r,o,n=this.buffer;for(e=n[0],t=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],o=0;!((r=2*o+2)>=this.length)&&(r+2<this.length&&n[r+2]>n[r]&&(r+=2),n[r]>n[o]);)i=n[o],n[o]=n[r],n[r]=i,i=n[o+1],n[o+1]=n[r+1],n[r+1]=i,o=r;return{index:t,value:e,length:this.length}};var f,v=2,y={NONE:0,r:1,k:v,O:3},_=[];for(f=0;288>f;f++)switch(i){case 143>=f:_.push([f+48,8]);break;case 255>=f:_.push([f-144+400,9]);break;case 279>=f:_.push([f-256+0,7]);break;case 287>=f:_.push([f-280+192,8]);break;default:t("invalid literal: "+f)}m.prototype.j=function(){var r,o,s,l,h=this.input;switch(this.h){case 0:for(s=0,l=h.length;s<l;){var c,d,u,p=o=n?h.subarray(s,s+65535):h.slice(s,s+65535),g=(s+=o.length)===l,m=e,f=e,y=this.a,w=this.b;if(n){for(y=new Uint8Array(this.a.buffer);y.length<=w+p.length+5;)y=new Uint8Array(y.length<<1);y.set(this.a)}if(c=g?1:0,y[w++]=0|c,u=65536+~(d=p.length)&65535,y[w++]=255&d,y[w++]=d>>>8&255,y[w++]=255&u,y[w++]=u>>>8&255,n)y.set(p,w),w+=p.length,y=y.subarray(0,w);else{for(m=0,f=p.length;m<f;++m)y[w++]=p[m];y.length=w}this.b=w,this.a=y}break;case 1:var P=new a(n?new Uint8Array(this.a.buffer):this.a,this.b);P.d(1,1,i),P.d(1,2,i);var C,A,S,M=b(this,h);for(C=0,A=M.length;C<A;C++)if(S=M[C],a.prototype.d.apply(P,_[S]),256<S)P.d(M[++C],M[++C],i),P.d(M[++C],5),P.d(M[++C],M[++C],i);else if(256===S)break;this.a=P.finish(),this.b=this.a.length;break;case v:var x,I,k,R,D,O,L,F,B,H,U,N,W,G,z,V=new a(n?new Uint8Array(this.a.buffer):this.a,this.b),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=Array(19);for(x=v,V.d(1,1,i),V.d(x,2,i),I=b(this,h),L=T(O=E(this.M,15)),B=T(F=E(this.L,7)),k=286;257<k&&0===O[k-1];k--);for(R=30;1<R&&0===F[R-1];R--);var Z,Y,K,X,Q,J,$=k,tt=R,et=new(n?Uint32Array:Array)($+tt),it=new(n?Uint32Array:Array)(316),rt=new(n?Uint8Array:Array)(19);for(Z=Y=0;Z<$;Z++)et[Y++]=O[Z];for(Z=0;Z<tt;Z++)et[Y++]=F[Z];if(!n)for(Z=0,X=rt.length;Z<X;++Z)rt[Z]=0;for(Z=Q=0,X=et.length;Z<X;Z+=Y){for(Y=1;Z+Y<X&&et[Z+Y]===et[Z];++Y);if(K=Y,0===et[Z])if(3>K)for(;0<K--;)it[Q++]=0,rt[0]++;else for(;0<K;)J=138>K?K:138,J>K-3&&J<K&&(J=K-3),10>=J?(it[Q++]=17,it[Q++]=J-3,rt[17]++):(it[Q++]=18,it[Q++]=J-11,rt[18]++),K-=J;else if(it[Q++]=et[Z],rt[et[Z]]++,K--,3>K)for(;0<K--;)it[Q++]=et[Z],rt[et[Z]]++;else for(;0<K;)J=6>K?K:6,J>K-3&&J<K&&(J=K-3),it[Q++]=16,it[Q++]=J-3,rt[16]++,K-=J}for(r=n?it.subarray(0,Q):it.slice(0,Q),H=E(rt,7),G=0;19>G;G++)j[G]=H[q[G]];for(D=19;4<D&&0===j[D-1];D--);for(U=T(H),V.d(k-257,5,i),V.d(R-1,5,i),V.d(D-4,4,i),G=0;G<D;G++)V.d(j[G],3,i);for(G=0,z=r.length;G<z;G++)if(N=r[G],V.d(U[N],H[N],i),16<=N){switch(G++,N){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:t("invalid code: "+N)}V.d(r[G],W,i)}var ot,nt,at,st,lt,ht,ct,dt,ut=[L,O],pt=[B,F];for(lt=ut[0],ht=ut[1],ct=pt[0],dt=pt[1],ot=0,nt=I.length;ot<nt;++ot)if(at=I[ot],V.d(lt[at],ht[at],i),256<at)V.d(I[++ot],I[++ot],i),st=I[++ot],V.d(ct[st],dt[st],i),V.d(I[++ot],I[++ot],i);else if(256===at)break;this.a=V.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var w=function(){function e(e){switch(i){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var r,o,n=[];for(r=3;258>=r;r++)o=e(r),n[r]=o[2]<<24|o[1]<<16|o[0];return n}(),P=n?new Uint32Array(w):w;function b(r,o){function a(e,r){var o,n,a,s,l=e.H,h=[],c=0;switch(o=P[e.length],h[c++]=65535&o,h[c++]=o>>16&255,h[c++]=o>>24,i){case 1===l:n=[0,l-1,0];break;case 2===l:n=[1,l-2,0];break;case 3===l:n=[2,l-3,0];break;case 4===l:n=[3,l-4,0];break;case 6>=l:n=[4,l-5,1];break;case 8>=l:n=[5,l-7,1];break;case 12>=l:n=[6,l-9,2];break;case 16>=l:n=[7,l-13,2];break;case 24>=l:n=[8,l-17,3];break;case 32>=l:n=[9,l-25,3];break;case 48>=l:n=[10,l-33,4];break;case 64>=l:n=[11,l-49,4];break;case 96>=l:n=[12,l-65,5];break;case 128>=l:n=[13,l-97,5];break;case 192>=l:n=[14,l-129,6];break;case 256>=l:n=[15,l-193,6];break;case 384>=l:n=[16,l-257,7];break;case 512>=l:n=[17,l-385,7];break;case 768>=l:n=[18,l-513,8];break;case 1024>=l:n=[19,l-769,8];break;case 1536>=l:n=[20,l-1025,9];break;case 2048>=l:n=[21,l-1537,9];break;case 3072>=l:n=[22,l-2049,10];break;case 4096>=l:n=[23,l-3073,10];break;case 6144>=l:n=[24,l-4097,11];break;case 8192>=l:n=[25,l-6145,11];break;case 12288>=l:n=[26,l-8193,12];break;case 16384>=l:n=[27,l-12289,12];break;case 24576>=l:n=[28,l-16385,13];break;case 32768>=l:n=[29,l-24577,13];break;default:t("invalid distance")}for(o=n,h[c++]=o[0],h[c++]=o[1],h[c++]=o[2],a=0,s=h.length;a<s;++a)v[y++]=h[a];w[h[0]]++,b[h[3]]++,_=e.length+r-1,g=null}var s,l,h,c,d,u,p,g,m,f={},v=n?new Uint16Array(2*o.length):[],y=0,_=0,w=new(n?Uint32Array:Array)(286),b=new(n?Uint32Array:Array)(30),E=r.w;if(!n){for(h=0;285>=h;)w[h++]=0;for(h=0;29>=h;)b[h++]=0}for(w[256]=1,s=0,l=o.length;s<l;++s){for(h=d=0,c=3;h<c&&s+h!==l;++h)d=d<<8|o[s+h];if(f[d]===e&&(f[d]=[]),u=f[d],!(0<_--)){for(;0<u.length&&32768<s-u[0];)u.shift();if(s+3>=l){for(g&&a(g,-1),h=0,c=l-s;h<c;++h)m=o[s+h],v[y++]=m,++w[m];break}0<u.length?(p=C(o,s,u),g?g.length<p.length?(m=o[s-1],v[y++]=m,++w[m],a(p,0)):a(g,-1):p.length<E?g=p:a(p,0)):g?a(g,-1):(m=o[s],v[y++]=m,++w[m])}u.push(s)}return v[y++]=256,w[256]++,r.M=w,r.L=b,n?v.subarray(0,y):v}function C(t,e,i){var r,o,n,a,s,l,h=0,c=t.length;a=0,l=i.length;t:for(;a<l;a++){if(r=i[l-a-1],n=3,3<h){for(s=h;3<s;s--)if(t[r+s-1]!==t[e+s-1])continue t;n=h}for(;258>n&&e+n<c&&t[r+n]===t[e+n];)++n;if(n>h&&(o=r,h=n),258===n)break}return new function(t,e){this.length=t,this.H=e}(h,e-o)}function E(t,e){var i,r,o,a,s,l=t.length,h=new p(572),c=new(n?Uint8Array:Array)(l);if(!n)for(a=0;a<l;a++)c[a]=0;for(a=0;a<l;++a)0<t[a]&&h.push(a,t[a]);if(i=Array(h.length/2),r=new(n?Uint32Array:Array)(h.length/2),1===i.length)return c[h.pop().index]=1,c;for(a=0,s=h.length/2;a<s;++a)i[a]=h.pop(),r[a]=i[a].value;for(o=function(t,e,i){function r(t){var i=g[t][m[t]];i===e?(r(t+1),r(t+1)):--u[i],++m[t]}var o,a,s,l,h,c=new(n?Uint16Array:Array)(i),d=new(n?Uint8Array:Array)(i),u=new(n?Uint8Array:Array)(e),p=Array(i),g=Array(i),m=Array(i),f=(1<<i)-e,v=1<<i-1;for(c[i-1]=e,a=0;a<i;++a)f<v?d[a]=0:(d[a]=1,f-=v),f<<=1,c[i-2-a]=(c[i-1-a]/2|0)+e;for(c[0]=d[0],p[0]=Array(c[0]),g[0]=Array(c[0]),a=1;a<i;++a)c[a]>2*c[a-1]+d[a]&&(c[a]=2*c[a-1]+d[a]),p[a]=Array(c[a]),g[a]=Array(c[a]);for(o=0;o<e;++o)u[o]=i;for(s=0;s<c[i-1];++s)p[i-1][s]=t[s],g[i-1][s]=s;for(o=0;o<i;++o)m[o]=0;for(1===d[i-1]&&(--u[0],++m[i-1]),a=i-2;0<=a;--a){for(l=o=0,h=m[a+1],s=0;s<c[a];s++)l=p[a+1][h]+p[a+1][h+1],l>t[o]?(p[a][s]=l,g[a][s]=e,h+=2):(p[a][s]=t[o],g[a][s]=o,++o);m[a]=0,1===d[a]&&r(a)}return u}(r,r.length,e),a=0,s=i.length;a<s;++a)c[i[a].index]=o[a];return c}function T(t){var e,i,r,o,a=new(n?Uint16Array:Array)(t.length),s=[],l=[],h=0;for(e=0,i=t.length;e<i;e++)s[t[e]]=1+(0|s[t[e]]);for(e=1,i=16;e<=i;e++)l[e]=h,h+=0|s[e],h<<=1;for(e=0,i=t.length;e<i;e++)for(h=l[t[e]],l[t[e]]+=1,r=a[e]=0,o=t[e];r<o;r++)a[e]=a[e]<<1|1&h,h>>>=1;return a}function A(e,i){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=n?new Uint8Array(e):e,this.s=!1,this.n=M,this.C=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.m=i.bufferSize),i.bufferType&&(this.n=i.bufferType),i.resize&&(this.C=i.resize)),this.n){case S:this.b=32768,this.a=new(n?Uint8Array:Array)(32768+this.m+258);break;case M:this.b=0,this.a=new(n?Uint8Array:Array)(this.m),this.f=this.K,this.t=this.I,this.o=this.J;break;default:t(Error("invalid inflate mode"))}}var S=0,M=1,x={F:S,D:M};A.prototype.p=function(){for(;!this.s;){var r=Y(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var o=this.input,a=this.c,s=this.a,l=this.b,h=o.length,c=e,d=s.length,u=e;switch(this.e=this.g=0,a+1>=h&&t(Error("invalid uncompressed block header: LEN")),c=o[a++]|o[a++]<<8,a+1>=h&&t(Error("invalid uncompressed block header: NLEN")),c===~(o[a++]|o[a++]<<8)&&t(Error("invalid uncompressed block header: length verify")),a+c>o.length&&t(Error("input buffer is broken")),this.n){case S:for(;l+c>s.length;){if(c-=u=d-l,n)s.set(o.subarray(a,a+u),l),l+=u,a+=u;else for(;u--;)s[l++]=o[a++];this.b=l,s=this.f(),l=this.b}break;case M:for(;l+c>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(n)s.set(o.subarray(a,a+c),l),l+=c,a+=c;else for(;c--;)s[l++]=o[a++];this.c=a,this.b=l,this.a=s;break;case 1:this.o(q,Z);break;case 2:X(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.t()};var I,k,R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=n?new Uint16Array(R):R,O=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],L=n?new Uint16Array(O):O,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],B=n?new Uint8Array(F):F,H=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],U=n?new Uint16Array(H):H,N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=n?new Uint8Array(N):N,G=new(n?Uint8Array:Array)(288);for(I=0,k=G.length;I<k;++I)G[I]=143>=I?8:255>=I?9:279>=I?7:8;var z,V,q=g(G),j=new(n?Uint8Array:Array)(30);for(z=0,V=j.length;z<V;++z)j[z]=5;var Z=g(j);function Y(e,i){for(var r,o=e.g,n=e.e,a=e.input,s=e.c,l=a.length;n<i;)s>=l&&t(Error("input buffer is broken")),o|=a[s++]<<n,n+=8;return r=o&(1<<i)-1,e.g=o>>>i,e.e=n-i,e.c=s,r}function K(t,e){for(var i,r,o=t.g,n=t.e,a=t.input,s=t.c,l=a.length,h=e[0],c=e[1];n<c&&!(s>=l);)o|=a[s++]<<n,n+=8;return r=(i=h[o&(1<<c)-1])>>>16,t.g=o>>r,t.e=n-r,t.c=s,65535&i}function X(t){function e(t,e,i){var r,o,n,a=this.z;for(n=0;n<t;)switch(r=K(this,e),r){case 16:for(o=3+Y(this,2);o--;)i[n++]=a;break;case 17:for(o=3+Y(this,3);o--;)i[n++]=0;a=0;break;case 18:for(o=11+Y(this,7);o--;)i[n++]=0;a=0;break;default:a=i[n++]=r}return this.z=a,i}var i,r,o,a,s=Y(t,5)+257,l=Y(t,5)+1,h=Y(t,4)+4,c=new(n?Uint8Array:Array)(D.length);for(a=0;a<h;++a)c[D[a]]=Y(t,3);if(!n)for(a=h,h=c.length;a<h;++a)c[D[a]]=0;i=g(c),r=new(n?Uint8Array:Array)(s),o=new(n?Uint8Array:Array)(l),t.z=0,t.o(g(e.call(t,s,i,r)),g(e.call(t,l,i,o)))}function Q(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var o,n=1,a=0,s=t.length,l=0;0<s;){s-=o=1024<s?1024:s;do{n+=t[l++],a+=n}while(--o);n%=65521,a%=65521}return(a<<16|n)>>>0}function J(e,i){var r,o;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.N=i.verify)),r=e[this.c++],o=e[this.c++],15&r){case $:this.method=$;break;default:t(Error("unsupported compression method"))}0!=((r<<8)+o)%31&&t(Error("invalid fcheck flag:"+((r<<8)+o)%31)),32&o&&t(Error("fdict flag is not supported")),this.B=new A(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}A.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var o,n,a,s,l=i.length-258;256!==(o=K(this,t));)if(256>o)r>=l&&(this.b=r,i=this.f(),r=this.b),i[r++]=o;else for(s=L[n=o-257],0<B[n]&&(s+=Y(this,B[n])),o=K(this,e),a=U[o],0<W[o]&&(a+=Y(this,W[o])),r>=l&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},A.prototype.J=function(t,e){var i=this.a,r=this.b;this.u=t;for(var o,n,a,s,l=i.length;256!==(o=K(this,t));)if(256>o)r>=l&&(i=this.f(),l=i.length),i[r++]=o;else for(s=L[n=o-257],0<B[n]&&(s+=Y(this,B[n])),o=K(this,e),a=U[o],0<W[o]&&(a+=Y(this,W[o])),r+s>l&&(l=(i=this.f()).length);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},A.prototype.f=function(){var t,e,i=new(n?Uint8Array:Array)(this.b-32768),r=this.b-32768,o=this.a;if(n)i.set(o.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=o[t+32768];if(this.l.push(i),this.q+=i.length,n)o.set(o.subarray(r,r+32768));else for(t=0;32768>t;++t)o[t]=o[r+t];return this.b=32768,o},A.prototype.K=function(t){var e,i,r,o=this.input.length/this.c+1|0,a=this.input,s=this.a;return t&&("number"==typeof t.v&&(o=t.v),"number"==typeof t.G&&(o+=t.G)),2>o?i=(r=(a.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+r:s.length<<1:i=s.length*o,n?(e=new Uint8Array(i)).set(s):e=s,this.a=e},A.prototype.t=function(){var t,e,i,r,o,a=0,s=this.a,l=this.l,h=new(n?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return n?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=l.length;e<i;++e)for(r=0,o=(t=l[e]).length;r<o;++r)h[a++]=t[r];for(e=32768,i=this.b;e<i;++e)h[a++]=s[e];return this.l=[],this.buffer=h},A.prototype.I=function(){var t,e=this.b;return n?this.C?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},J.prototype.p=function(){var e,i=this.input;return e=this.B.p(),this.c=this.B.c,this.N&&((i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==Q(e)&&t(Error("invalid adler-32 checksum"))),e};var $=8;function tt(t,e){this.input=t,this.a=new(n?Uint8Array:Array)(32768),this.h=et.k;var i,r={};!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType);for(i in e)r[i]=e[i];r.outputBuffer=this.a,this.A=new m(this.input,r)}var et=y;function it(t,e){var i,r,n,a;if(Object.keys)i=Object.keys(e);else for(r in i=[],n=0,e)i[n++]=r;for(n=0,a=i.length;n<a;++n)r=i[n],o(t+"."+r,e[r])}tt.prototype.j=function(){var e,i,r,o,a,s,l,h=0;switch(l=this.a,e=$){case $:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=i<<4|e,l[h++]=r,e){case $:switch(this.h){case et.NONE:a=0;break;case et.r:a=1;break;case et.k:a=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return o=a<<6|0,l[h++]=o|31-(256*r+o)%31,s=Q(this.input),this.A.b=h,h=(l=this.A.j()).length,n&&((l=new Uint8Array(l.buffer)).length<=h+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,h+4)),l[h++]=s>>24&255,l[h++]=s>>16&255,l[h++]=s>>8&255,l[h++]=255&s,l},o("Zlib.Inflate",J),o("Zlib.Inflate.prototype.decompress",J.prototype.p),it("Zlib.Inflate.BufferType",{ADAPTIVE:x.D,BLOCK:x.F}),o("Zlib.Deflate",tt),o("Zlib.Deflate.compress",function(t,e){return new tt(t,e).j()}),o("Zlib.Deflate.prototype.compress",tt.prototype.j),it("Zlib.Deflate.CompressionType",{NONE:et.NONE,FIXED:et.r,DYNAMIC:et.k})}.call(this);