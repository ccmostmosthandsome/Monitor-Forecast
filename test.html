<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<link rel="stylesheet" href="plugins/bootstrap-4.0.0-dist/css/bootstrap.css">-->
    <!--<link rel="stylesheet" href="css/test/globe.css">-->
    <script src="./plugins/jquery/jquery-3.1.1.min.js"></script>
    <!--<script src="./plugins/bootstrap-4.0.0-dist/js/bootstrap.js"></script>-->
</head>
<body>
<input type="text" id="knowledgeText" name="knowledgeText" class="form-control" value=""
       onclick="$('#hideDiv').show()" placeholder="分类名称"/>
<div id="hideDiv" style="display: none;">
    <div id="knowledgeTree"></div>
    <button class="btn btn-danger" type="button" onclick="hideDIV()">
        <span class="glyphicon glyphicon-eye-open"></span> 确定
    </button>
</div>

</body>
<script type="text/javascript">
    $(function () {
        getTree('1');
    })

    function buildTree(parentNode, datas
    ) {
        for (var key in datas) {
            var data = datas[key];
            if (data.parentid == parentNode.id) {
                var node = {text: data.knowledgeText, id: data.id, nodes: [], selectable: true};
                parentNode.nodes.push(node);
                buildTree(node, datas);
            }
        }

        if (parentNode.nodes.length == 0) {
            delete parentNode.nodes;
        }
    }

    function getTree(strid) {
        var params = {};
        params.id = 'a696ee80-5b26-4a99-b013-ba22bec4d3bb';
        $.ajax({
            url: "/knowledge/getTree", // 请求的URL
            dataType: 'json',
            type: "get",
            data: params,
            success: function (data) {
                var tree = {text: '复读语文', id: 'a696ee80-5b26-4a99-b013-ba22bec4d3bb', nodes: []};
                buildTree(tree, data.data);
                $('#knowledgeTree').treeview({
                    color: "#428bca",
                    data: [tree],
                    showCheckbox: true,
                    multiSelect: true,
                    onNodeChecked: function (event, data) {
                        console.log('dddd', data);
                        var str = $("#knowledgeText").val();
                        console.log('1', data.knowledgeText);
                        if (str.length > 0) {
                            $("#knowledgeText").val(str + data.text + ',');
                        } else {
                            $("#knowledgeText").val(data.text + ',');
                        }
                        console.log('2', str);
                    },
                    onNodeUnchecked: function (event, data) {
                        var str = $("#knowledgeText").val();
                        $("#knowledgeText").val(str.replace(data.text + ",", ""));
//                        console.log('content', str.substring(0, str.indexOf(data.text)));
                        console.log('content', str.replace(data.text + ",", ""));
                    }
                });


            }
        });
    }

    function hideDIV() {

//        $("#knowledgeText").val(mdata.text);
        $("#hideDiv").hide();
    }
</script>
</html>